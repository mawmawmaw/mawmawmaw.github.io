"use strict";(self.webpackChunkmawmawmaw=self.webpackChunkmawmawmaw||[]).push([[849],{4849:(t,e,s)=>{s.r(e),s.d(e,{default:()=>M});var i=s(5043),a=s(1289),h=s.n(a);const r=400,o=600,l={width:240,height:110,x:200,y:125,topY:70,bottomY:180,postWidth:10,crossbarHeight:10},n={radius:15,startX:200,startY:480,maxVelocity:1200},c={width:50,height:70,startX:200,startY:l.bottomY-35,diveDistance:80},p=100,d=50,g=25,u=10,y={x:30,y:90,width:20,height:100},f={1:{correctDiveChance:.35,reactionSpeed:650,saveCoverage:.25},2:{correctDiveChance:.4,reactionSpeed:600,saveCoverage:.3},3:{correctDiveChance:.45,reactionSpeed:550,saveCoverage:.35},4:{correctDiveChance:.5,reactionSpeed:500,saveCoverage:.4},5:{correctDiveChance:.55,reactionSpeed:450,saveCoverage:.45}},m=1500,S=500,w=1722154,G=16777215,x=2278750;class b extends h().Scene{constructor(){super({key:"BootScene"})}preload(){const t=this.add.graphics(),e=this.add.graphics();e.fillStyle(2236962,.8),e.fillRect(40,275,320,50);const s=this.add.text(200,250,"Cargando...",{font:"20px Arial",color:"#ffffff"});s.setOrigin(.5,.5),this.load.on("progress",e=>{t.clear(),t.fillStyle(x,1),t.fillRect(50,285,300*e,30)}),this.load.on("complete",()=>{t.destroy(),e.destroy(),s.destroy()});const i=this.registry.get("skin"),a="/games/penalty-shootout/sprites/",h=i?"skins/".concat(i,"/"):"";this.load.spritesheet("goalkeeper","".concat(a).concat(h,"goalkeeper.webp"),{frameWidth:128,frameHeight:128}),this.load.image("ball","".concat(a).concat(h,"ball.webp")),this.load.image("grass","".concat(a).concat(h,"grass.webp")),this.load.image("ad-bottom","".concat(a).concat(h,"ad-bottom.png")),this.load.spritesheet("sparksheet","".concat(a).concat(h,"sparks.webp"),{frameWidth:48,frameHeight:54})}async create(){try{const t=document.fonts.load("bold 20px Orbitron"),e=new Promise(t=>setTimeout(t,2e3));await Promise.race([t,e]),await document.fonts.ready}catch(t){console.warn("Font preload warning:",t)}this.scene.start("MainScene")}}var k=s(1416);const T=new class{constructor(){this.initialized=!1,this.muted=!1,this.kickSynth=null,this.goalSynth=null,this.saveSynth=null,this.whistleSynth=null,this.missSynth=null}async init(){this.initialized||(await k.ni(),this.kickSynth=new k.sy({pitchDecay:.02,octaves:5,oscillator:{type:"sine"},envelope:{attack:.001,decay:.3,sustain:0,release:.2},volume:-4}).toDestination(),this.goalSynth=new k.Bh(k.RG,{oscillator:{type:"sawtooth"},envelope:{attack:.01,decay:.2,sustain:.3,release:.5},volume:-6}).toDestination(),this.saveSynth=new k.LJ({noise:{type:"brown"},envelope:{attack:.005,decay:.2,sustain:0,release:.1},volume:-12}).toDestination(),this.whistleSynth=new k.RG({oscillator:{type:"sine"},envelope:{attack:.01,decay:.1,sustain:.3,release:.2},volume:-10}).toDestination(),this.missSynth=new k.RG({oscillator:{type:"triangle"},envelope:{attack:.01,decay:.3,sustain:0,release:.3},volume:-8}).toDestination(),this.initialized=!0)}playKick(){if(!this.initialized||this.muted||!this.kickSynth)return;const t=k.tB();this.kickSynth.triggerAttackRelease("C2","8n",t)}playGoal(){if(!this.initialized||this.muted||!this.goalSynth)return;const t=k.tB();[{notes:["C4","E4","G4"],time:0},{notes:["D4","F4","A4"],time:.15},{notes:["E4","G4","B4"],time:.3},{notes:["C5","E5","G5"],time:.5}].forEach(e=>{let{notes:s,time:i}=e;this.goalSynth.triggerAttackRelease(s,"4n",t+i)})}playSave(){if(!this.initialized||this.muted)return;const t=k.tB();this.saveSynth&&this.saveSynth.triggerAttackRelease("8n",t),this.whistleSynth&&(this.whistleSynth.triggerAttackRelease("E6","16n",t+.15),this.whistleSynth.triggerAttackRelease("C6","8n",t+.25))}playMiss(){if(!this.initialized||this.muted||!this.missSynth)return;const t=k.tB();["E4","D4","C4","B3"].forEach((e,s)=>{this.missSynth.triggerAttackRelease(e,"16n",t+.12*s)})}setMuted(t){this.muted=t}isMuted(){return this.muted}dispose(){var t,e,s,i,a;this.initialized&&(null===(t=this.kickSynth)||void 0===t||t.dispose(),null===(e=this.goalSynth)||void 0===e||e.dispose(),null===(s=this.saveSynth)||void 0===s||s.dispose(),null===(i=this.whistleSynth)||void 0===i||i.dispose(),null===(a=this.missSynth)||void 0===a||a.dispose(),this.kickSynth=null,this.goalSynth=null,this.saveSynth=null,this.whistleSynth=null,this.missSynth=null,this.initialized=!1)}};class v extends h().Scene{constructor(){super({key:"MainScene"}),this.gameState=void 0,this.ball=void 0,this.ballShadow=void 0,this.goalkeeper=void 0,this.goalGraphics=void 0,this.fieldGraphics=void 0,this.trajectoryGraphics=void 0,this.goalZoneGraphics=void 0,this.projectionGraphics=void 0,this.roundText=void 0,this.instructionText=void 0,this.resultText=void 0,this.gestureIndicator=void 0,this.goalIndicators=[],this.shotResults=[],this.isDragging=!1,this.dragStartPos=null,this.spinPoints=[],this.accumulatedSpin=0,this.ballGrabOffset={x:0,y:0},this.spinIndicator=void 0,this.ballTrail=void 0,this.sparkSprite=void 0,this.powerBarGraphics=void 0,this.powerBarFill=void 0,this.smoothedPower=30,this.trajectoryPoints=[],this.isSwiping=!1,this.swipeStartTime=0,this.currentDifficulty=void 0,this.totalRounds=5}create(){this.totalRounds=this.registry.get("totalRounds")||5,T.init(),this.initializeGameState(),this.createGoalkeeperAnimations(),this.drawField(),this.drawGoal(),this.createGoalZoneGuides(),this.createBall(),this.createGoalkeeper(),this.createTrajectoryGraphics(),this.createSpinIndicator(),this.createPowerBar(),this.createUI(),this.setupInput(),this.showStartScreen()}createGoalkeeperAnimations(){this.anims.create({key:"gk-idle",frames:[{key:"goalkeeper",frame:0}],frameRate:1}),this.anims.create({key:"gk-dive",frames:this.anims.generateFrameNumbers("goalkeeper",{start:1,end:3}),frameRate:12,repeat:0}),this.anims.create({key:"gk-jump",frames:[{key:"goalkeeper",frame:4}],frameRate:1}),this.anims.create({key:"gk-crouch",frames:[{key:"goalkeeper",frame:5}],frameRate:1})}initializeGameState(){if(this.gameState={phase:"start",round:1,goals:0,totalScore:0,lastResult:null,consecutiveGoals:0,aimPosition:null,power:0},this.currentDifficulty=f[1],this.shotResults=[],this.goalIndicators.length>0)for(const t of this.goalIndicators)t.setFillStyle(6710886,1)}drawField(){this.fieldGraphics=this.add.graphics(),this.fieldGraphics.setDepth(0);const t=200,e=l.x-l.width/2,s=l.x+l.width/2,i=l.topY,a=l.bottomY;for(let l=0;l<60;l++){const t=l/60,e=Math.floor(100+50*t)<<16|Math.floor(150+50*t)<<8|Math.floor(220-20*t);this.fieldGraphics.fillStyle(e,1),this.fieldGraphics.fillRect(0,l,r,1)}this.add.tileSprite(200,305,r,490,"grass").setDepth(0),this.fieldGraphics.fillStyle(0,1),this.fieldGraphics.fillRect(e,i,s-e,a-i),this.fieldGraphics.fillStyle(1710638,1),this.fieldGraphics.fillRect(0,550,r,50);const h=this.add.graphics();h.setDepth(.5),h.lineStyle(5,G,.9);const o=l.bottomY;h.lineBetween(0,o,r,o),h.lineStyle(4,G,.8);const c=l.bottomY,p=l.bottomY+60;h.lineBetween(60,c,40,p),h.lineBetween(340,c,360,p),h.lineBetween(40,p,360,p),h.fillStyle(G,1),h.fillCircle(n.startX,n.startY,5),h.lineStyle(4,G,.8),h.beginPath();const d=n.startY+50;for(let r=0;r<=30;r++){const e=3*r/30-1.5,s=t+70*Math.sin(e),i=d-70*Math.cos(e)*.7;0===r?h.moveTo(s,i):h.lineTo(s,i)}h.strokePath(),h.lineStyle(5,G,.9);const g=d-70*Math.cos(1.5)*.7;h.lineBetween(0,g,r,g),this.addAdBanners()}addAdBanners(){const t=this.add.sprite(200,575,"ad-bottom");t.setDepth(10),t.setDisplaySize(r,50)}drawGoal(){this.goalGraphics=this.add.graphics(),this.goalGraphics.setDepth(1);const t=180,e=70,s=240,i=10,a=60,h=204;this.goalGraphics.fillStyle(3355443,.6),this.goalGraphics.beginPath(),this.goalGraphics.moveTo(98,a),this.goalGraphics.lineTo(302,a),this.goalGraphics.lineTo(302,160),this.goalGraphics.lineTo(98,160),this.goalGraphics.closePath(),this.goalGraphics.fillPath(),this.goalGraphics.lineStyle(1,6710886,.3);for(let r=98;r<=302;r+=12)this.goalGraphics.lineBetween(r,a,r,160);for(let r=a;r<=160;r+=12)this.goalGraphics.lineBetween(98,r,302,r);this.goalGraphics.fillStyle(4473924,.4),this.goalGraphics.beginPath(),this.goalGraphics.moveTo(80,e),this.goalGraphics.lineTo(98,a),this.goalGraphics.lineTo(98,160),this.goalGraphics.lineTo(80,t),this.goalGraphics.closePath(),this.goalGraphics.fillPath(),this.goalGraphics.lineStyle(1,8947848,.3);for(let r=0;r<=4;r++){const t=r/4,s=e+110*t,i=a+100*t;this.goalGraphics.lineBetween(80,s,98,i)}this.goalGraphics.fillStyle(4473924,.4),this.goalGraphics.beginPath(),this.goalGraphics.moveTo(320,e),this.goalGraphics.lineTo(302,a),this.goalGraphics.lineTo(302,160),this.goalGraphics.lineTo(320,t),this.goalGraphics.closePath(),this.goalGraphics.fillPath();for(let r=0;r<=4;r++){const t=r/4,s=e+110*t,i=a+100*t;this.goalGraphics.lineBetween(320,s,302,i)}this.goalGraphics.fillStyle(5592405,.3),this.goalGraphics.beginPath(),this.goalGraphics.moveTo(80,e),this.goalGraphics.lineTo(320,e),this.goalGraphics.lineTo(302,a),this.goalGraphics.lineTo(98,a),this.goalGraphics.closePath(),this.goalGraphics.fillPath(),this.goalGraphics.lineStyle(1,8947848,.3);for(let r=0;r<=8;r++){const t=r/8,i=80+t*s,o=98+t*h;this.goalGraphics.lineBetween(i,e,o,a)}this.goalGraphics.fillStyle(16777215,1),this.goalGraphics.fillRect(75,e,i,110),this.goalGraphics.fillStyle(13421772,1),this.goalGraphics.fillRect(82,e,3,110),this.goalGraphics.fillStyle(16777215,1),this.goalGraphics.fillRect(315,e,i,110),this.goalGraphics.fillStyle(13421772,1),this.goalGraphics.fillRect(315,e,3,110),this.goalGraphics.fillStyle(16777215,1),this.goalGraphics.fillRect(75,60,250,i),this.goalGraphics.fillStyle(11184810,1),this.goalGraphics.fillRect(75,67,250,3),this.goalGraphics.fillStyle(666133,.5),this.goalGraphics.fillEllipse(80,183,14,6),this.goalGraphics.fillEllipse(320,183,14,6)}createBall(){this.ballShadow=this.add.ellipse(n.startX,n.startY+8,1.5*n.radius,.75*n.radius,0,.3),this.ballShadow.setDepth(4),this.ball=this.add.sprite(n.startX,n.startY,"ball"),this.ball.setDepth(5);const t=1.5*n.radius/this.ball.width;this.ball.setScale(t)}createGoalkeeper(){this.goalkeeper=this.add.sprite(c.startX,c.startY+c.height/2,"goalkeeper",0),this.goalkeeper.setOrigin(.5,1),this.goalkeeper.setDepth(3);const t=1.3*c.height/128;this.goalkeeper.setScale(t),this.goalkeeper.play("gk-idle")}createTrajectoryGraphics(){this.trajectoryGraphics=this.add.graphics(),this.trajectoryGraphics.setDepth(10),this.projectionGraphics=this.add.graphics(),this.projectionGraphics.setDepth(10),this.ballTrail=this.add.graphics(),this.ballTrail.setDepth(4)}createGoalZoneGuides(){this.goalZoneGraphics=this.add.graphics(),this.goalZoneGraphics.setDepth(2),this.goalZoneGraphics.setAlpha(0)}createSpinIndicator(){this.spinIndicator=this.add.graphics(),this.spinIndicator.setDepth(6),this.spinIndicator.setAlpha(0),this.anims.create({key:"spark_loop",frames:this.anims.generateFrameNumbers("sparksheet",{start:0,end:14}),frameRate:15,repeat:-1}),this.sparkSprite=this.add.sprite(n.startX,n.startY,"sparksheet"),this.sparkSprite.setVisible(!1),this.sparkSprite.setDepth(4)}drawGoalZoneGuides(){this.goalZoneGraphics.clear();const t=l.topY,e=l.bottomY,s=l.x-l.width/2,i=l.x+l.width/2,a=e-t,h=l.width;this.goalZoneGraphics.fillStyle(49151,.2),this.goalZoneGraphics.fillRect(s,t,h,a);const r=h/3,o=a/3;this.goalZoneGraphics.lineStyle(2,16777215,.5),this.goalZoneGraphics.lineBetween(s+r,t,s+r,e),this.goalZoneGraphics.lineBetween(s+2*r,t,s+2*r,e),this.goalZoneGraphics.lineBetween(s,t+o,i,t+o),this.goalZoneGraphics.lineBetween(s,t+2*o,i,t+2*o),this.goalZoneGraphics.fillStyle(16766720,.25),this.goalZoneGraphics.fillRect(s,t,r,o),this.goalZoneGraphics.fillRect(s+2*r,t,r,o),this.goalZoneGraphics.fillStyle(16766720,.8),this.drawStar(s+r/2,t+o/2,8,5),this.drawStar(s+2.5*r,t+o/2,8,5)}drawStar(t,e,s,i){const a=.5*s;this.goalZoneGraphics.beginPath();for(let h=0;h<2*i;h++){const r=h%2===0?s:a,o=h*Math.PI/i-Math.PI/2,l=t+Math.cos(o)*r,n=e+Math.sin(o)*r;0===h?this.goalZoneGraphics.moveTo(l,n):this.goalZoneGraphics.lineTo(l,n)}this.goalZoneGraphics.closePath(),this.goalZoneGraphics.fillPath()}showGoalZoneGuides(){this.drawGoalZoneGuides(),this.tweens.add({targets:this.goalZoneGraphics,alpha:1,duration:300,ease:"Power2"})}hideGoalZoneGuides(){this.tweens.add({targets:this.goalZoneGraphics,alpha:0,duration:200,ease:"Power2"})}updateProjectionIndicator(t,e){this.projectionGraphics.clear();const s=l.x-l.width/2+10,i=l.x+l.width/2-10,a=l.topY+5,r=l.bottomY-5,o=h().Math.Clamp(t,s,i),c=h().Math.Clamp(e,a,r);if(e<r+100){this.projectionGraphics.lineStyle(2,16777215,.4);const t=10,e=8,s=n.startX,i=n.startY,a=o-s,h=c-i,r=Math.sqrt(a*a+h*h),l=Math.floor(r/(t+e));for(let o=0;o<l;o++){const l=o*(t+e)/r,n=(o*(t+e)+t)/r;n<=1&&this.projectionGraphics.lineBetween(s+a*l,i+h*l,s+a*n,i+h*n)}this.projectionGraphics.lineStyle(3,16729156,.8),this.projectionGraphics.strokeCircle(o,c,15),this.projectionGraphics.lineStyle(2,16777215,.6),this.projectionGraphics.lineBetween(o-8,c,o+8,c),this.projectionGraphics.lineBetween(o,c-8,o,c+8),this.highlightTargetZone(o,c)}}highlightTargetZone(t,e){const s=l.topY,i=l.x-l.width/2,a=l.width/3,h=(l.bottomY-l.topY)/3,r=Math.floor((t-i)/a),o=Math.floor((e-s)/h);if(r>=0&&r<3&&o>=0&&o<3){const t=i+r*a,e=s+o*h;this.projectionGraphics.fillStyle(16777215,.1),this.projectionGraphics.fillRect(t,e,a,h),0!==o||0!==r&&2!==r||(this.projectionGraphics.fillStyle(16766720,.15),this.projectionGraphics.fillRect(t,e,a,h))}}updateSpinIndicator(t){if(this.spinIndicator.clear(),Math.abs(t)<.15)return this.spinIndicator.setAlpha(0),this.sparkSprite.setVisible(!1),void this.sparkSprite.stop();this.spinIndicator.setAlpha(Math.min(1.5*Math.abs(t),1)),this.sparkSprite.setPosition(this.ball.x,this.ball.y),this.sparkSprite.setScale(2+Math.abs(t)),this.sparkSprite.visible||(this.sparkSprite.setVisible(!0),this.sparkSprite.play("spark_loop"));const e=this.ball.x,s=this.ball.y,i=n.radius+12,a=16776960;this.spinIndicator.lineStyle(6,a,.9);const h=10;if(t>0){this.spinIndicator.beginPath(),this.spinIndicator.arc(e,s,i,-.8,.8,!1),this.spinIndicator.strokePath();const t=.8,r=e+Math.cos(t)*i,o=s+Math.sin(t)*i,l=t+Math.PI/2;this.spinIndicator.fillStyle(a,1),this.spinIndicator.fillTriangle(r+Math.cos(l)*h,o+Math.sin(l)*h,r+Math.cos(l+2.5)*h,o+Math.sin(l+2.5)*h,r+Math.cos(l-2.5)*h,o+Math.sin(l-2.5)*h)}else{this.spinIndicator.beginPath(),this.spinIndicator.arc(e,s,i,Math.PI-.8,Math.PI+.8,!1),this.spinIndicator.strokePath();const t=Math.PI-.8,r=e+Math.cos(t)*i,o=s+Math.sin(t)*i,l=t-Math.PI/2;this.spinIndicator.fillStyle(a,1),this.spinIndicator.fillTriangle(r+Math.cos(l)*h,o+Math.sin(l)*h,r+Math.cos(l+2.5)*h,o+Math.sin(l+2.5)*h,r+Math.cos(l-2.5)*h,o+Math.sin(l-2.5)*h)}}createUI(){this.roundText=this.add.text(200,20,"",{font:"bold 16px Orbitron",color:"#ffffff",stroke:"#000000",strokeThickness:4}),this.roundText.setOrigin(.5),this.roundText.setResolution(2),this.roundText.setDepth(15);const t=200-18*(this.totalRounds-1)/2;for(let e=0;e<this.totalRounds;e++){const s=this.add.circle(t+18*e,42,6,6710886,1);s.setStrokeStyle(2,16777215,.8),s.setDepth(15),this.goalIndicators.push(s)}this.instructionText=this.add.text(200,300,"",{font:"bold 22px Orbitron",color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}),this.instructionText.setOrigin(.5),this.instructionText.setResolution(2),this.instructionText.setDepth(20),this.resultText=this.add.text(200,250,"",{font:"bold 36px Orbitron",color:"#ffffff",stroke:"#000000",strokeThickness:5,align:"center"}),this.resultText.setOrigin(.5),this.resultText.setResolution(2),this.resultText.setDepth(20),this.resultText.setVisible(!1),this.gestureIndicator=this.add.text(200,360,"\ud83d\udc46",{font:"bold 28px Arial"}),this.gestureIndicator.setOrigin(.5),this.gestureIndicator.setDepth(20),this.gestureIndicator.setVisible(!1),this.updateUI()}updateUI(){this.roundText.setText("Tiro ".concat(this.gameState.round," de ").concat(this.totalRounds))}setupInput(){this.input.on("pointerdown",this.handlePointerDown,this),this.input.on("pointermove",this.handlePointerMove,this),this.input.on("pointerup",this.handlePointerUp,this)}handlePointerDown(t){if("start"===this.gameState.phase)this.startRound();else if("aiming"===this.gameState.phase){if(h().Math.Distance.Between(t.x,t.y,this.ball.x,this.ball.y)<n.radius+40){this.isDragging=!0,this.dragStartPos={x:n.startX,y:n.startY},this.ballGrabOffset={x:this.ball.x-t.x,y:this.ball.y-t.y},this.spinPoints=[{x:t.x,y:t.y,time:this.time.now}],this.accumulatedSpin=0,this.swipeStartTime=this.time.now,this.tweens.killTweensOf(this.gestureIndicator),this.gestureIndicator.setVisible(!1);const e=1.15*this.ball.scale;this.tweens.killTweensOf(this.ball),this.tweens.add({targets:this.ball,scale:e,duration:100,ease:"Power2"}),this.isSwiping=!0,this.trajectoryPoints=[{x:n.startX,y:n.startY,time:0}]}}}handlePointerMove(t){if("aiming"===this.gameState.phase&&this.isDragging){const e=t.x+this.ballGrabOffset.x,s=t.y+this.ballGrabOffset.y,i=150,a=e-n.startX,h=s-n.startY,r=Math.sqrt(a*a+h*h);let o=e,c=s;if(r>i){const t=i/r;o=n.startX+a*t,c=n.startY+h*t}const p=.3,d=this.ball.x+(o-this.ball.x)*p,g=this.ball.y+(c-this.ball.y)*p;this.ball.setPosition(d,g),this.ballShadow.setPosition(d,g+10),this.spinPoints.push({x:t.x,y:t.y,time:this.time.now});const u=500,y=this.time.now;this.spinPoints=this.spinPoints.filter(t=>y-t.time<u),this.accumulatedSpin=this.calculateSpinFromPoints(),this.updateSpinIndicator(this.accumulatedSpin),this.drawBallTrail();const f=this.calculateInstantaneousSpeed(),m=Math.min(100,Math.max(30,f/10));this.updatePowerBar(m);if(Math.abs(this.accumulatedSpin)>=.15)this.projectionGraphics.clear();else{const t={x:this.ball.x-n.startX,y:this.ball.y-n.startY};if(t.y<-10){const e=l.topY+(l.bottomY-l.topY)/2,s=(e-n.startY)/t.y,i=n.startX+t.x*s;this.updateProjectionIndicator(i,e)}else this.projectionGraphics.clear()}const S=this.time.now-this.swipeStartTime;this.trajectoryPoints.push({x:t.x,y:t.y,time:S}),this.trajectoryPoints.length>100&&this.trajectoryPoints.shift()}}handlePointerUp(t){if("aiming"===this.gameState.phase&&this.isDragging){this.isDragging=!1,this.isSwiping=!1,this.hideGoalZoneGuides();const t=this.calculateReleaseVelocity();if(t.y<-50&&this.spinPoints.length>=3)this.trajectoryGraphics.clear(),this.projectionGraphics.clear(),this.ballTrail.clear(),this.spinIndicator.setAlpha(0),this.sparkSprite.setVisible(!1),this.sparkSprite.stop(),this.hidePowerBar(),this.executeDragShot(t);else{const t=1.5*n.radius/this.ball.width;this.tweens.add({targets:this.ball,x:n.startX,y:n.startY,scale:t,duration:200,ease:"Power2"}),this.tweens.add({targets:this.ballShadow,x:n.startX,y:n.startY+8,duration:200,ease:"Power2"}),this.trajectoryGraphics.clear(),this.projectionGraphics.clear(),this.ballTrail.clear(),this.spinIndicator.setAlpha(0),this.sparkSprite.setVisible(!1),this.sparkSprite.stop(),this.instructionText.setText("Arrastra hacia arriba\ncon m\xe1s fuerza"),this.showGoalZoneGuides()}this.spinPoints=[],this.accumulatedSpin=0}}calculateSpinFromPoints(){if(this.spinPoints.length<5)return 0;let t=0,e=0;const s=this.ball.x,i=this.ball.y;for(let h=1;h<this.spinPoints.length;h++){const a=this.spinPoints[h-1],r=this.spinPoints[h],o=Math.atan2(a.y-i,a.x-s);let l=Math.atan2(r.y-i,r.x-s)-o;for(;l>Math.PI;)l-=2*Math.PI;for(;l<-Math.PI;)l+=2*Math.PI;Math.sqrt(Math.pow(r.x-s,2)+Math.pow(r.y-i,2))>20&&(t+=l,e++)}if(e<3)return 0;const a=t/e;return h().Math.Clamp(3*a,-1,1)}calculateReleaseVelocity(){if(this.spinPoints.length<2)return{x:0,y:0,speed:0};const t=this.spinPoints.slice(-5);if(t.length<2)return{x:0,y:0,speed:0};const e=t[0],s=t[t.length-1],i=(s.time-e.time)/1e3;if(i<=0)return{x:0,y:0,speed:0};const a=(s.x-e.x)/i,h=(s.y-e.y)/i;return{x:a,y:h,speed:Math.sqrt(a*a+h*h)}}calculateInstantaneousSpeed(){if(this.spinPoints.length<3)return 0;const t=this.spinPoints.slice(-3),e=t[0],s=t[t.length-1],i=(s.time-e.time)/1e3;if(i<=0)return 0;const a=s.x-e.x,h=s.y-e.y;return Math.sqrt(a*a+h*h)/i}createPowerBar(){const{x:t,y:e,width:s,height:i}=y;this.powerBarGraphics=this.add.graphics(),this.powerBarGraphics.setDepth(10),this.powerBarGraphics.fillStyle(16498468,.3),this.powerBarGraphics.fillRect(t,e+.6*i,s,.4*i),this.powerBarGraphics.fillStyle(2278750,.3),this.powerBarGraphics.fillRect(t,e+.25*i,s,.35*i),this.powerBarGraphics.fillStyle(15680580,.3),this.powerBarGraphics.fillRect(t,e,s,.25*i),this.powerBarGraphics.lineStyle(2,16777215,.8),this.powerBarGraphics.strokeRect(t,e,s,i),this.powerBarFill=this.add.graphics(),this.powerBarFill.setDepth(11),this.powerBarGraphics.setVisible(!1),this.powerBarFill.setVisible(!1)}updatePowerBar(t){const{x:e,y:s,width:i,height:a}=y;this.smoothedPower=h().Math.Linear(this.smoothedPower,t,.15),this.powerBarFill.clear();const r=(this.smoothedPower-30)/70,o=a*Math.max(0,r);let l;l=r<.4?16498468:r<.75?2278750:15680580,this.powerBarFill.fillStyle(l,.9),this.powerBarFill.fillRect(e+2,s+a-o,i-4,o)}showPowerBar(){this.powerBarGraphics.setVisible(!0),this.powerBarFill.setVisible(!0)}hidePowerBar(){this.powerBarGraphics.setVisible(!1),this.powerBarFill.setVisible(!1),this.powerBarFill.clear()}drawBallTrail(){if(this.ballTrail.clear(),this.spinPoints.length<3)return;this.ballTrail.lineStyle(4,16777215,.3),this.ballTrail.beginPath();const t=this.spinPoints.slice(-15);for(let e=0;e<t.length;e++){const s=e/t.length;this.ballTrail.lineStyle(4*s,16777215,.3*s),0===e?this.ballTrail.moveTo(t[e].x,t[e].y):this.ballTrail.lineTo(t[e].x,t[e].y)}this.ballTrail.strokePath()}executeDragShot(t){this.gameState.phase="shooting",this.instructionText.setText(""),T.playKick();const e=Math.min(100,Math.max(30,t.speed/10));this.gameState.power=e;const s=this.ball.x,i=this.ball.y,a=Math.sqrt(t.x*t.x+t.y*t.y),r=t.x/a,o=t.y/a;let n=s+r*(((l.topY+l.bottomY)/2-i)/o);n=h().Math.Clamp(n,l.x-l.width/2+15,l.x+l.width/2-15);const c=-this.accumulatedSpin;if(e<35)return void this.animateFallShort(n,c);const p=l.bottomY-l.topY;let d;d=e<55?l.bottomY-p/6:e<80?l.topY+p/2:l.topY+p/6,d=h().Math.Clamp(d,l.topY+10,l.bottomY-10),this.gameState.aimPosition={x:n,y:d};const g=this.decideGoalkeeperDive(n,c),u=e>95?.25:e>90?.1:0;Math.random()<u?this.animateMiss({x:n,y:d},c):this.animateCurvedShot({x:n,y:d},e,c,g)}showStartScreen(){this.gameState.phase="start",this.instructionText.setText("Toca para comenzar\n\ud83d\udc46"),this.tweens.add({targets:this.instructionText,alpha:{from:1,to:.5},duration:800,yoyo:!0,repeat:-1})}startRound(){this.tweens.killTweensOf(this.instructionText),this.instructionText.setAlpha(1),this.currentDifficulty=f[Math.min(this.gameState.round,5)],this.startAimingPhase()}startAimingPhase(){this.gameState.phase="aiming",this.trajectoryPoints=[],this.trajectoryGraphics.clear(),this.projectionGraphics.clear(),this.isDragging=!1,this.dragStartPos=null,this.spinPoints=[],this.accumulatedSpin=0,this.spinIndicator.setAlpha(0),this.sparkSprite.setVisible(!1),this.sparkSprite.stop(),this.ballTrail.clear(),this.smoothedPower=30,this.showGoalZoneGuides(),this.showPowerBar(),this.instructionText.setText("Arrastra el bal\xf3n hacia la porter\xeda\nPuedes girar para curvar el tiro"),this.instructionText.setFontSize(18),this.gestureIndicator.setVisible(!0);this.tweens.killTweensOf(this.gestureIndicator),this.tweens.addCounter({from:0,to:360,duration:1200,repeat:-1,onUpdate:t=>{var e;const s=h().Math.DegToRad(null!==(e=t.getValue())&&void 0!==e?e:0);this.gestureIndicator.x=200+20*Math.cos(s),this.gestureIndicator.y=360+20*Math.sin(s)}});const t=this.ball.scale;this.tweens.add({targets:this.ball,scale:{from:t,to:1.15*t},duration:500,yoyo:!0,repeat:2,onComplete:()=>{this.ball.setScale(t)}})}calculateCurveDirection(){if(this.trajectoryPoints.length<3)return 0;const t=this.trajectoryPoints[0],e=this.trajectoryPoints[this.trajectoryPoints.length-1],s=Math.atan2(e.y-t.y,e.x-t.x);let i=0;const a=this.trajectoryPoints.slice(1,this.trajectoryPoints.length-1);for(const o of a){const a=h().Math.Distance.Between(t.x,t.y,o.x,o.y)/h().Math.Distance.Between(t.x,t.y,e.x,e.y),r=t.x+(e.x-t.x)*a,l=t.y+(e.y-t.y)*a,n=s+Math.PI/2;i+=(o.x-r)*Math.cos(n)+(o.y-l)*Math.sin(n)}const r=i/a.length;return h().Math.Clamp(r/50,-1,1)}decideGoalkeeperDive(t,e){const s=l.x,i=l.width/4;let a;a=t<s-i?"left":t>s+i?"right":"center";const h=.3*Math.abs(e);if(Math.random()<this.currentDifficulty.correctDiveChance-h)return a;{const t=["left","right","center"].filter(t=>t!==a);return t[Math.floor(Math.random()*t.length)]}}animateCurvedShot(t,e,s,i){const a=S*(1.8-e/150),r=this.ball.x,o=this.ball.y,l=this.ball.scale,n=(o+t.y)/2,c=80*s,p=(r+t.x)/2+c,d=n,g=new(h().Curves.QuadraticBezier)(new(h().Math.Vector2)(r,o),new(h().Math.Vector2)(p,d),new(h().Math.Vector2)(t.x,t.y));this.trajectoryGraphics.clear();const u={t:0};this.tweens.add({targets:u,t:1,duration:a,ease:"Sine.easeIn",onUpdate:()=>{const t=g.getPoint(u.t);this.ball.setPosition(t.x,t.y),this.ballShadow.setPosition(t.x,t.y+20*(1-u.t))}}),this.tweens.add({targets:this.ball,scale:{from:l,to:.6*l},duration:a,ease:"Sine.easeIn"});const y=720+360*Math.abs(s);this.tweens.add({targets:this.ball,angle:s>0?y:-y,duration:a}),this.tweens.add({targets:this.ballShadow,scale:{from:1,to:.4},alpha:{from:.3,to:.1},duration:a}),this.time.delayedCall(this.currentDifficulty.reactionSpeed,()=>{this.animateGoalkeeperDive(i)}),this.time.delayedCall(a+100,()=>{this.checkShotResult(t,i,e,s)})}animateGoalkeeperDive(t){let e=c.startX;"left"===t?(e=c.startX-c.diveDistance,this.goalkeeper.setFlipX(!0),this.goalkeeper.play("gk-dive")):"right"===t?(e=c.startX+c.diveDistance,this.goalkeeper.setFlipX(!1),this.goalkeeper.play("gk-dive")):(this.goalkeeper.setFlipX(!1),this.goalkeeper.play("gk-crouch")),this.tweens.add({targets:this.goalkeeper,x:e,duration:300,ease:"Power2"})}animateMiss(t,e){const s={x:t.x+50*e+80*(Math.random()-.5),y:t.y-80-80*Math.random()};this.trajectoryGraphics.clear(),this.projectionGraphics.clear(),this.ballTrail.clear(),this.spinIndicator.setAlpha(0),this.sparkSprite.setVisible(!1),this.sparkSprite.stop();const i=this.ball.scale;this.tweens.add({targets:this.ball,x:s.x,y:s.y,duration:600,ease:"Quad.easeOut"}),this.tweens.add({targets:this.ball,scale:{from:i,to:.3},alpha:{from:1,to:0},duration:600}),this.tweens.add({targets:this.ballShadow,alpha:0,duration:300});const a=["left","right","center"][Math.floor(3*Math.random())];this.time.delayedCall(200,()=>{this.animateGoalkeeperDive(a)}),this.time.delayedCall(700,()=>{this.showResult("miss")})}animateFallShort(t,e){const s={x:t+30*e,y:l.bottomY+60};this.trajectoryGraphics.clear(),this.projectionGraphics.clear(),this.ballTrail.clear(),this.spinIndicator.setAlpha(0),this.sparkSprite.setVisible(!1),this.sparkSprite.stop();const i=this.ball.scale;this.tweens.add({targets:this.ball,x:s.x,y:s.y,duration:500,ease:"Quad.easeOut"}),this.tweens.add({targets:this.ball,scale:{from:i,to:.4},alpha:{from:1,to:.3},duration:500}),this.tweens.add({targets:this.ballShadow,x:s.x,y:s.y+8,alpha:.3,duration:500}),this.time.delayedCall(600,()=>{this.showResult("miss")})}checkShotResult(t,e,s,i){const a=l.x,h=l.width/4;let r;if(r=t.x<a-h?"left":t.x>a+h?"right":"center",e===r){var o;const a="left"===e?c.startX-c.diveDistance:"right"===e?c.startX+c.diveDistance:c.startX,h=Math.abs(t.x-a),r=c.width*(1+this.currentDifficulty.saveCoverage),n=Math.max(.5,1-(s-50)/100),p=Math.abs(i),d=(null!==(o=l.topY)&&void 0!==o?o:l.y-l.height/2)+l.height/4;if(h<r*n*(1.2-.6*p)*(t.y<d&&(t.x<l.x-l.width/3||t.x>l.x+l.width/3)?.5:1))return void this.showResult("save")}this.showResult("goal")}showResult(t){this.gameState.phase="result",this.gameState.lastResult=t,"goal"===t?T.playGoal():"save"===t?T.playSave():T.playMiss();let e=0;const s={corner:!1,curve:!1,streak:0};if("goal"===t){var i;e=p;const t=this.gameState.aimPosition,a=(null!==(i=l.topY)&&void 0!==i?i:l.y-l.height/2)+l.height/4;t.y<a&&(t.x<l.x-l.width/3||t.x>l.x+l.width/3)&&(e+=d,s.corner=!0);if(Math.abs(this.calculateCurveDirection())>.5&&(e+=g,s.curve=!0),this.gameState.consecutiveGoals++,this.gameState.consecutiveGoals>1){e+=(this.gameState.consecutiveGoals-1)*u,s.streak=this.gameState.consecutiveGoals}this.gameState.goals++,this.gameState.totalScore+=e}else this.gameState.consecutiveGoals=0;const a=this.gameState.round-1;if(a<this.goalIndicators.length){let e=6710886;e="goal"===t?2278750:"save"===t?16498468:15680580,this.goalIndicators[a].setFillStyle(e,1),this.shotResults[a]=t}let h="",r="#ffffff";if("goal"===t){h="\xa1GOL!",r="#22c55e";let t="";s.corner&&(t+="\n+50 Esquina"),s.curve&&(t+="\n+25 Curva"),s.streak>1&&(t+="\n+".concat(10*(s.streak-1)," Racha x").concat(s.streak)),t&&(h+=t)}else"save"===t?(h="\xa1Atajada!",r="#fbbf24"):(h="\xa1Fallaste!",r="#ef4444");this.resultText.setText(h),this.resultText.setColor(r),this.resultText.setVisible(!0),this.tweens.killTweensOf(this.resultText),this.resultText.setScale(0),this.resultText.setAlpha(1),"goal"===t?this.tweens.add({targets:this.resultText,scale:{from:0,to:1.3},duration:250,ease:"Back.easeOut",onComplete:()=>{this.tweens.add({targets:this.resultText,scale:1,duration:150,ease:"Sine.easeInOut",onComplete:()=>{this.tweens.add({targets:this.resultText,scale:{from:1,to:1.1},duration:300,yoyo:!0,repeat:2,ease:"Sine.easeInOut"})}})}}):"save"===t?(this.resultText.setX(500),this.resultText.setScale(1),this.tweens.add({targets:this.resultText,x:200,duration:300,ease:"Back.easeOut",onComplete:()=>{this.tweens.add({targets:this.resultText,alpha:{from:1,to:.7},duration:200,yoyo:!0,repeat:2})}})):(this.resultText.setScale(1),this.tweens.add({targets:this.resultText,scale:{from:.5,to:1},duration:200,ease:"Elastic.easeOut",onComplete:()=>{this.tweens.add({targets:this.resultText,x:{from:190,to:210},duration:50,yoyo:!0,repeat:4,onComplete:()=>{this.resultText.setX(200)}})}}));const o=this.registry.get("onScoreUpdate");o&&o(this.gameState.totalScore);const n=this.registry.get("onRoundComplete");n&&n(this.gameState.round,t),this.time.delayedCall(m,()=>{this.tweens.killTweensOf(this.resultText),this.resultText.setVisible(!1),this.resultText.setScale(1),this.resultText.setX(200),this.resultText.setAlpha(1),this.gameState.round>=this.totalRounds?this.endGame():(this.gameState.round++,this.resetForNextRound())})}resetForNextRound(){const t=1.5*n.radius/this.ball.width;this.ball.setPosition(n.startX,n.startY),this.ball.setScale(t),this.ball.setAlpha(1),this.ball.setAngle(0),this.ballShadow.setPosition(n.startX,n.startY+8),this.ballShadow.setScale(1),this.ballShadow.setAlpha(.3),this.goalkeeper.setPosition(c.startX,c.startY+c.height/2),this.goalkeeper.setFlipX(!1),this.goalkeeper.play("gk-idle"),this.trajectoryPoints=[],this.trajectoryGraphics.clear(),this.projectionGraphics.clear(),this.ballTrail.clear(),this.spinIndicator.setAlpha(0),this.sparkSprite.setVisible(!1),this.sparkSprite.stop(),this.goalZoneGraphics.setAlpha(0),this.isDragging=!1,this.dragStartPos=null,this.spinPoints=[],this.accumulatedSpin=0,this.tweens.killTweensOf(this.gestureIndicator),this.gestureIndicator.setVisible(!1),this.gameState.aimPosition=null,this.updateUI(),this.startRound()}endGame(){this.gameState.phase="gameover";const t=this.gameState.goals,e=this.gameState.totalScore;let s="",i="#ffffff";t>=3?5===t?(s="\xa1VICTORIA PERFECTA!\n\u26bd\u26bd\u26bd\u26bd\u26bd",i="#fbbf24"):4===t?(s="\xa1GRAN VICTORIA!\n\u26bd\u26bd\u26bd\u26bd",i="#22c55e"):(s="\xa1VICTORIA!\n\u26bd\u26bd\u26bd",i="#22c55e"):(s="DERROTA\n".concat(t,"/5 goles"),i="#ef4444"),s+="\n\nPuntos: ".concat(e),this.resultText.setText(s),this.resultText.setColor(i),this.resultText.setFontSize(28),this.resultText.setVisible(!0),this.instructionText.setText("Toca para continuar"),this.instructionText.setY(520);const a=this.registry.get("onGameOver");a&&a(t,e)}update(t,e){}}var P=s(579);const M=t=>{let{onScoreUpdate:e,onRoundComplete:s,onGameOver:a,onPhaseChange:l,brandColor:n,totalRounds:c=5,skin:p}=t;const d=(0,i.useRef)(null),g=(0,i.useRef)(null),u=(0,i.useCallback)(t=>{e(t)},[e]),y=(0,i.useCallback)((t,e)=>{s(t,e)},[s]),f=(0,i.useCallback)((t,e)=>{a(t,e)},[a]),m=(0,i.useCallback)(t=>{l&&l(t)},[l]);return(0,i.useEffect)(()=>{if(!d.current||g.current)return;const t={type:h().AUTO,parent:d.current,width:r,height:o,backgroundColor:n?parseInt(n.replace("#","0x")):w,physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scene:[b,v],scale:{mode:h().Scale.FIT,autoCenter:h().Scale.CENTER_BOTH},render:{pixelArt:!1,antialias:!0},input:{activePointers:1}};return g.current=new(h().Game)(t),g.current.registry.set("onScoreUpdate",u),g.current.registry.set("onRoundComplete",y),g.current.registry.set("onGameOver",f),g.current.registry.set("onPhaseChange",m),g.current.registry.set("brandColor",n),g.current.registry.set("totalRounds",c),g.current.registry.set("skin",p),()=>{g.current&&(g.current.destroy(!0),g.current=null)}},[u,y,f,m,n,c,p]),(0,P.jsx)("div",{ref:d,className:"w-full h-full flex items-center justify-center",style:{touchAction:"none",userSelect:"none"}})}}}]);
//# sourceMappingURL=849.63dc0dfd.chunk.js.map