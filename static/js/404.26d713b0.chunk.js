"use strict";(self.webpackChunkmawmawmaw=self.webpackChunkmawmawmaw||[]).push([[404],{8404:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var i=s(5043),o=s(1289),a=s.n(o),r=s(4224);class n extends a().Scene{constructor(){super({key:"BootScene"})}preload(){const e=this.add.graphics(),t=this.add.graphics();t.fillStyle(2236962,.8),t.fillRect(r.CG/2-160,r.pF/2-25,320,50);const s=this.add.text(r.CG/2,r.pF/2-50,"Cargando...",{fontFamily:'"Luckiest Guy", Arial, sans-serif',fontSize:"24px",color:"#ffffff"});s.setOrigin(.5,.5),s.setResolution(Math.min(window.devicePixelRatio||1,2)),this.load.on("progress",t=>{e.clear(),e.fillStyle(r.Nl[3],1),e.fillRect(r.CG/2-150,r.pF/2-15,300*t,30)}),this.load.on("complete",()=>{e.destroy(),t.destroy(),s.destroy()});const i=this.registry.get("skin"),o="/games/candy-crush/sprites/",a=i?"skins/".concat(i,"/"):"";this.load.spritesheet("candies","".concat(o).concat(a,"candies.webp"),{frameWidth:84,frameHeight:84}),this.load.spritesheet("particles","".concat(o).concat(a,"particles.webp"),{frameWidth:128,frameHeight:128})}create(){const e=this.textures.exists("candies");this.registry.set("useProcedural",!e),e||this.generateProceduralCandies(),this.textures.exists("particles")||this.generateParticleTexture(),this.scene.start("MainScene")}generateProceduralCandies(){const e=this.make.graphics({x:0,y:0});for(let t=0;t<r.Nl.length;t++){e.clear();const s=r.Nl[t];e.fillStyle(s,.3),e.fillCircle(32,32,30),e.fillStyle(s,1),e.fillCircle(32,32,26),e.fillStyle(16777215,.4),e.fillCircle(26,26,10),e.fillStyle(16777215,.6),e.fillCircle(24,24,5),e.generateTexture("candy-".concat(t),64,64)}e.destroy()}generateParticleTexture(){const e=this.make.graphics({x:0,y:0});e.fillStyle(16777215,1),e.fillCircle(8,8,6),e.fillStyle(16777215,.5),e.fillCircle(8,8,8),e.generateTexture("particle",16,16),e.destroy()}}class l extends a().Scene{constructor(){super({key:"MainScene"}),this.grid=[],this.gridContainer=void 0,this.levelConfig=void 0,this.candyTypes=void 0,this.gameState=void 0,this.selectedCandy=null,this.isAnimating=!1,this.useProcedural=!1,this.scoreText=void 0,this.movesText=void 0,this.targetText=void 0,this.progressBar=void 0,this.chainIndicator=void 0,this.onScoreUpdate=void 0,this.onMovesUpdate=void 0,this.onGameComplete=void 0,this.onPhaseChange=void 0,this.selectionIndicator=void 0,this.audio=void 0}create(){this.onScoreUpdate=this.registry.get("onScoreUpdate")||(()=>{}),this.onMovesUpdate=this.registry.get("onMovesUpdate")||(()=>{}),this.onGameComplete=this.registry.get("onGameComplete")||(()=>{}),this.onPhaseChange=this.registry.get("onPhaseChange")||(()=>{}),this.useProcedural=this.registry.get("useProcedural")||!1,this.audio=this.registry.get("audioManager"),this.levelConfig=this.registry.get("levelConfig")||r.A_[0],this.candyTypes=this.levelConfig.candyTypes,this.gameState={phase:"playing",score:0,moves:this.levelConfig.moves,targetScore:this.levelConfig.targetScore,livesRemaining:this.registry.get("lives")||3,chainLevel:0,lastMatchPoints:0},this.createBackground(),this.createUI(),this.createGrid(),this.fillGridWithCandies(),this.removeInitialMatches(),this.setupInput(),this.onMovesUpdate(this.gameState.moves),this.onScoreUpdate(this.gameState.score),this.onPhaseChange("playing")}createBackground(){const e=this.add.graphics();e.fillStyle(r.lm.background,1),e.fillRect(0,0,r.CG,r.pF);const t=this.add.graphics();t.fillStyle(r.lm.gridBackground,1),t.fillRoundedRect(r.Z.offsetX-10,r.Z.offsetY-10,r.eZ+20,r.eZ+20,15),t.lineStyle(3,r.lm.gridBorder,1),t.strokeRoundedRect(r.Z.offsetX-10,r.Z.offsetY-10,r.eZ+20,r.eZ+20,15)}createUI(){const e='"Luckiest Guy", Arial, sans-serif',t=Math.min(window.devicePixelRatio||1,2);this.createHeaderPanel(),this.targetText=this.add.text(r.UI.targetDisplay.x,r.UI.targetDisplay.y,"",{fontFamily:e,fontSize:"24px",color:"#ffffff",align:"center"}),this.targetText.setOrigin(.5,.5),this.targetText.setResolution(t),this.updateTargetDisplay(),this.scoreText=this.add.text(r.UI.scoreDisplay.x,r.UI.scoreDisplay.y,"0",{fontFamily:e,fontSize:"28px",color:"#ffd700",align:"center"}),this.scoreText.setOrigin(.5,.5),this.scoreText.setResolution(t),this.movesText=this.add.text(r.UI.movesDisplay.x,r.UI.movesDisplay.y,"",{fontFamily:e,fontSize:"24px",color:"#ffffff",align:"center"}),this.movesText.setOrigin(.5,.5),this.movesText.setResolution(t),this.updateMovesDisplay(),this.progressBar=this.add.graphics(),this.updateProgressBar();const s=r.Z.offsetY+r.eZ;this.chainIndicator=this.add.text(r.CG/2,s+45,"",{fontFamily:e,fontSize:"32px",color:"#ffffff",align:"center",stroke:"#000000",strokeThickness:4}),this.chainIndicator.setOrigin(.5,.5),this.chainIndicator.setResolution(t),this.chainIndicator.setAlpha(0),this.selectionIndicator=this.add.graphics(),this.selectionIndicator.setDepth(10)}createHeaderPanel(){const e=this.add.graphics();e.fillStyle(r.lm.headerPanel,1),e.fillRoundedRect(r.UI.header.x,r.UI.header.y,r.UI.header.width,r.UI.header.height,r.UI.header.borderRadius),e.fillStyle(16777215,.05),e.fillRoundedRect(r.UI.header.x+2,r.UI.header.y+2,r.UI.header.width-4,20,{tl:r.UI.header.borderRadius-2,tr:r.UI.header.borderRadius-2,bl:0,br:0}),e.lineStyle(2,r.lm.headerBorder,1),e.strokeRoundedRect(r.UI.header.x,r.UI.header.y,r.UI.header.width,r.UI.header.height,r.UI.header.borderRadius);const t=r.UI.header.y+r.UI.header.padding,s=r.UI.statCard.height;this.createStatCard(e,r.UI.header.x+r.UI.header.padding,t,r.UI.statCard.width,s,r.lm.targetAccent,"META");const i=r.UI.statCard.width+20;this.createStatCard(e,r.CG/2-i/2,t,i,s,r.lm.scoreAccent,"PUNTOS"),this.createStatCard(e,r.UI.header.x+r.UI.header.width-r.UI.header.padding-r.UI.statCard.width,t,r.UI.statCard.width,s,r.lm.movesAccent,"TURNOS")}createStatCard(e,t,s,i,o,a,n){const l=Math.min(window.devicePixelRatio||1,2),c=r.UI.statCard.accentHeight;e.fillStyle(r.lm.statCardBg,.8),e.fillRoundedRect(t,s,i,o,r.UI.statCard.borderRadius),e.fillStyle(a,1),e.fillRoundedRect(t,s,i,c,{tl:r.UI.statCard.borderRadius,tr:r.UI.statCard.borderRadius,bl:0,br:0}),e.lineStyle(1,a,.3),e.strokeRoundedRect(t,s,i,o,r.UI.statCard.borderRadius);const h=this.add.text(t+i/2,s+c/2,n,{fontFamily:'"Luckiest Guy", Arial, sans-serif',fontSize:"11px",color:"#1a1a2e",align:"center"});h.setOrigin(.5,.5),h.setResolution(l)}updateTargetDisplay(){this.targetText.setText("".concat(this.gameState.targetScore))}updateMovesDisplay(){this.movesText.setText("".concat(this.gameState.moves))}updateProgressBar(){this.progressBar.clear();const e=r.UI.progressBar.borderRadius;this.progressBar.fillStyle(657941,1),this.progressBar.fillRoundedRect(r.UI.progressBar.x,r.UI.progressBar.y,r.UI.progressBar.width,r.UI.progressBar.height,e);const t=Math.min(this.gameState.score/this.gameState.targetScore,1);if(t>0){const s=Math.max(r.UI.progressBar.width*t,2*e),i=t>=1?5025616:r.lm.targetAccent;this.progressBar.fillStyle(i,1),this.progressBar.fillRoundedRect(r.UI.progressBar.x,r.UI.progressBar.y,s,r.UI.progressBar.height,e),this.progressBar.fillStyle(16777215,.2),this.progressBar.fillRoundedRect(r.UI.progressBar.x,r.UI.progressBar.y,s,r.UI.progressBar.height/2,{tl:e,tr:e,bl:0,br:0})}this.progressBar.lineStyle(1,r.lm.headerBorder,.5),this.progressBar.strokeRoundedRect(r.UI.progressBar.x,r.UI.progressBar.y,r.UI.progressBar.width,r.UI.progressBar.height,e)}createGrid(){this.gridContainer=this.add.container(r.Z.offsetX,r.Z.offsetY),this.grid=[];for(let e=0;e<r.Z.size;e++){this.grid[e]=[];for(let t=0;t<r.Z.size;t++)this.grid[e][t]=null}}fillGridWithCandies(){for(let e=0;e<r.Z.size;e++)for(let t=0;t<r.Z.size;t++){const s=this.createCandy(e,t);this.grid[e][t]=s}}createCandy(e,t,s,i){const o=this.levelConfig.bombConfig;let n,l=!1,c=i;c?l=!0:o&&void 0===s&&Math.random()<o.spawnChance&&(l=!0,c=Math.random()<.5?"cross":"radius"),n=l&&c?-1:void 0!==s?s:a().Math.Between(0,this.candyTypes-1);const h=t*(r.Z.cellSize+r.Z.gap)+r.Z.cellSize/2,d=e*(r.Z.cellSize+r.Z.gap)+r.Z.cellSize/2;let p;if(l&&c){const e=r.eU[c];p=this.add.sprite(h,d,"candies",e)}else p=this.useProcedural?this.add.sprite(h,d,"candy-".concat(n)):this.add.sprite(h,d,"candies",n);p.setDisplaySize(r.qn.displaySize,r.qn.displaySize),p.setInteractive(),this.gridContainer.add(p);return{row:e,col:t,type:n,sprite:p,isBomb:l,bombType:c}}removeInitialMatches(){let e=0;for(;e<100;){const t=this.findAllMatches();if(0===t.length)break;for(const e of t)for(const t of e.cells){const e=this.grid[t.row][t.col];if(e&&!e.isBomb){const s=this.findNonMatchingType(t.row,t.col);e.type=s,e.sprite&&(this.useProcedural?e.sprite.setTexture("candy-".concat(s)):e.sprite.setFrame(s))}}e++}}findNonMatchingType(e,t){const s=new Set;if(t>=2){const i=this.grid[e][t-1],o=this.grid[e][t-2];i&&o&&i.type===o.type&&s.add(i.type)}if(e>=2){const i=this.grid[e-1][t],o=this.grid[e-2][t];i&&o&&i.type===o.type&&s.add(i.type)}const i=[];for(let o=0;o<this.candyTypes;o++)s.has(o)||i.push(o);return i.length>0?i[a().Math.Between(0,i.length-1)]:a().Math.Between(0,this.candyTypes-1)}setupInput(){let e=null;this.input.on("pointerdown",t=>{if(this.isAnimating||"playing"!==this.gameState.phase)return;const s=this.getCellFromPointer(t);if(s){const t=this.grid[s.row][s.col];t&&(this.selectedCandy&&this.selectedCandy!==t&&this.clearSelection(),e=t,this.selectCandy(t))}}),this.input.on("pointermove",t=>{if(!t.isDown||this.isAnimating||!e)return;if("playing"!==this.gameState.phase)return;const s=this.getCellFromPointer(t);if(s){const t=this.grid[s.row][s.col];t&&t!==e&&this.isAdjacent(e,t)&&(this.clearSelection(),this.trySwap(e,t),e=null)}}),this.input.on("pointerup",()=>{e&&this.clearSelection(),e=null})}getCellFromPointer(e){const t=e.x-r.Z.offsetX,s=e.y-r.Z.offsetY,i=Math.floor(t/(r.Z.cellSize+r.Z.gap)),o=Math.floor(s/(r.Z.cellSize+r.Z.gap));return o>=0&&o<r.Z.size&&i>=0&&i<r.Z.size?{row:o,col:i}:null}isAdjacent(e,t){const s=Math.abs(e.row-t.row),i=Math.abs(e.col-t.col);return 1===s&&0===i||0===s&&1===i}selectCandy(e){var t;this.selectedCandy=e,null===(t=this.audio)||void 0===t||t.playSelect(),this.selectionIndicator.clear(),this.selectionIndicator.lineStyle(3,16777215,1);const s=r.Z.offsetX+e.col*(r.Z.cellSize+r.Z.gap),i=r.Z.offsetY+e.row*(r.Z.cellSize+r.Z.gap);this.selectionIndicator.strokeRoundedRect(s,i,r.Z.cellSize,r.Z.cellSize,8),e.sprite&&this.tweens.add({targets:e.sprite,scale:r.qn.baseScale*r.Rs.selectScale,duration:r.Rs.selectDuration,ease:"Back.easeOut"})}clearSelection(){var e;null!==(e=this.selectedCandy)&&void 0!==e&&e.sprite&&this.tweens.add({targets:this.selectedCandy.sprite,scale:r.qn.baseScale,duration:r.Rs.selectDuration,ease:"Back.easeIn"}),this.selectedCandy=null,this.selectionIndicator.clear()}async trySwap(e,t){this.isAnimating=!0,this.gameState.phase="animating",await this.animateSwap(e,t),this.swapInGrid(e,t);const s=this.findMatchesAtPositions([{row:e.row,col:e.col},{row:t.row,col:t.col}]);var i;s.length>0?(this.decrementMoves(),await this.processMatches(s),this.checkGameEnd()):(null===(i=this.audio)||void 0===i||i.playInvalidMove(),await this.animateSwap(e,t),this.swapInGrid(e,t));this.isAnimating=!1,"animating"===this.gameState.phase&&(this.gameState.phase="playing")}swapInGrid(e,t){this.grid[e.row][e.col]=t,this.grid[t.row][t.col]=e;const s=e.row,i=e.col;e.row=t.row,e.col=t.col,t.row=s,t.col=i}async animateSwap(e,t){var s;return null===(s=this.audio)||void 0===s||s.playSwap(),new Promise(s=>{const i=e.col*(r.Z.cellSize+r.Z.gap)+r.Z.cellSize/2,o=e.row*(r.Z.cellSize+r.Z.gap)+r.Z.cellSize/2,a=t.col*(r.Z.cellSize+r.Z.gap)+r.Z.cellSize/2,n=t.row*(r.Z.cellSize+r.Z.gap)+r.Z.cellSize/2;let l=0;const c=()=>{l++,2===l&&s()};e.sprite?this.tweens.add({targets:e.sprite,x:a,y:n,duration:r.Rs.swapDuration,ease:"Quad.easeOut",onComplete:c}):c(),t.sprite?this.tweens.add({targets:t.sprite,x:i,y:o,duration:r.Rs.swapDuration,ease:"Quad.easeOut",onComplete:c}):c()})}findAllMatches(){const e=[];for(let t=0;t<r.Z.size;t++){let s=0,i=1;for(let o=1;o<=r.Z.size;o++){const a=o<r.Z.size?this.grid[t][o]:null,n=this.grid[t][o-1];if(a&&n&&a.type===n.type)i++;else{if(i>=3&&n){const o=[];for(let e=s;e<s+i;e++)o.push({row:t,col:e});e.push({cells:o,type:"horizontal",length:i})}s=o,i=1}}}for(let t=0;t<r.Z.size;t++){let s=0,i=1;for(let o=1;o<=r.Z.size;o++){const a=o<r.Z.size?this.grid[o][t]:null,n=this.grid[o-1][t];if(a&&n&&a.type===n.type)i++;else{if(i>=3&&n){const o=[];for(let e=s;e<s+i;e++)o.push({row:e,col:t});e.push({cells:o,type:"vertical",length:i})}s=o,i=1}}}return this.mergeIntersectingMatches(e)}findMatchesAtPositions(e){const t=[];for(const s of e){const e=this.grid[s.row][s.col];if(e)if(e.isBomb){const e=this.findBombHorizontalMatch(s.row,s.col);if(e.length>=3){const i=e.map(e=>({row:s.row,col:e}));t.push({cells:i,type:"horizontal",length:e.length})}const i=this.findBombVerticalMatch(s.row,s.col);if(i.length>=3){const e=i.map(e=>({row:e,col:s.col}));t.push({cells:e,type:"vertical",length:i.length})}}else{const i=this.findHorizontalMatch(s.row,s.col,e.type);if(i.length>=3){const e=i.map(e=>({row:s.row,col:e}));t.push({cells:e,type:"horizontal",length:i.length})}const o=this.findVerticalMatch(s.row,s.col,e.type);if(o.length>=3){const e=o.map(e=>({row:e,col:s.col}));t.push({cells:e,type:"vertical",length:o.length})}}}return this.mergeIntersectingMatches(t)}findBombHorizontalMatch(e,t){let s=-2;if(t>0&&this.grid[e][t-1]&&!this.grid[e][t-1].isBomb?s=this.grid[e][t-1].type:t<r.Z.size-1&&this.grid[e][t+1]&&!this.grid[e][t+1].isBomb&&(s=this.grid[e][t+1].type),s<0)return[t];const i=[t];let o=t-1;for(;o>=0;){const t=this.grid[e][o];if(!t||t.type!==s&&!t.isBomb)break;i.unshift(o),o--}for(o=t+1;o<r.Z.size;){const t=this.grid[e][o];if(!t||t.type!==s&&!t.isBomb)break;i.push(o),o++}return i}findBombVerticalMatch(e,t){let s=-2;if(e>0&&this.grid[e-1][t]&&!this.grid[e-1][t].isBomb?s=this.grid[e-1][t].type:e<r.Z.size-1&&this.grid[e+1][t]&&!this.grid[e+1][t].isBomb&&(s=this.grid[e+1][t].type),s<0)return[e];const i=[e];let o=e-1;for(;o>=0;){const e=this.grid[o][t];if(!e||e.type!==s&&!e.isBomb)break;i.unshift(o),o--}for(o=e+1;o<r.Z.size;){const e=this.grid[o][t];if(!e||e.type!==s&&!e.isBomb)break;i.push(o),o++}return i}findHorizontalMatch(e,t,s){const i=[t];let o=t-1;for(;o>=0&&(null===(a=this.grid[e][o])||void 0===a?void 0:a.type)===s;){var a;i.unshift(o),o--}for(o=t+1;o<r.Z.size&&(null===(n=this.grid[e][o])||void 0===n?void 0:n.type)===s;){var n;i.push(o),o++}return i}findVerticalMatch(e,t,s){const i=[e];let o=e-1;for(;o>=0&&(null===(a=this.grid[o][t])||void 0===a?void 0:a.type)===s;){var a;i.unshift(o),o--}for(o=e+1;o<r.Z.size&&(null===(n=this.grid[o][t])||void 0===n?void 0:n.type)===s;){var n;i.push(o),o++}return i}mergeIntersectingMatches(e){if(e.length<=1)return e;const t=[],s=new Set;for(let i=0;i<e.length;i++){if(s.has(i))continue;const o=e[i];let a=!1;for(let r=i+1;r<e.length;r++){if(s.has(r))continue;const n=e[r];if("horizontal"===o.type&&"vertical"===n.type||"vertical"===o.type&&"horizontal"===n.type){if(this.findIntersection(o,n)){const e=new Map;for(const t of o.cells)e.set("".concat(t.row,",").concat(t.col),t);for(const t of n.cells)e.set("".concat(t.row,",").concat(t.col),t);const l=Array.from(e.values()),c=o.length>=3&&n.length>=3&&(o.length>3||n.length>3);t.push({cells:l,type:c?"t-shape":"l-shape",length:l.length}),s.add(i),s.add(r),a=!0;break}}}a||(t.push(o),s.add(i))}return t}findIntersection(e,t){for(const s of e.cells)for(const e of t.cells)if(s.row===e.row&&s.col===e.col)return s;return null}matchesOverlap(e,t){for(const s of e.cells)for(const e of t.cells)if(s.row===e.row&&s.col===e.col)return!0;return!1}getCrossBombCells(e){const t=[],s=new Set;for(let i=0;i<r.Z.size;i++){const o="".concat(e.row,",").concat(i);s.has(o)||(t.push({row:e.row,col:i}),s.add(o))}for(let i=0;i<r.Z.size;i++){const o="".concat(i,",").concat(e.col);s.has(o)||(t.push({row:i,col:e.col}),s.add(o))}return t}getRadiusBombCells(e){const t=[];for(let s=-1;s<=1;s++)for(let i=-1;i<=1;i++){const o=e.row+s,a=e.col+i;o>=0&&o<r.Z.size&&a>=0&&a<r.Z.size&&t.push({row:o,col:a})}return t}showBombExplosion(e){var t;if(null===(t=this.audio)||void 0===t||t.playBombExplode(e.bombType),!e.sprite)return;const s=e.sprite.x+r.Z.offsetX,i=e.sprite.y+r.Z.offsetY,o=this.add.graphics();o.setPosition(s,i),o.fillStyle(16777215,.8),o.fillCircle(0,0,20),this.tweens.add({targets:o,scale:"cross"===e.bombType?4:2.5,alpha:0,duration:400,ease:"Quad.easeOut",onComplete:()=>o.destroy()});const a="cross"===e.bombType?16:12;for(let r=0;r<a;r++){const t=r/a*Math.PI*2,o="cross"===e.bombType?80:50,n=this.add.graphics();n.fillStyle(16766720,1),n.fillCircle(0,0,6),n.setPosition(s,i),this.tweens.add({targets:n,x:s+Math.cos(t)*o,y:i+Math.sin(t)*o,alpha:0,scale:0,duration:500,ease:"Quad.easeOut",onComplete:()=>n.destroy()})}}calculateBombScore(e,t){return("cross"===e.bombType?r.Zf.crossActivation:r.Zf.radiusActivation)+t*r.Zf.perCandyCleared}async processMatches(e){let t=1;for(;e.length>0;){var s;t>1&&this.showChainIndicator(t);const i=[];for(const t of e)for(const e of t.cells){const t=this.grid[e.row][e.col];null!==t&&void 0!==t&&t.isBomb&&i.push(t)}const o=new Map;for(const t of e)for(const e of t.cells)o.set("".concat(e.row,",").concat(e.col),e);const a=new Set,r=[...i];let n=0;for(;r.length>0;){const e=r.shift(),t="".concat(e.row,",").concat(e.col);if(a.has(t))continue;a.add(t),this.showBombExplosion(e);const s="cross"===e.bombType?this.getCrossBombCells(e):this.getRadiusBombCells(e);for(const i of s){const e="".concat(i.row,",").concat(i.col);if(!o.has(e)){o.set(e,i);const t=this.grid[i.row][i.col];null!==t&&void 0!==t&&t.isBomb&&!a.has("".concat(t.row,",").concat(t.col))&&r.push(t)}}n+=this.calculateBombScore(e,s.length)}const l=this.calculateMatchPoints(e,t);this.addScore(l+n);const c=Math.max(...e.map(e=>e.length));null===(s=this.audio)||void 0===s||s.playMatchSound(c);const h=Array.from(o.values()),d={cells:h,type:"horizontal",length:h.length},p=this.checkForBombReward(e);await this.animateMatches([d]),this.removeMatches([d]),await this.dropCandies(),await this.fillEmptyCells(p),e=this.findAllMatches(),t++}this.gameState.chainLevel=t-1,await this.checkAndShuffleIfNeeded()}checkForBombReward(e){const t=this.levelConfig.bombConfig;if(!t)return null;for(const s of e)if(s.length>=4&&Math.random()<t.matchSpawnChance){const e=s.length>=5?"cross":"radius",t=Math.floor(s.cells.length/2),i=s.cells[t];return{row:i.row,col:i.col,bombType:e}}return null}calculateMatchPoints(e,t){let s=0;for(const i of e)3===i.length?s+=r.m1.match3:4===i.length?s+=r.m1.match4:i.length>=5&&(s+=r.m1.match5),"l-shape"!==i.type&&"t-shape"!==i.type||(s+=r.m1.matchLT-r.m1.match3);return t>1&&(s+=r.m1.chainBonus*(t-1)),s}async animateMatches(e){const t=[],s=new Set;for(const i of e)for(const e of i.cells){const i="".concat(e.row,",").concat(e.col);if(s.has(i))continue;s.add(i);const o=this.grid[e.row][e.col];o&&t.push(this.animateClearCandy(o))}await Promise.all(t)}async animateClearCandy(e){return new Promise(t=>{e.sprite?(this.createMatchParticles(e),this.tweens.add({targets:e.sprite,scale:0,alpha:0,duration:r.Rs.clearDuration,ease:"Back.easeIn",onComplete:()=>t()})):t()})}createMatchParticles(e){if(!e.sprite)return;const t=r.Nl[e.type],s=this.textures.exists("particles");for(let i=0;i<6;i++){const o=e.sprite.x+r.Z.offsetX,n=e.sprite.y+r.Z.offsetY,l=i/6*Math.PI*2,c=30+20*Math.random();if(s){const e=a().Math.Between(0,8),s=this.add.sprite(o,n,"particles",e);s.setTint(t),s.setScale(.4),this.tweens.add({targets:s,x:o+Math.cos(l)*c,y:n+Math.sin(l)*c,alpha:0,scale:0,duration:400,ease:"Quad.easeOut",onComplete:()=>s.destroy()})}else{const e=this.add.graphics();e.fillStyle(t,1),e.fillCircle(0,0,4),e.x=o,e.y=n,this.tweens.add({targets:e,x:o+Math.cos(l)*c,y:n+Math.sin(l)*c,alpha:0,scale:0,duration:400,ease:"Quad.easeOut",onComplete:()=>e.destroy()})}}}removeMatches(e){const t=new Set;for(const s of e)for(const e of s.cells){const s="".concat(e.row,",").concat(e.col);if(t.has(s))continue;t.add(s);const i=this.grid[e.row][e.col];i&&(this.destroyCandy(i),this.grid[e.row][e.col]=null)}}destroyCandy(e){e.sprite&&(e.sprite.destroy(),e.sprite=null)}async dropCandies(){const e=[];for(let t=0;t<r.Z.size;t++){let s=r.Z.size-1;for(let i=r.Z.size-1;i>=0;i--){const o=this.grid[i][t];if(o){if(i!==s){this.grid[s][t]=o,this.grid[i][t]=null,o.row=s;const a=s-i;e.push(this.animateDrop(o,a))}s--}}}await Promise.all(e)}async animateDrop(e,t){return new Promise(s=>{if(!e.sprite)return void s();const i=e.row*(r.Z.cellSize+r.Z.gap)+r.Z.cellSize/2;this.tweens.add({targets:e.sprite,y:i,duration:r.Rs.dropDurationPerRow*t,ease:"Bounce.easeOut",onComplete:()=>s()})})}async fillEmptyCells(e){const t=[];for(let s=0;s<r.Z.size;s++){const i=[];for(let e=0;e<r.Z.size;e++)this.grid[e][s]||i.push(e);for(let o=i.length-1;o>=0;o--){const a=i[o],n=i.length-o;let l;if(l=e&&e.row===a&&e.col===s?this.createCandy(a,s,void 0,e.bombType):this.createCandy(a,s),this.grid[a][s]=l,l.sprite){const e=-r.Z.cellSize*n-r.Z.cellSize/2;l.sprite.y=e,t.push(this.animateFill(l,n))}}}await Promise.all(t)}async animateFill(e,t){return new Promise(s=>{if(!e.sprite)return void s();const i=e.row*(r.Z.cellSize+r.Z.gap)+r.Z.cellSize/2;this.tweens.add({targets:e.sprite,y:i,duration:r.Rs.dropDurationPerRow*(e.row+t+1),ease:"Bounce.easeOut",delay:50*t,onComplete:()=>s()})})}decrementMoves(){this.gameState.moves--,this.updateMovesDisplay(),this.onMovesUpdate(this.gameState.moves)}addScore(e){this.gameState.score+=e,this.scoreText.setText(this.gameState.score.toString()),this.updateProgressBar(),this.onScoreUpdate(this.gameState.score),this.showScorePopup(e)}showScorePopup(e){var t;null===(t=this.audio)||void 0===t||t.playScorePopup();const s=this.add.text(r.CG/2,r.pF/2,"+".concat(e),{fontFamily:'"Luckiest Guy", Arial, sans-serif',fontSize:"36px",color:"#ffd700",stroke:"#000000",strokeThickness:4});s.setOrigin(.5,.5),s.setDepth(100),s.setResolution(Math.min(window.devicePixelRatio||1,2)),this.tweens.add({targets:s,y:s.y-50,alpha:0,scale:1.5,duration:r.Rs.scorePopupDuration,ease:"Quad.easeOut",onComplete:()=>s.destroy()})}showChainIndicator(e){var t;null===(t=this.audio)||void 0===t||t.playCombo(e),this.chainIndicator.setText("\xa1Combo x".concat(e,"!")),this.chainIndicator.setAlpha(1),this.tweens.add({targets:this.chainIndicator,alpha:0,duration:r.Rs.chainIndicatorDuration,ease:"Quad.easeIn"})}checkGameEnd(){if(this.gameState.score>=this.gameState.targetScore){var e;const t=this.gameState.moves*r.m1.movesBonus;t>0&&(this.addScore(t),this.showMovesBonus(t)),this.gameState.phase="result",this.onPhaseChange("result"),null===(e=this.audio)||void 0===e||e.playWin(),this.onGameComplete(!0,this.gameState.score)}else if(this.gameState.moves<=0){var t;this.gameState.phase="result",this.onPhaseChange("result"),null===(t=this.audio)||void 0===t||t.playLose(),this.onGameComplete(!1,this.gameState.score)}}showMovesBonus(e){const t=this.add.text(r.CG/2,r.pF/2-40,"\xa1Bonus por turnos!\n+".concat(e),{fontFamily:'"Luckiest Guy", Arial, sans-serif',fontSize:"28px",color:"#4caf50",align:"center",stroke:"#000000",strokeThickness:4});t.setOrigin(.5,.5),t.setDepth(100),t.setResolution(Math.min(window.devicePixelRatio||1,2)),this.tweens.add({targets:t,y:t.y-60,alpha:0,scale:1.3,duration:1500,ease:"Quad.easeOut",onComplete:()=>t.destroy()})}hasValidMoves(){for(let e=0;e<r.Z.size;e++)for(let t=0;t<r.Z.size;t++){if(t<r.Z.size-1&&this.wouldCreateMatch(e,t,e,t+1))return!0;if(e<r.Z.size-1&&this.wouldCreateMatch(e,t,e+1,t))return!0}return!1}wouldCreateMatch(e,t,s,i){const o=this.grid[e][t],a=this.grid[s][i];if(!o||!a)return!1;this.grid[e][t]=a,this.grid[s][i]=o;const r=o.row,n=o.col;o.row=s,o.col=i,a.row=e,a.col=t;let l=!1;return l=a.isBomb?l||this.findBombHorizontalMatch(e,t).length>=3||this.findBombVerticalMatch(e,t).length>=3:l||this.findHorizontalMatch(e,t,a.type).length>=3||this.findVerticalMatch(e,t,a.type).length>=3,l=o.isBomb?l||this.findBombHorizontalMatch(s,i).length>=3||this.findBombVerticalMatch(s,i).length>=3:l||this.findHorizontalMatch(s,i,o.type).length>=3||this.findVerticalMatch(s,i,o.type).length>=3,this.grid[e][t]=o,this.grid[s][i]=a,o.row=r,o.col=n,a.row=s,a.col=i,l}async shuffleBoard(){const e=this.add.text(r.CG/2,r.pF/2,"Sin movimientos\n\xa1Mezclando!",{fontFamily:'"Luckiest Guy", Arial, sans-serif',fontSize:"28px",color:"#ffffff",align:"center",stroke:"#000000",strokeThickness:4});e.setOrigin(.5,.5),e.setDepth(100),e.setResolution(Math.min(window.devicePixelRatio||1,2)),e.setAlpha(0),await new Promise(t=>{this.tweens.add({targets:e,alpha:1,duration:300,onComplete:()=>t()})});const t=[],s=[];for(let a=0;a<r.Z.size;a++)for(let e=0;e<r.Z.size;e++){const i=this.grid[a][e];i&&(i.isBomb&&i.bombType?s.push({row:a,col:e,bombType:i.bombType}):t.push(i.type))}for(let r=t.length-1;r>0;r--){const e=a().Math.Between(0,r);[t[r],t[e]]=[t[e],t[r]]}for(let a=0;a<r.Z.size;a++)for(let e=0;e<r.Z.size;e++){const t=this.grid[a][e];t&&(this.destroyCandy(t),this.grid[a][e]=null)}const i=new Set(s.map(e=>"".concat(e.row,",").concat(e.col)));let o=0;for(let a=0;a<r.Z.size;a++)for(let e=0;e<r.Z.size;e++){const r="".concat(a,",").concat(e);if(i.has(r)){const t=s.find(t=>t.row===a&&t.col===e),i=this.createCandy(a,e,void 0,t.bombType);this.grid[a][e]=i}else{const s=t[o++],i=this.createCandy(a,e,s);this.grid[a][e]=i}}this.removeInitialMatches(),await new Promise(e=>{this.time.delayedCall(500,e)}),await new Promise(t=>{this.tweens.add({targets:e,alpha:0,duration:300,onComplete:()=>{e.destroy(),t()}})})}async checkAndShuffleIfNeeded(){let e=0;for(;!this.hasValidMoves()&&e<10;)await this.shuffleBoard(),e++}}var c=s(3746),h=s(579);const d=e=>{let{onScoreUpdate:t,onMovesUpdate:s,onGameComplete:o,onPhaseChange:d,brandColor:p,skin:g,lives:f=3,levelConfig:u}=e;const y=(0,i.useRef)(null),m=(0,i.useRef)(null),w=(0,i.useCallback)(e=>{t(e)},[t]),S=(0,i.useCallback)(e=>{s(e)},[s]),C=(0,i.useCallback)((e,t)=>{o(e,t)},[o]),v=(0,i.useCallback)(e=>{d&&d(e)},[d]);return(0,i.useEffect)(()=>{if(!y.current||m.current)return;const e={type:a().WEBGL,parent:y.current,width:r.CG,height:r.pF,backgroundColor:r.lm.background,scene:[n,l],scale:{mode:a().Scale.FIT,autoCenter:a().Scale.CENTER_BOTH},render:{pixelArt:!1,antialias:!0,antialiasGL:!0,batchSize:4096},input:{activePointers:1}};return m.current=new(a().Game)(e),m.current.registry.set("onScoreUpdate",w),m.current.registry.set("onMovesUpdate",S),m.current.registry.set("onGameComplete",C),m.current.registry.set("onPhaseChange",v),m.current.registry.set("brandColor",p),m.current.registry.set("skin",g),m.current.registry.set("lives",f),m.current.registry.set("levelConfig",u),m.current.registry.set("audioManager",c.V),()=>{m.current&&(m.current.destroy(!0),m.current=null)}},[w,S,C,v,p,g,f,u]),(0,h.jsx)("div",{ref:y,className:"w-full h-full flex items-center justify-center",style:{touchAction:"none",userSelect:"none"}})}}}]);
//# sourceMappingURL=404.26d713b0.chunk.js.map