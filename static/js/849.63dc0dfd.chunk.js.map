{"version":3,"file":"static/js/849.63dc0dfd.chunk.js","mappings":"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","sources":["components/Content/Games/penalty-shootout/constants.ts","components/Content/Games/penalty-shootout/scenes/BootScene.ts","components/Content/Games/penalty-shootout/utils/audioManager.ts","components/Content/Games/penalty-shootout/scenes/MainScene.ts","components/Content/Games/penalty-shootout/game.tsx"],"sourcesContent":["import { GoalkeeperDifficulty } from './types'\n\n// Game dimensions\nexport const GAME_WIDTH = 400\nexport const GAME_HEIGHT = 600\n\n// Goal dimensions and position (adjusted for perspective view)\nexport const GOAL = {\n\twidth: 240, // Width at front of goal\n\theight: 110, // Height from crossbar to ground line\n\tx: GAME_WIDTH / 2,\n\ty: 125, // Center Y of the goal opening\n\ttopY: 70, // Top of crossbar\n\tbottomY: 180, // Where posts meet ground\n\tpostWidth: 10,\n\tcrossbarHeight: 10,\n}\n\n// Ball settings\nexport const BALL = {\n\tradius: 15,\n\tstartX: GAME_WIDTH / 2,\n\tstartY: 480,\n\tmaxVelocity: 1200,\n}\n\n// Goalkeeper settings (positioned in front of goal line)\nexport const GOALKEEPER = {\n\twidth: 50,\n\theight: 70,\n\tstartX: GAME_WIDTH / 2,\n\tstartY: GOAL.bottomY - 35, // Stand in front of goal line\n\tdiveDistance: 80,\n}\n\n// Power bar settings\nexport const POWER_BAR = {\n\tx: GAME_WIDTH - 40,\n\ty: 200,\n\twidth: 25,\n\theight: 200,\n\toscillationSpeed: 150, // % per second\n\toptimalMin: 70,\n\toptimalMax: 85,\n\tdangerThreshold: 95,\n}\n\n// Scoring\nexport const SCORING = {\n\tbaseGoal: 100,\n\tcornerBonus: 50,\n\tperfectPowerBonus: 25,\n\tstreakBonusPerGoal: 10,\n}\n\n// Power zones for visual feedback (simplified to 3 zones)\n// Speed thresholds correspond to power calculation: power = speed / 10\nexport const POWER_ZONES = {\n\tweak: { minSpeed: 0, maxSpeed: 600, color: 0xfbbf24, name: 'weak' }, // Yellow\n\toptimal: { minSpeed: 600, maxSpeed: 850, color: 0x22c55e, name: 'optimal' }, // Green\n\tstrong: {\n\t\tminSpeed: 850,\n\t\tmaxSpeed: Infinity,\n\t\tcolor: 0xef4444,\n\t\tname: 'strong',\n\t}, // Red\n}\n\n// Power bar UI settings (displayed during aiming)\nexport const POWER_BAR_UI = {\n\tx: 30, // Left side of screen\n\ty: 90, // Near goal\n\twidth: 20,\n\theight: 100,\n}\n\n// Difficulty progression per round\n// Balanced so 5/5 is achievable with skill, 3/5 is typical\nexport const DIFFICULTY: Record<number, GoalkeeperDifficulty> = {\n\t1: { correctDiveChance: 0.35, reactionSpeed: 650, saveCoverage: 0.25 },\n\t2: { correctDiveChance: 0.4, reactionSpeed: 600, saveCoverage: 0.3 },\n\t3: { correctDiveChance: 0.45, reactionSpeed: 550, saveCoverage: 0.35 },\n\t4: { correctDiveChance: 0.5, reactionSpeed: 500, saveCoverage: 0.4 },\n\t5: { correctDiveChance: 0.55, reactionSpeed: 450, saveCoverage: 0.45 },\n}\n\n// Goal zones for aim targeting\nexport const GOAL_ZONES = {\n\t// Top row - hardest, corner bonus for left/right\n\ttopLeft: {\n\t\tx: GOAL.x - GOAL.width / 3,\n\t\ty: GOAL.y - GOAL.height / 3,\n\t\tisCorner: true,\n\t},\n\ttopCenter: { x: GOAL.x, y: GOAL.y - GOAL.height / 3, isCorner: false },\n\ttopRight: {\n\t\tx: GOAL.x + GOAL.width / 3,\n\t\ty: GOAL.y - GOAL.height / 3,\n\t\tisCorner: true,\n\t},\n\t// Middle row\n\tmidLeft: { x: GOAL.x - GOAL.width / 3, y: GOAL.y, isCorner: false },\n\tmidCenter: { x: GOAL.x, y: GOAL.y, isCorner: false },\n\tmidRight: { x: GOAL.x + GOAL.width / 3, y: GOAL.y, isCorner: false },\n\t// Bottom row - easiest\n\tbotLeft: {\n\t\tx: GOAL.x - GOAL.width / 3,\n\t\ty: GOAL.y + GOAL.height / 3,\n\t\tisCorner: false,\n\t},\n\tbotCenter: { x: GOAL.x, y: GOAL.y + GOAL.height / 3, isCorner: false },\n\tbotRight: {\n\t\tx: GOAL.x + GOAL.width / 3,\n\t\ty: GOAL.y + GOAL.height / 3,\n\t\tisCorner: false,\n\t},\n}\n\n// Timing\nexport const TIMING = {\n\taimPhaseDuration: 5000, // ms\n\tresultDisplayDuration: 1500, // ms\n\tballTravelDuration: 500, // ms\n}\n\n// Colors for placeholder graphics\nexport const COLORS = {\n\tfield: 0x1a472a,\n\tfieldLines: 0xffffff,\n\tgoal: 0xffffff,\n\tnet: 0xcccccc,\n\tball: 0xffffff,\n\tballPattern: 0x333333,\n\tgoalkeeper: 0xffcc00,\n\tgoalkeeperGloves: 0x00ff00,\n\tpowerBarBg: 0x333333,\n\tpowerBarOptimal: 0x22c55e,\n\tpowerBarNormal: 0xfbbf24,\n\tpowerBarDanger: 0xef4444,\n\taimTarget: 0xff0000,\n}\n\n// Total rounds\nexport const TOTAL_ROUNDS = 5\n","import Phaser from 'phaser'\nimport { GAME_WIDTH, GAME_HEIGHT, COLORS } from '../constants'\n\nexport class BootScene extends Phaser.Scene {\n\tconstructor() {\n\t\tsuper({ key: 'BootScene' })\n\t}\n\n\tpreload() {\n\t\t// Create loading bar\n\t\tconst progressBar = this.add.graphics()\n\t\tconst progressBox = this.add.graphics()\n\n\t\tprogressBox.fillStyle(0x222222, 0.8)\n\t\tprogressBox.fillRect(GAME_WIDTH / 2 - 160, GAME_HEIGHT / 2 - 25, 320, 50)\n\n\t\tconst loadingText = this.add.text(\n\t\t\tGAME_WIDTH / 2,\n\t\t\tGAME_HEIGHT / 2 - 50,\n\t\t\t'Cargando...',\n\t\t\t{\n\t\t\t\tfont: '20px Arial',\n\t\t\t\tcolor: '#ffffff',\n\t\t\t}\n\t\t)\n\t\tloadingText.setOrigin(0.5, 0.5)\n\n\t\t// Progress bar update\n\t\tthis.load.on('progress', (value: number) => {\n\t\t\tprogressBar.clear()\n\t\t\tprogressBar.fillStyle(COLORS.powerBarOptimal, 1)\n\t\t\tprogressBar.fillRect(\n\t\t\t\tGAME_WIDTH / 2 - 150,\n\t\t\t\tGAME_HEIGHT / 2 - 15,\n\t\t\t\t300 * value,\n\t\t\t\t30\n\t\t\t)\n\t\t})\n\n\t\tthis.load.on('complete', () => {\n\t\t\tprogressBar.destroy()\n\t\t\tprogressBox.destroy()\n\t\t\tloadingText.destroy()\n\t\t})\n\n\t\t// Build image paths based on skin\n\t\tconst skin = this.registry.get('skin') as string | undefined\n\t\tconst basePath = '/games/penalty-shootout/sprites/'\n\t\tconst skinPath = skin ? `skins/${skin}/` : ''\n\n\t\t// Load goalkeeper spritesheet\n\t\t// Frames: idle(0), dive1(1), dive2(2), dive3(3), jump(4), crouch(5)\n\t\tthis.load.spritesheet(\n\t\t\t'goalkeeper',\n\t\t\t`${basePath}${skinPath}goalkeeper.webp`,\n\t\t\t{\n\t\t\t\tframeWidth: 128,\n\t\t\t\tframeHeight: 128,\n\t\t\t}\n\t\t)\n\n\t\t// Load ball sprite\n\t\tthis.load.image('ball', `${basePath}${skinPath}ball.webp`)\n\n\t\t// Load grass texture for field\n\t\tthis.load.image('grass', `${basePath}${skinPath}grass.webp`)\n\n\t\t// Load bottom ad banner\n\t\tthis.load.image('ad-bottom', `${basePath}${skinPath}ad-bottom.png`)\n\n\t\t// Load spark spritesheet for spin animation\n\t\tthis.load.spritesheet('sparksheet', `${basePath}${skinPath}sparks.webp`, {\n\t\t\tframeWidth: 48,\n\t\t\tframeHeight: 54,\n\t\t})\n\t}\n\n\tasync create() {\n\t\t// Wait for Orbitron font to load before starting game\n\t\ttry {\n\t\t\t// Try to load the font with a timeout\n\t\t\tconst fontLoadPromise = document.fonts.load('bold 20px Orbitron')\n\t\t\tconst timeoutPromise = new Promise(resolve => setTimeout(resolve, 2000))\n\t\t\tawait Promise.race([fontLoadPromise, timeoutPromise])\n\n\t\t\t// Double check font is ready\n\t\t\tawait document.fonts.ready\n\t\t} catch (e) {\n\t\t\t// Font might already be loaded or fail to load, continue anyway\n\t\t\tconsole.warn('Font preload warning:', e)\n\t\t}\n\n\t\t// Transition to main game scene\n\t\tthis.scene.start('MainScene')\n\t}\n}\n","import * as Tone from 'tone'\n\nexport class PenaltyShootoutAudioManager {\n\tprivate initialized = false\n\tprivate muted = false\n\n\t// Synthesizers\n\tprivate kickSynth: Tone.MembraneSynth | null = null\n\tprivate goalSynth: Tone.PolySynth | null = null\n\tprivate saveSynth: Tone.NoiseSynth | null = null\n\tprivate whistleSynth: Tone.Synth | null = null\n\tprivate missSynth: Tone.Synth | null = null\n\n\tasync init(): Promise<void> {\n\t\tif (this.initialized) return\n\n\t\tawait Tone.start()\n\n\t\t// Kick synth - powerful thump\n\t\tthis.kickSynth = new Tone.MembraneSynth({\n\t\t\tpitchDecay: 0.02,\n\t\t\toctaves: 5,\n\t\t\toscillator: { type: 'sine' },\n\t\t\tenvelope: {\n\t\t\t\tattack: 0.001,\n\t\t\t\tdecay: 0.3,\n\t\t\t\tsustain: 0,\n\t\t\t\trelease: 0.2,\n\t\t\t},\n\t\t\tvolume: -4,\n\t\t}).toDestination()\n\n\t\t// Goal synth - triumphant fanfare\n\t\tthis.goalSynth = new Tone.PolySynth(Tone.Synth, {\n\t\t\toscillator: { type: 'sawtooth' },\n\t\t\tenvelope: {\n\t\t\t\tattack: 0.01,\n\t\t\t\tdecay: 0.2,\n\t\t\t\tsustain: 0.3,\n\t\t\t\trelease: 0.5,\n\t\t\t},\n\t\t\tvolume: -6,\n\t\t}).toDestination()\n\n\t\t// Save synth - thud/noise\n\t\tthis.saveSynth = new Tone.NoiseSynth({\n\t\t\tnoise: { type: 'brown' },\n\t\t\tenvelope: {\n\t\t\t\tattack: 0.005,\n\t\t\t\tdecay: 0.2,\n\t\t\t\tsustain: 0,\n\t\t\t\trelease: 0.1,\n\t\t\t},\n\t\t\tvolume: -12,\n\t\t}).toDestination()\n\n\t\t// Whistle synth - for save/referee\n\t\tthis.whistleSynth = new Tone.Synth({\n\t\t\toscillator: { type: 'sine' },\n\t\t\tenvelope: {\n\t\t\t\tattack: 0.01,\n\t\t\t\tdecay: 0.1,\n\t\t\t\tsustain: 0.3,\n\t\t\t\trelease: 0.2,\n\t\t\t},\n\t\t\tvolume: -10,\n\t\t}).toDestination()\n\n\t\t// Miss synth - wobbly descending\n\t\tthis.missSynth = new Tone.Synth({\n\t\t\toscillator: { type: 'triangle' },\n\t\t\tenvelope: {\n\t\t\t\tattack: 0.01,\n\t\t\t\tdecay: 0.3,\n\t\t\t\tsustain: 0,\n\t\t\t\trelease: 0.3,\n\t\t\t},\n\t\t\tvolume: -8,\n\t\t}).toDestination()\n\n\t\tthis.initialized = true\n\t}\n\n\t// Powerful kick thump\n\tplayKick(): void {\n\t\tif (!this.initialized || this.muted || !this.kickSynth) return\n\t\tconst now = Tone.now()\n\t\tthis.kickSynth.triggerAttackRelease('C2', '8n', now)\n\t}\n\n\t// Triumphant goal fanfare\n\tplayGoal(): void {\n\t\tif (!this.initialized || this.muted || !this.goalSynth) return\n\t\tconst now = Tone.now()\n\n\t\t// Triumphant chord progression\n\t\tconst fanfare = [\n\t\t\t{ notes: ['C4', 'E4', 'G4'], time: 0 },\n\t\t\t{ notes: ['D4', 'F4', 'A4'], time: 0.15 },\n\t\t\t{ notes: ['E4', 'G4', 'B4'], time: 0.3 },\n\t\t\t{ notes: ['C5', 'E5', 'G5'], time: 0.5 },\n\t\t]\n\n\t\tfanfare.forEach(({ notes, time }) => {\n\t\t\tthis.goalSynth!.triggerAttackRelease(notes, '4n', now + time)\n\t\t})\n\t}\n\n\t// Save - thud + whistle\n\tplaySave(): void {\n\t\tif (!this.initialized || this.muted) return\n\t\tconst now = Tone.now()\n\n\t\t// Thud\n\t\tif (this.saveSynth) {\n\t\t\tthis.saveSynth.triggerAttackRelease('8n', now)\n\t\t}\n\n\t\t// Short whistle\n\t\tif (this.whistleSynth) {\n\t\t\tthis.whistleSynth.triggerAttackRelease('E6', '16n', now + 0.15)\n\t\t\tthis.whistleSynth.triggerAttackRelease('C6', '8n', now + 0.25)\n\t\t}\n\t}\n\n\t// Miss - wobbly descending tone\n\tplayMiss(): void {\n\t\tif (!this.initialized || this.muted || !this.missSynth) return\n\t\tconst now = Tone.now()\n\n\t\t// Descending wobbly notes\n\t\tconst notes = ['E4', 'D4', 'C4', 'B3']\n\t\tnotes.forEach((note, i) => {\n\t\t\tthis.missSynth!.triggerAttackRelease(note, '16n', now + i * 0.12)\n\t\t})\n\t}\n\n\tsetMuted(muted: boolean): void {\n\t\tthis.muted = muted\n\t}\n\n\tisMuted(): boolean {\n\t\treturn this.muted\n\t}\n\n\tdispose(): void {\n\t\tif (!this.initialized) return\n\n\t\tthis.kickSynth?.dispose()\n\t\tthis.goalSynth?.dispose()\n\t\tthis.saveSynth?.dispose()\n\t\tthis.whistleSynth?.dispose()\n\t\tthis.missSynth?.dispose()\n\n\t\tthis.kickSynth = null\n\t\tthis.goalSynth = null\n\t\tthis.saveSynth = null\n\t\tthis.whistleSynth = null\n\t\tthis.missSynth = null\n\n\t\tthis.initialized = false\n\t}\n}\n\nexport const penaltyShootoutAudio = new PenaltyShootoutAudioManager()\n","import Phaser from 'phaser'\nimport {\n\tGAME_WIDTH,\n\tGAME_HEIGHT,\n\tGOAL,\n\tBALL,\n\tGOALKEEPER,\n\tSCORING,\n\tDIFFICULTY,\n\tCOLORS,\n\tTIMING,\n\tPOWER_BAR_UI,\n} from '../constants'\nimport { GameState, ShotResult, GoalkeeperDifficulty } from '../types'\nimport { penaltyShootoutAudio } from '../utils/audioManager'\n\n// Swipe trajectory point\ninterface TrajectoryPoint {\n\tx: number\n\ty: number\n\ttime: number\n}\n\nexport class MainScene extends Phaser.Scene {\n\t// Game state\n\tprivate gameState!: GameState\n\n\t// Graphics objects\n\tprivate ball!: Phaser.GameObjects.Sprite\n\tprivate ballShadow!: Phaser.GameObjects.Ellipse\n\tprivate goalkeeper!: Phaser.GameObjects.Sprite\n\tprivate goalGraphics!: Phaser.GameObjects.Graphics\n\tprivate fieldGraphics!: Phaser.GameObjects.Graphics\n\tprivate trajectoryGraphics!: Phaser.GameObjects.Graphics\n\tprivate goalZoneGraphics!: Phaser.GameObjects.Graphics\n\tprivate projectionGraphics!: Phaser.GameObjects.Graphics\n\n\t// UI elements\n\tprivate roundText!: Phaser.GameObjects.Text\n\tprivate instructionText!: Phaser.GameObjects.Text\n\tprivate resultText!: Phaser.GameObjects.Text\n\tprivate gestureIndicator!: Phaser.GameObjects.Text\n\tprivate goalIndicators: Phaser.GameObjects.Arc[] = []\n\tprivate shotResults: ShotResult[] = [] // Track results for each shot\n\n\t// Drag + spin state (Pokemon Go style)\n\tprivate isDragging: boolean = false\n\tprivate dragStartPos: { x: number; y: number } | null = null\n\tprivate spinPoints: { x: number; y: number; time: number }[] = []\n\tprivate accumulatedSpin: number = 0 // -1 to 1, negative = left curve\n\tprivate ballGrabOffset: { x: number; y: number } = { x: 0, y: 0 }\n\tprivate spinIndicator!: Phaser.GameObjects.Graphics\n\tprivate ballTrail!: Phaser.GameObjects.Graphics\n\tprivate sparkSprite!: Phaser.GameObjects.Sprite\n\tprivate powerBarGraphics!: Phaser.GameObjects.Graphics\n\tprivate powerBarFill!: Phaser.GameObjects.Graphics\n\tprivate smoothedPower: number = 30 // For smooth power bar animation\n\n\t// Legacy swipe state (keeping for compatibility)\n\tprivate trajectoryPoints: TrajectoryPoint[] = []\n\tprivate isSwiping: boolean = false\n\tprivate swipeStartTime: number = 0\n\n\t// Difficulty for current round\n\tprivate currentDifficulty!: GoalkeeperDifficulty\n\n\t// Total rounds (configurable)\n\tprivate totalRounds: number = 5\n\n\tconstructor() {\n\t\tsuper({ key: 'MainScene' })\n\t}\n\n\tcreate() {\n\t\t// Read configurable total rounds from registry\n\t\tthis.totalRounds = this.registry.get('totalRounds') || 5\n\n\t\t// Initialize audio\n\t\tpenaltyShootoutAudio.init()\n\n\t\tthis.initializeGameState()\n\t\tthis.createGoalkeeperAnimations()\n\t\tthis.drawField()\n\t\tthis.drawGoal()\n\t\tthis.createGoalZoneGuides()\n\t\tthis.createBall()\n\t\tthis.createGoalkeeper()\n\t\tthis.createTrajectoryGraphics()\n\t\tthis.createSpinIndicator()\n\t\tthis.createPowerBar()\n\t\tthis.createUI()\n\t\tthis.setupInput()\n\n\t\t// Start the game\n\t\tthis.showStartScreen()\n\t}\n\n\tprivate createGoalkeeperAnimations() {\n\t\t// Idle animation (single frame)\n\t\tthis.anims.create({\n\t\t\tkey: 'gk-idle',\n\t\t\tframes: [{ key: 'goalkeeper', frame: 0 }],\n\t\t\tframeRate: 1,\n\t\t})\n\n\t\t// Dive animation (frames 1-3)\n\t\tthis.anims.create({\n\t\t\tkey: 'gk-dive',\n\t\t\tframes: this.anims.generateFrameNumbers('goalkeeper', {\n\t\t\t\tstart: 1,\n\t\t\t\tend: 3,\n\t\t\t}),\n\t\t\tframeRate: 12,\n\t\t\trepeat: 0,\n\t\t})\n\n\t\t// Jump animation (frame 4)\n\t\tthis.anims.create({\n\t\t\tkey: 'gk-jump',\n\t\t\tframes: [{ key: 'goalkeeper', frame: 4 }],\n\t\t\tframeRate: 1,\n\t\t})\n\n\t\t// Crouch animation (frame 5)\n\t\tthis.anims.create({\n\t\t\tkey: 'gk-crouch',\n\t\t\tframes: [{ key: 'goalkeeper', frame: 5 }],\n\t\t\tframeRate: 1,\n\t\t})\n\t}\n\n\tprivate initializeGameState() {\n\t\tthis.gameState = {\n\t\t\tphase: 'start',\n\t\t\tround: 1,\n\t\t\tgoals: 0,\n\t\t\ttotalScore: 0,\n\t\t\tlastResult: null,\n\t\t\tconsecutiveGoals: 0,\n\t\t\taimPosition: null,\n\t\t\tpower: 0,\n\t\t}\n\t\tthis.currentDifficulty = DIFFICULTY[1]\n\t\tthis.shotResults = [] // Reset shot results\n\n\t\t// Reset goal indicators if they exist (for game restart)\n\t\tif (this.goalIndicators.length > 0) {\n\t\t\tfor (const indicator of this.goalIndicators) {\n\t\t\t\tindicator.setFillStyle(0x666666, 1) // Reset to gray\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate drawField() {\n\t\tthis.fieldGraphics = this.add.graphics()\n\t\tthis.fieldGraphics.setDepth(0) // Lowest layer\n\n\t\t// Layout constants - full width, only bottom ad\n\t\tconst adBottomHeight = 50\n\t\tconst horizonY = 60 // Where sky meets field\n\t\tconst fieldBottom = GAME_HEIGHT - adBottomHeight // y=550\n\t\tconst vanishingPointX = GAME_WIDTH / 2\n\n\t\t// Goal boundaries - only skip the goal OPENING, not full width\n\t\tconst goalLeft = GOAL.x - GOAL.width / 2\n\t\tconst goalRight = GOAL.x + GOAL.width / 2\n\t\tconst goalTop = GOAL.topY\n\t\tconst goalBottom = GOAL.bottomY\n\n\t\t// 1. Draw sky gradient from top to horizon (FULL WIDTH)\n\t\tfor (let y = 0; y < horizonY; y++) {\n\t\t\tconst t = y / horizonY\n\t\t\tconst r = Math.floor(100 + t * 50) // 100 -> 150\n\t\t\tconst g = Math.floor(150 + t * 50) // 150 -> 200\n\t\t\tconst b = Math.floor(220 - t * 20) // 220 -> 200\n\t\t\tconst color = (r << 16) | (g << 8) | b\n\t\t\tthis.fieldGraphics.fillStyle(color, 1)\n\t\t\tthis.fieldGraphics.fillRect(0, y, GAME_WIDTH, 1)\n\t\t}\n\n\t\t// 2. Add grass texture as tiled sprite for the field\n\t\tconst fieldHeight = fieldBottom - horizonY\n\t\tconst grassTile = this.add.tileSprite(\n\t\t\tGAME_WIDTH / 2,\n\t\t\thorizonY + fieldHeight / 2,\n\t\t\tGAME_WIDTH,\n\t\t\tfieldHeight,\n\t\t\t'grass'\n\t\t)\n\t\tgrassTile.setDepth(0)\n\n\t\t// 3. Cover the goal opening area with the goal net (drawn later by drawGoal)\n\t\t// Draw dark overlay where goal opening is to hide grass there\n\t\tthis.fieldGraphics.fillStyle(0x000000, 1)\n\t\tthis.fieldGraphics.fillRect(\n\t\t\tgoalLeft,\n\t\t\tgoalTop,\n\t\t\tgoalRight - goalLeft,\n\t\t\tgoalBottom - goalTop\n\t\t)\n\n\t\t// 4. Bottom ad area background (dark)\n\t\tthis.fieldGraphics.fillStyle(0x1a1a2e, 1)\n\t\tthis.fieldGraphics.fillRect(0, fieldBottom, GAME_WIDTH, adBottomHeight)\n\n\t\t// Create separate graphics for field lines (drawn on top of grass)\n\t\tconst fieldLines = this.add.graphics()\n\t\tfieldLines.setDepth(0.5) // Above grass, below goal\n\n\t\t// 5. Draw goal line (full width)\n\t\tfieldLines.lineStyle(5, COLORS.fieldLines, 0.9)\n\t\tconst goalLineY = GOAL.bottomY\n\t\tfieldLines.lineBetween(0, goalLineY, GAME_WIDTH, goalLineY)\n\n\t\t// 6. Goal area (6-yard box) - wider than goal posts (goal is 240px)\n\t\tfieldLines.lineStyle(4, COLORS.fieldLines, 0.8)\n\t\tconst goalAreaTopY = GOAL.bottomY\n\t\tconst goalAreaBottomY = GOAL.bottomY + 60\n\t\tconst goalAreaTopWidth = 280\n\t\tconst goalAreaBottomWidth = 320\n\n\t\tfieldLines.lineBetween(\n\t\t\tvanishingPointX - goalAreaTopWidth / 2,\n\t\t\tgoalAreaTopY,\n\t\t\tvanishingPointX - goalAreaBottomWidth / 2,\n\t\t\tgoalAreaBottomY\n\t\t)\n\t\tfieldLines.lineBetween(\n\t\t\tvanishingPointX + goalAreaTopWidth / 2,\n\t\t\tgoalAreaTopY,\n\t\t\tvanishingPointX + goalAreaBottomWidth / 2,\n\t\t\tgoalAreaBottomY\n\t\t)\n\t\tfieldLines.lineBetween(\n\t\t\tvanishingPointX - goalAreaBottomWidth / 2,\n\t\t\tgoalAreaBottomY,\n\t\t\tvanishingPointX + goalAreaBottomWidth / 2,\n\t\t\tgoalAreaBottomY\n\t\t)\n\n\t\t// 7. Penalty spot\n\t\tfieldLines.fillStyle(COLORS.fieldLines, 1)\n\t\tfieldLines.fillCircle(BALL.startX, BALL.startY, 5)\n\n\t\t// 8. Center circle arc (behind the ball, tighter semicircle)\n\t\tfieldLines.lineStyle(4, COLORS.fieldLines, 0.8)\n\t\tfieldLines.beginPath()\n\t\tconst arcRadius = 70\n\t\tconst arcCenterY = BALL.startY + 50 // Center below the ball\n\t\t// Use integer steps for symmetric arc\n\t\tconst arcSteps = 30\n\t\tfor (let i = 0; i <= arcSteps; i++) {\n\t\t\tconst angle = -1.5 + (3.0 * i) / arcSteps // -1.5 to 1.5\n\t\t\tconst x = vanishingPointX + Math.sin(angle) * arcRadius\n\t\t\tconst y = arcCenterY - Math.cos(angle) * arcRadius * 0.7\n\t\t\tif (i === 0) {\n\t\t\t\tfieldLines.moveTo(x, y)\n\t\t\t} else {\n\t\t\t\tfieldLines.lineTo(x, y)\n\t\t\t}\n\t\t}\n\t\tfieldLines.strokePath()\n\n\t\t// 9. Middle field line (horizontal line connecting arc endpoints)\n\t\tfieldLines.lineStyle(5, COLORS.fieldLines, 0.9)\n\t\t// At angle = 1.5, cos(1.5)  0.07, so endpoints are near arcCenterY\n\t\tconst middleLineY = arcCenterY - Math.cos(1.5) * arcRadius * 0.7\n\t\tfieldLines.lineBetween(0, middleLineY, GAME_WIDTH, middleLineY)\n\n\t\t// 9. Add bottom ad banner\n\t\tthis.addAdBanners()\n\t}\n\n\tprivate addAdBanners() {\n\t\t// Bottom ad banner only\n\t\tconst adBottom = this.add.sprite(\n\t\t\tGAME_WIDTH / 2,\n\t\t\tGAME_HEIGHT - 25,\n\t\t\t'ad-bottom'\n\t\t)\n\t\tadBottom.setDepth(10)\n\t\tadBottom.setDisplaySize(GAME_WIDTH, 50)\n\t}\n\n\tprivate drawGoal() {\n\t\tthis.goalGraphics = this.add.graphics()\n\t\tthis.goalGraphics.setDepth(1) // Above field, below other elements\n\n\t\t// Goal position adjusted for perspective view\n\t\tconst goalCenterX = GAME_WIDTH / 2\n\t\tconst goalBottomY = 180 // Where posts meet the ground\n\t\tconst goalTopY = 70 // Top of crossbar\n\t\tconst goalWidth = 240 // Width at front\n\t\tconst postWidth = 10\n\n\t\t// Side net depth positions (back of goal)\n\t\tconst backTopY = goalTopY - 10\n\t\tconst backWidth = goalWidth * 0.85 // Slightly narrower at back\n\n\t\t// Back net (darkest, furthest away)\n\t\tthis.goalGraphics.fillStyle(0x333333, 0.6)\n\t\tthis.goalGraphics.beginPath()\n\t\tthis.goalGraphics.moveTo(goalCenterX - backWidth / 2, backTopY)\n\t\tthis.goalGraphics.lineTo(goalCenterX + backWidth / 2, backTopY)\n\t\tthis.goalGraphics.lineTo(goalCenterX + backWidth / 2, goalBottomY - 20)\n\t\tthis.goalGraphics.lineTo(goalCenterX - backWidth / 2, goalBottomY - 20)\n\t\tthis.goalGraphics.closePath()\n\t\tthis.goalGraphics.fillPath()\n\n\t\t// Back net pattern\n\t\tthis.goalGraphics.lineStyle(1, 0x666666, 0.3)\n\t\tconst backNetSpacing = 12\n\t\tfor (\n\t\t\tlet x = goalCenterX - backWidth / 2;\n\t\t\tx <= goalCenterX + backWidth / 2;\n\t\t\tx += backNetSpacing\n\t\t) {\n\t\t\tthis.goalGraphics.lineBetween(x, backTopY, x, goalBottomY - 20)\n\t\t}\n\t\tfor (let y = backTopY; y <= goalBottomY - 20; y += backNetSpacing) {\n\t\t\tthis.goalGraphics.lineBetween(\n\t\t\t\tgoalCenterX - backWidth / 2,\n\t\t\t\ty,\n\t\t\t\tgoalCenterX + backWidth / 2,\n\t\t\t\ty\n\t\t\t)\n\t\t}\n\n\t\t// Left side net (trapezoid shape for perspective)\n\t\tthis.goalGraphics.fillStyle(0x444444, 0.4)\n\t\tthis.goalGraphics.beginPath()\n\t\tthis.goalGraphics.moveTo(goalCenterX - goalWidth / 2, goalTopY) // Front top\n\t\tthis.goalGraphics.lineTo(goalCenterX - backWidth / 2, backTopY) // Back top\n\t\tthis.goalGraphics.lineTo(goalCenterX - backWidth / 2, goalBottomY - 20) // Back bottom\n\t\tthis.goalGraphics.lineTo(goalCenterX - goalWidth / 2, goalBottomY) // Front bottom\n\t\tthis.goalGraphics.closePath()\n\t\tthis.goalGraphics.fillPath()\n\n\t\t// Left side net lines\n\t\tthis.goalGraphics.lineStyle(1, 0x888888, 0.3)\n\t\tfor (let i = 0; i <= 4; i++) {\n\t\t\tconst t = i / 4\n\t\t\tconst frontY = goalTopY + t * (goalBottomY - goalTopY)\n\t\t\tconst backY = backTopY + t * (goalBottomY - 20 - backTopY)\n\t\t\tthis.goalGraphics.lineBetween(\n\t\t\t\tgoalCenterX - goalWidth / 2,\n\t\t\t\tfrontY,\n\t\t\t\tgoalCenterX - backWidth / 2,\n\t\t\t\tbackY\n\t\t\t)\n\t\t}\n\n\t\t// Right side net (trapezoid shape for perspective)\n\t\tthis.goalGraphics.fillStyle(0x444444, 0.4)\n\t\tthis.goalGraphics.beginPath()\n\t\tthis.goalGraphics.moveTo(goalCenterX + goalWidth / 2, goalTopY) // Front top\n\t\tthis.goalGraphics.lineTo(goalCenterX + backWidth / 2, backTopY) // Back top\n\t\tthis.goalGraphics.lineTo(goalCenterX + backWidth / 2, goalBottomY - 20) // Back bottom\n\t\tthis.goalGraphics.lineTo(goalCenterX + goalWidth / 2, goalBottomY) // Front bottom\n\t\tthis.goalGraphics.closePath()\n\t\tthis.goalGraphics.fillPath()\n\n\t\t// Right side net lines\n\t\tfor (let i = 0; i <= 4; i++) {\n\t\t\tconst t = i / 4\n\t\t\tconst frontY = goalTopY + t * (goalBottomY - goalTopY)\n\t\t\tconst backY = backTopY + t * (goalBottomY - 20 - backTopY)\n\t\t\tthis.goalGraphics.lineBetween(\n\t\t\t\tgoalCenterX + goalWidth / 2,\n\t\t\t\tfrontY,\n\t\t\t\tgoalCenterX + backWidth / 2,\n\t\t\t\tbackY\n\t\t\t)\n\t\t}\n\n\t\t// Top net (roof of goal)\n\t\tthis.goalGraphics.fillStyle(0x555555, 0.3)\n\t\tthis.goalGraphics.beginPath()\n\t\tthis.goalGraphics.moveTo(goalCenterX - goalWidth / 2, goalTopY) // Front left\n\t\tthis.goalGraphics.lineTo(goalCenterX + goalWidth / 2, goalTopY) // Front right\n\t\tthis.goalGraphics.lineTo(goalCenterX + backWidth / 2, backTopY) // Back right\n\t\tthis.goalGraphics.lineTo(goalCenterX - backWidth / 2, backTopY) // Back left\n\t\tthis.goalGraphics.closePath()\n\t\tthis.goalGraphics.fillPath()\n\n\t\t// Top net pattern\n\t\tthis.goalGraphics.lineStyle(1, 0x888888, 0.3)\n\t\tfor (let i = 0; i <= 8; i++) {\n\t\t\tconst t = i / 8\n\t\t\tconst frontX = goalCenterX - goalWidth / 2 + t * goalWidth\n\t\t\tconst backX = goalCenterX - backWidth / 2 + t * backWidth\n\t\t\tthis.goalGraphics.lineBetween(frontX, goalTopY, backX, backTopY)\n\t\t}\n\n\t\t// Goal posts (white with shading for 3D effect)\n\t\t// Left post - main\n\t\tthis.goalGraphics.fillStyle(0xffffff, 1)\n\t\tthis.goalGraphics.fillRect(\n\t\t\tgoalCenterX - goalWidth / 2 - postWidth / 2,\n\t\t\tgoalTopY,\n\t\t\tpostWidth,\n\t\t\tgoalBottomY - goalTopY\n\t\t)\n\t\t// Left post - shadow\n\t\tthis.goalGraphics.fillStyle(0xcccccc, 1)\n\t\tthis.goalGraphics.fillRect(\n\t\t\tgoalCenterX - goalWidth / 2 + postWidth / 2 - 3,\n\t\t\tgoalTopY,\n\t\t\t3,\n\t\t\tgoalBottomY - goalTopY\n\t\t)\n\n\t\t// Right post - main\n\t\tthis.goalGraphics.fillStyle(0xffffff, 1)\n\t\tthis.goalGraphics.fillRect(\n\t\t\tgoalCenterX + goalWidth / 2 - postWidth / 2,\n\t\t\tgoalTopY,\n\t\t\tpostWidth,\n\t\t\tgoalBottomY - goalTopY\n\t\t)\n\t\t// Right post - shadow\n\t\tthis.goalGraphics.fillStyle(0xcccccc, 1)\n\t\tthis.goalGraphics.fillRect(\n\t\t\tgoalCenterX + goalWidth / 2 - postWidth / 2,\n\t\t\tgoalTopY,\n\t\t\t3,\n\t\t\tgoalBottomY - goalTopY\n\t\t)\n\n\t\t// Crossbar - main\n\t\tthis.goalGraphics.fillStyle(0xffffff, 1)\n\t\tthis.goalGraphics.fillRect(\n\t\t\tgoalCenterX - goalWidth / 2 - postWidth / 2,\n\t\t\tgoalTopY - postWidth,\n\t\t\tgoalWidth + postWidth,\n\t\t\tpostWidth\n\t\t)\n\t\t// Crossbar - bottom shadow\n\t\tthis.goalGraphics.fillStyle(0xaaaaaa, 1)\n\t\tthis.goalGraphics.fillRect(\n\t\t\tgoalCenterX - goalWidth / 2 - postWidth / 2,\n\t\t\tgoalTopY - 3,\n\t\t\tgoalWidth + postWidth,\n\t\t\t3\n\t\t)\n\n\t\t// Ground line where posts meet field (shadow)\n\t\tthis.goalGraphics.fillStyle(0x0a2a15, 0.5)\n\t\tthis.goalGraphics.fillEllipse(\n\t\t\tgoalCenterX - goalWidth / 2,\n\t\t\tgoalBottomY + 3,\n\t\t\tpostWidth + 4,\n\t\t\t6\n\t\t)\n\t\tthis.goalGraphics.fillEllipse(\n\t\t\tgoalCenterX + goalWidth / 2,\n\t\t\tgoalBottomY + 3,\n\t\t\tpostWidth + 4,\n\t\t\t6\n\t\t)\n\t}\n\n\tprivate createBall() {\n\t\t// Ball shadow (smaller to match reduced ball)\n\t\tthis.ballShadow = this.add.ellipse(\n\t\t\tBALL.startX,\n\t\t\tBALL.startY + 8,\n\t\t\tBALL.radius * 1.5,\n\t\t\tBALL.radius * 0.75,\n\t\t\t0x000000,\n\t\t\t0.3\n\t\t)\n\t\tthis.ballShadow.setDepth(4) // Ball layer\n\n\t\t// Ball sprite - smaller size (0.7x of original)\n\t\tthis.ball = this.add.sprite(BALL.startX, BALL.startY, 'ball')\n\t\tthis.ball.setDepth(5) // Above shadow\n\n\t\t// Scale ball to smaller size\n\t\tconst targetDiameter = BALL.radius * 1.5 // Reduced from 2x to 1.5x\n\t\tconst scale = targetDiameter / this.ball.width\n\t\tthis.ball.setScale(scale)\n\t}\n\n\tprivate createGoalkeeper() {\n\t\t// Create goalkeeper sprite\n\t\t// Origin at bottom-center so position represents where feet touch ground\n\t\tthis.goalkeeper = this.add.sprite(\n\t\t\tGOALKEEPER.startX,\n\t\t\tGOALKEEPER.startY + GOALKEEPER.height / 2, // Adjust for bottom-center origin\n\t\t\t'goalkeeper',\n\t\t\t0 // Start with idle frame\n\t\t)\n\t\tthis.goalkeeper.setOrigin(0.5, 1) // Bottom-center\n\t\tthis.goalkeeper.setDepth(3) // Above goal zone guides\n\n\t\t// Scale sprite to match desired goalkeeper height\n\t\t// Sprite is 128px, we want ~90px height (larger than before)\n\t\tconst scale = (GOALKEEPER.height * 1.3) / 128\n\t\tthis.goalkeeper.setScale(scale)\n\n\t\t// Play idle animation\n\t\tthis.goalkeeper.play('gk-idle')\n\t}\n\n\tprivate createTrajectoryGraphics() {\n\t\tthis.trajectoryGraphics = this.add.graphics()\n\t\tthis.trajectoryGraphics.setDepth(10) // UI overlay layer\n\t\tthis.projectionGraphics = this.add.graphics()\n\t\tthis.projectionGraphics.setDepth(10)\n\t\tthis.ballTrail = this.add.graphics()\n\t\tthis.ballTrail.setDepth(4) // Behind ball\n\t}\n\n\tprivate createGoalZoneGuides() {\n\t\tthis.goalZoneGraphics = this.add.graphics()\n\t\tthis.goalZoneGraphics.setDepth(2) // Above goal\n\t\tthis.goalZoneGraphics.setAlpha(0) // Hidden initially\n\t}\n\n\tprivate createSpinIndicator() {\n\t\tthis.spinIndicator = this.add.graphics()\n\t\tthis.spinIndicator.setDepth(6) // Above ball\n\t\tthis.spinIndicator.setAlpha(0)\n\n\t\t// Create spark animation\n\t\tthis.anims.create({\n\t\t\tkey: 'spark_loop',\n\t\t\tframes: this.anims.generateFrameNumbers('sparksheet', {\n\t\t\t\tstart: 0,\n\t\t\t\tend: 14,\n\t\t\t}),\n\t\t\tframeRate: 15,\n\t\t\trepeat: -1,\n\t\t})\n\n\t\t// Create spark sprite (hidden initially, under the ball)\n\t\tthis.sparkSprite = this.add.sprite(BALL.startX, BALL.startY, 'sparksheet')\n\t\tthis.sparkSprite.setVisible(false)\n\t\tthis.sparkSprite.setDepth(4) // Below ball (ball is depth 5)\n\t}\n\n\tprivate drawGoalZoneGuides() {\n\t\tthis.goalZoneGraphics.clear()\n\n\t\tconst goalTopY = GOAL.topY\n\t\tconst goalBottomY = GOAL.bottomY\n\t\tconst goalLeft = GOAL.x - GOAL.width / 2\n\t\tconst goalRight = GOAL.x + GOAL.width / 2\n\t\tconst goalHeight = goalBottomY - goalTopY\n\t\tconst goalWidth = GOAL.width\n\n\t\t// Semi-transparent overlay on goal opening (light blue for visibility)\n\t\tthis.goalZoneGraphics.fillStyle(0x00bfff, 0.2)\n\t\tthis.goalZoneGraphics.fillRect(goalLeft, goalTopY, goalWidth, goalHeight)\n\n\t\t// Draw 9-zone grid (3x3)\n\t\tconst zoneWidth = goalWidth / 3\n\t\tconst zoneHeight = goalHeight / 3\n\n\t\tthis.goalZoneGraphics.lineStyle(2, 0xffffff, 0.5)\n\n\t\t// Vertical lines\n\t\tthis.goalZoneGraphics.lineBetween(\n\t\t\tgoalLeft + zoneWidth,\n\t\t\tgoalTopY,\n\t\t\tgoalLeft + zoneWidth,\n\t\t\tgoalBottomY\n\t\t)\n\t\tthis.goalZoneGraphics.lineBetween(\n\t\t\tgoalLeft + zoneWidth * 2,\n\t\t\tgoalTopY,\n\t\t\tgoalLeft + zoneWidth * 2,\n\t\t\tgoalBottomY\n\t\t)\n\n\t\t// Horizontal lines\n\t\tthis.goalZoneGraphics.lineBetween(\n\t\t\tgoalLeft,\n\t\t\tgoalTopY + zoneHeight,\n\t\t\tgoalRight,\n\t\t\tgoalTopY + zoneHeight\n\t\t)\n\t\tthis.goalZoneGraphics.lineBetween(\n\t\t\tgoalLeft,\n\t\t\tgoalTopY + zoneHeight * 2,\n\t\t\tgoalRight,\n\t\t\tgoalTopY + zoneHeight * 2\n\t\t)\n\n\t\t// Highlight corner zones (bonus areas) with gold tint\n\t\tthis.goalZoneGraphics.fillStyle(0xffd700, 0.25)\n\t\t// Top-left corner\n\t\tthis.goalZoneGraphics.fillRect(goalLeft, goalTopY, zoneWidth, zoneHeight)\n\t\t// Top-right corner\n\t\tthis.goalZoneGraphics.fillRect(\n\t\t\tgoalLeft + zoneWidth * 2,\n\t\t\tgoalTopY,\n\t\t\tzoneWidth,\n\t\t\tzoneHeight\n\t\t)\n\n\t\t// Add small star icons in corners to indicate bonus\n\t\tthis.goalZoneGraphics.fillStyle(0xffd700, 0.8)\n\t\t// Top-left star\n\t\tthis.drawStar(goalLeft + zoneWidth / 2, goalTopY + zoneHeight / 2, 8, 5)\n\t\t// Top-right star\n\t\tthis.drawStar(goalLeft + zoneWidth * 2.5, goalTopY + zoneHeight / 2, 8, 5)\n\t}\n\n\tprivate drawStar(\n\t\tcx: number,\n\t\tcy: number,\n\t\touterRadius: number,\n\t\tpoints: number\n\t) {\n\t\tconst innerRadius = outerRadius * 0.5\n\t\tthis.goalZoneGraphics.beginPath()\n\n\t\tfor (let i = 0; i < points * 2; i++) {\n\t\t\tconst radius = i % 2 === 0 ? outerRadius : innerRadius\n\t\t\tconst angle = (i * Math.PI) / points - Math.PI / 2\n\t\t\tconst x = cx + Math.cos(angle) * radius\n\t\t\tconst y = cy + Math.sin(angle) * radius\n\n\t\t\tif (i === 0) {\n\t\t\t\tthis.goalZoneGraphics.moveTo(x, y)\n\t\t\t} else {\n\t\t\t\tthis.goalZoneGraphics.lineTo(x, y)\n\t\t\t}\n\t\t}\n\n\t\tthis.goalZoneGraphics.closePath()\n\t\tthis.goalZoneGraphics.fillPath()\n\t}\n\n\tprivate showGoalZoneGuides() {\n\t\tthis.drawGoalZoneGuides()\n\t\tthis.tweens.add({\n\t\t\ttargets: this.goalZoneGraphics,\n\t\t\talpha: 1,\n\t\t\tduration: 300,\n\t\t\tease: 'Power2',\n\t\t})\n\t}\n\n\tprivate hideGoalZoneGuides() {\n\t\tthis.tweens.add({\n\t\t\ttargets: this.goalZoneGraphics,\n\t\t\talpha: 0,\n\t\t\tduration: 200,\n\t\t\tease: 'Power2',\n\t\t})\n\t}\n\n\tprivate updateProjectionIndicator(targetX: number, targetY: number) {\n\t\tthis.projectionGraphics.clear()\n\n\t\t// Clamp target to goal area\n\t\tconst goalLeft = GOAL.x - GOAL.width / 2 + 10\n\t\tconst goalRight = GOAL.x + GOAL.width / 2 - 10\n\t\tconst goalTop = GOAL.topY + 5\n\t\tconst goalBottom = GOAL.bottomY - 5\n\n\t\tconst clampedX = Phaser.Math.Clamp(targetX, goalLeft, goalRight)\n\t\tconst clampedY = Phaser.Math.Clamp(targetY, goalTop, goalBottom)\n\n\t\t// Only show if target is in or near goal area\n\t\tif (targetY < goalBottom + 100) {\n\t\t\t// Draw dotted line from ball to target\n\t\t\tthis.projectionGraphics.lineStyle(2, 0xffffff, 0.4)\n\t\t\tconst dashLength = 10\n\t\t\tconst gapLength = 8\n\t\t\tconst startX = BALL.startX\n\t\t\tconst startY = BALL.startY\n\t\t\tconst dx = clampedX - startX\n\t\t\tconst dy = clampedY - startY\n\t\t\tconst distance = Math.sqrt(dx * dx + dy * dy)\n\t\t\tconst steps = Math.floor(distance / (dashLength + gapLength))\n\n\t\t\tfor (let i = 0; i < steps; i++) {\n\t\t\t\tconst t1 = (i * (dashLength + gapLength)) / distance\n\t\t\t\tconst t2 = (i * (dashLength + gapLength) + dashLength) / distance\n\t\t\t\tif (t2 <= 1) {\n\t\t\t\t\tthis.projectionGraphics.lineBetween(\n\t\t\t\t\t\tstartX + dx * t1,\n\t\t\t\t\t\tstartY + dy * t1,\n\t\t\t\t\t\tstartX + dx * t2,\n\t\t\t\t\t\tstartY + dy * t2\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Draw target circle on goal\n\t\t\tthis.projectionGraphics.lineStyle(3, 0xff4444, 0.8)\n\t\t\tthis.projectionGraphics.strokeCircle(clampedX, clampedY, 15)\n\n\t\t\t// Inner crosshair\n\t\t\tthis.projectionGraphics.lineStyle(2, 0xffffff, 0.6)\n\t\t\tthis.projectionGraphics.lineBetween(\n\t\t\t\tclampedX - 8,\n\t\t\t\tclampedY,\n\t\t\t\tclampedX + 8,\n\t\t\t\tclampedY\n\t\t\t)\n\t\t\tthis.projectionGraphics.lineBetween(\n\t\t\t\tclampedX,\n\t\t\t\tclampedY - 8,\n\t\t\t\tclampedX,\n\t\t\t\tclampedY + 8\n\t\t\t)\n\n\t\t\t// Highlight which zone we're aiming at\n\t\t\tthis.highlightTargetZone(clampedX, clampedY)\n\t\t}\n\t}\n\n\tprivate highlightTargetZone(targetX: number, targetY: number) {\n\t\tconst goalTopY = GOAL.topY\n\t\tconst goalLeft = GOAL.x - GOAL.width / 2\n\t\tconst zoneWidth = GOAL.width / 3\n\t\tconst zoneHeight = (GOAL.bottomY - GOAL.topY) / 3\n\n\t\t// Determine which zone\n\t\tconst col = Math.floor((targetX - goalLeft) / zoneWidth)\n\t\tconst row = Math.floor((targetY - goalTopY) / zoneHeight)\n\n\t\tif (col >= 0 && col < 3 && row >= 0 && row < 3) {\n\t\t\tconst zoneX = goalLeft + col * zoneWidth\n\t\t\tconst zoneY = goalTopY + row * zoneHeight\n\n\t\t\t// Subtle highlight on target zone\n\t\t\tthis.projectionGraphics.fillStyle(0xffffff, 0.1)\n\t\t\tthis.projectionGraphics.fillRect(zoneX, zoneY, zoneWidth, zoneHeight)\n\n\t\t\t// Extra glow for corner bonus zones\n\t\t\tif (row === 0 && (col === 0 || col === 2)) {\n\t\t\t\tthis.projectionGraphics.fillStyle(0xffd700, 0.15)\n\t\t\t\tthis.projectionGraphics.fillRect(zoneX, zoneY, zoneWidth, zoneHeight)\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate updateSpinIndicator(spin: number) {\n\t\tthis.spinIndicator.clear()\n\n\t\tif (Math.abs(spin) < 0.15) {\n\t\t\tthis.spinIndicator.setAlpha(0)\n\t\t\t// Hide spark sprite\n\t\t\tthis.sparkSprite.setVisible(false)\n\t\t\tthis.sparkSprite.stop()\n\t\t\treturn\n\t\t}\n\n\t\tthis.spinIndicator.setAlpha(Math.min(Math.abs(spin) * 1.5, 1))\n\n\t\t// Show and animate spark sprite\n\t\tthis.sparkSprite.setPosition(this.ball.x, this.ball.y)\n\t\tthis.sparkSprite.setScale(2 + Math.abs(spin)) // Larger scale, increases with spin\n\t\tif (!this.sparkSprite.visible) {\n\t\t\tthis.sparkSprite.setVisible(true)\n\t\t\tthis.sparkSprite.play('spark_loop')\n\t\t}\n\n\t\tconst ballX = this.ball.x\n\t\tconst ballY = this.ball.y\n\t\tconst radius = BALL.radius + 12\n\n\t\t// Yellow color for both spin directions\n\t\tconst color = 0xffff00\n\n\t\t// Draw a simple curved arrow\n\t\tthis.spinIndicator.lineStyle(6, color, 0.9)\n\n\t\tconst arrowSize = 10\n\n\t\tif (spin > 0) {\n\t\t\t// Right spin: arrow curving clockwise on right side\n\t\t\tthis.spinIndicator.beginPath()\n\t\t\tthis.spinIndicator.arc(ballX, ballY, radius, -0.8, 0.8, false)\n\t\t\tthis.spinIndicator.strokePath()\n\n\t\t\t// Arrow head at bottom of arc (0.8), pointing in clockwise direction\n\t\t\tconst tipAngle = 0.8\n\t\t\tconst tipX = ballX + Math.cos(tipAngle) * radius\n\t\t\tconst tipY = ballY + Math.sin(tipAngle) * radius\n\t\t\t// Tangent direction for clockwise motion\n\t\t\tconst tangent = tipAngle + Math.PI / 2\n\t\t\tthis.spinIndicator.fillStyle(color, 1)\n\t\t\tthis.spinIndicator.fillTriangle(\n\t\t\t\ttipX + Math.cos(tangent) * arrowSize,\n\t\t\t\ttipY + Math.sin(tangent) * arrowSize,\n\t\t\t\ttipX + Math.cos(tangent + 2.5) * arrowSize,\n\t\t\t\ttipY + Math.sin(tangent + 2.5) * arrowSize,\n\t\t\t\ttipX + Math.cos(tangent - 2.5) * arrowSize,\n\t\t\t\ttipY + Math.sin(tangent - 2.5) * arrowSize\n\t\t\t)\n\t\t} else {\n\t\t\t// Left spin: arrow curving counter-clockwise on left side\n\t\t\tthis.spinIndicator.beginPath()\n\t\t\tthis.spinIndicator.arc(\n\t\t\t\tballX,\n\t\t\t\tballY,\n\t\t\t\tradius,\n\t\t\t\tMath.PI - 0.8,\n\t\t\t\tMath.PI + 0.8,\n\t\t\t\tfalse\n\t\t\t)\n\t\t\tthis.spinIndicator.strokePath()\n\n\t\t\t// Arrow head at top of arc (PI-0.8), pointing upward for counter-clockwise motion\n\t\t\tconst tipAngle = Math.PI - 0.8\n\t\t\tconst tipX = ballX + Math.cos(tipAngle) * radius\n\t\t\tconst tipY = ballY + Math.sin(tipAngle) * radius\n\t\t\t// Tangent direction for counter-clockwise motion (pointing up on left side)\n\t\t\tconst tangent = tipAngle - Math.PI / 2\n\t\t\tthis.spinIndicator.fillStyle(color, 1)\n\t\t\tthis.spinIndicator.fillTriangle(\n\t\t\t\ttipX + Math.cos(tangent) * arrowSize,\n\t\t\t\ttipY + Math.sin(tangent) * arrowSize,\n\t\t\t\ttipX + Math.cos(tangent + 2.5) * arrowSize,\n\t\t\t\ttipY + Math.sin(tangent + 2.5) * arrowSize,\n\t\t\t\ttipX + Math.cos(tangent - 2.5) * arrowSize,\n\t\t\t\ttipY + Math.sin(tangent - 2.5) * arrowSize\n\t\t\t)\n\t\t}\n\t}\n\n\tprivate createUI() {\n\t\t// Stacked round text and goal indicators at top\n\t\t// Round text - top line\n\t\tthis.roundText = this.add.text(GAME_WIDTH / 2, 20, '', {\n\t\t\tfont: 'bold 16px Orbitron',\n\t\t\tcolor: '#ffffff',\n\t\t\tstroke: '#000000',\n\t\t\tstrokeThickness: 4,\n\t\t})\n\t\tthis.roundText.setOrigin(0.5)\n\t\tthis.roundText.setResolution(2)\n\t\tthis.roundText.setDepth(15)\n\n\t\t// Goal indicators - 5 circles below round text, centered\n\t\tconst indicatorY = 42\n\t\tconst indicatorSpacing = 18\n\t\tconst indicatorRadius = 6\n\t\tconst totalWidth = (this.totalRounds - 1) * indicatorSpacing\n\t\tconst indicatorStartX = GAME_WIDTH / 2 - totalWidth / 2\n\n\t\tfor (let i = 0; i < this.totalRounds; i++) {\n\t\t\tconst indicator = this.add.circle(\n\t\t\t\tindicatorStartX + i * indicatorSpacing,\n\t\t\t\tindicatorY,\n\t\t\t\tindicatorRadius,\n\t\t\t\t0x666666, // Gray for pending\n\t\t\t\t1\n\t\t\t)\n\t\t\tindicator.setStrokeStyle(2, 0xffffff, 0.8)\n\t\t\tindicator.setDepth(15)\n\t\t\tthis.goalIndicators.push(indicator)\n\t\t}\n\n\t\t// Instruction text (center)\n\t\tthis.instructionText = this.add.text(GAME_WIDTH / 2, GAME_HEIGHT / 2, '', {\n\t\t\tfont: 'bold 22px Orbitron',\n\t\t\tcolor: '#ffffff',\n\t\t\tstroke: '#000000',\n\t\t\tstrokeThickness: 4,\n\t\t\talign: 'center',\n\t\t})\n\t\tthis.instructionText.setOrigin(0.5)\n\t\tthis.instructionText.setResolution(2)\n\t\tthis.instructionText.setDepth(20) // Above field lines\n\n\t\t// Result text\n\t\tthis.resultText = this.add.text(GAME_WIDTH / 2, GAME_HEIGHT / 2 - 50, '', {\n\t\t\tfont: 'bold 36px Orbitron',\n\t\t\tcolor: '#ffffff',\n\t\t\tstroke: '#000000',\n\t\t\tstrokeThickness: 5,\n\t\t\talign: 'center',\n\t\t})\n\t\tthis.resultText.setOrigin(0.5)\n\t\tthis.resultText.setResolution(2)\n\t\tthis.resultText.setDepth(20) // Above field lines\n\t\tthis.resultText.setVisible(false)\n\n\t\t// Gesture indicator for spin tutorial\n\t\tthis.gestureIndicator = this.add.text(\n\t\t\tGAME_WIDTH / 2,\n\t\t\tGAME_HEIGHT / 2 + 60,\n\t\t\t'',\n\t\t\t{\n\t\t\t\tfont: 'bold 28px Arial',\n\t\t\t}\n\t\t)\n\t\tthis.gestureIndicator.setOrigin(0.5)\n\t\tthis.gestureIndicator.setDepth(20)\n\t\tthis.gestureIndicator.setVisible(false)\n\n\t\tthis.updateUI()\n\t}\n\n\tprivate updateUI() {\n\t\tthis.roundText.setText(\n\t\t\t`Tiro ${this.gameState.round} de ${this.totalRounds}`\n\t\t)\n\t}\n\n\tprivate setupInput() {\n\t\tthis.input.on('pointerdown', this.handlePointerDown, this)\n\t\tthis.input.on('pointermove', this.handlePointerMove, this)\n\t\tthis.input.on('pointerup', this.handlePointerUp, this)\n\t}\n\n\tprivate handlePointerDown(pointer: Phaser.Input.Pointer) {\n\t\tif (this.gameState.phase === 'start') {\n\t\t\tthis.startRound()\n\t\t} else if (this.gameState.phase === 'aiming') {\n\t\t\t// Pokemon Go style - grab the ball\n\t\t\tconst distToBall = Phaser.Math.Distance.Between(\n\t\t\t\tpointer.x,\n\t\t\t\tpointer.y,\n\t\t\t\tthis.ball.x,\n\t\t\t\tthis.ball.y\n\t\t\t)\n\n\t\t\t// Must touch within ball radius + some tolerance\n\t\t\tif (distToBall < BALL.radius + 40) {\n\t\t\t\tthis.isDragging = true\n\t\t\t\tthis.dragStartPos = { x: BALL.startX, y: BALL.startY }\n\t\t\t\tthis.ballGrabOffset = {\n\t\t\t\t\tx: this.ball.x - pointer.x,\n\t\t\t\t\ty: this.ball.y - pointer.y,\n\t\t\t\t}\n\t\t\t\tthis.spinPoints = [{ x: pointer.x, y: pointer.y, time: this.time.now }]\n\t\t\t\tthis.accumulatedSpin = 0\n\t\t\t\tthis.swipeStartTime = this.time.now\n\n\t\t\t\t// Hide gesture indicator when player starts dragging\n\t\t\t\tthis.tweens.killTweensOf(this.gestureIndicator)\n\t\t\t\tthis.gestureIndicator.setVisible(false)\n\n\t\t\t\t// Visual feedback - ball grabbed (scale up slightly from base)\n\t\t\t\tconst grabScale = this.ball.scale * 1.15\n\t\t\t\tthis.tweens.killTweensOf(this.ball)\n\t\t\t\tthis.tweens.add({\n\t\t\t\t\ttargets: this.ball,\n\t\t\t\t\tscale: grabScale,\n\t\t\t\t\tduration: 100,\n\t\t\t\t\tease: 'Power2',\n\t\t\t\t})\n\n\t\t\t\t// Also keep legacy trajectory for fallback\n\t\t\t\tthis.isSwiping = true\n\t\t\t\tthis.trajectoryPoints = [{ x: BALL.startX, y: BALL.startY, time: 0 }]\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate handlePointerMove(pointer: Phaser.Input.Pointer) {\n\t\tif (this.gameState.phase === 'aiming' && this.isDragging) {\n\t\t\t// Calculate new ball position (follows finger with lag)\n\t\t\tconst targetX = pointer.x + this.ballGrabOffset.x\n\t\t\tconst targetY = pointer.y + this.ballGrabOffset.y\n\n\t\t\t// Constrain ball movement - can only move so far from start\n\t\t\tconst maxDragDistance = 150\n\t\t\tconst dx = targetX - BALL.startX\n\t\t\tconst dy = targetY - BALL.startY\n\t\t\tconst dist = Math.sqrt(dx * dx + dy * dy)\n\n\t\t\tlet newX = targetX\n\t\t\tlet newY = targetY\n\n\t\t\tif (dist > maxDragDistance) {\n\t\t\t\tconst ratio = maxDragDistance / dist\n\t\t\t\tnewX = BALL.startX + dx * ratio\n\t\t\t\tnewY = BALL.startY + dy * ratio\n\t\t\t}\n\n\t\t\t// Move ball with smoothing\n\t\t\tconst smoothFactor = 0.3\n\t\t\tconst smoothX = this.ball.x + (newX - this.ball.x) * smoothFactor\n\t\t\tconst smoothY = this.ball.y + (newY - this.ball.y) * smoothFactor\n\n\t\t\tthis.ball.setPosition(smoothX, smoothY)\n\t\t\tthis.ballShadow.setPosition(smoothX, smoothY + 10)\n\n\t\t\t// Track spin points for rotation detection\n\t\t\tthis.spinPoints.push({\n\t\t\t\tx: pointer.x,\n\t\t\t\ty: pointer.y,\n\t\t\t\ttime: this.time.now,\n\t\t\t})\n\n\t\t\t// Keep only recent points for spin calculation\n\t\t\tconst spinWindow = 500 // ms\n\t\t\tconst now = this.time.now\n\t\t\tthis.spinPoints = this.spinPoints.filter(p => now - p.time < spinWindow)\n\n\t\t\t// Calculate accumulated spin\n\t\t\tthis.accumulatedSpin = this.calculateSpinFromPoints()\n\t\t\tthis.updateSpinIndicator(this.accumulatedSpin)\n\n\t\t\t// Draw ball trail\n\t\t\tthis.drawBallTrail()\n\n\t\t\t// Calculate current speed and update power bar\n\t\t\tconst currentSpeed = this.calculateInstantaneousSpeed()\n\t\t\tconst power = Math.min(100, Math.max(30, currentSpeed / 10))\n\t\t\tthis.updatePowerBar(power)\n\n\t\t\t// Calculate projected target and show indicator\n\t\t\t// Only show projection when NOT spinning (spin confuses the projection)\n\t\t\tconst isSpinning = Math.abs(this.accumulatedSpin) >= 0.15\n\n\t\t\tif (!isSpinning) {\n\t\t\t\t// Project where ball would go based on current drag direction\n\t\t\t\tconst dragVector = {\n\t\t\t\t\tx: this.ball.x - BALL.startX,\n\t\t\t\t\ty: this.ball.y - BALL.startY,\n\t\t\t\t}\n\n\t\t\t\t// Project toward goal\n\t\t\t\tif (dragVector.y < -10) {\n\t\t\t\t\t// Moving upward\n\t\t\t\t\tconst projectedY = GOAL.topY + (GOAL.bottomY - GOAL.topY) / 2\n\t\t\t\t\tconst projectionScale = (projectedY - BALL.startY) / dragVector.y\n\t\t\t\t\tconst projectedX = BALL.startX + dragVector.x * projectionScale\n\n\t\t\t\t\tthis.updateProjectionIndicator(projectedX, projectedY)\n\t\t\t\t} else {\n\t\t\t\t\tthis.projectionGraphics.clear()\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Hide projection during spin - only show spin indicator\n\t\t\t\tthis.projectionGraphics.clear()\n\t\t\t}\n\n\t\t\t// Legacy trajectory tracking\n\t\t\tconst elapsed = this.time.now - this.swipeStartTime\n\t\t\tthis.trajectoryPoints.push({\n\t\t\t\tx: pointer.x,\n\t\t\t\ty: pointer.y,\n\t\t\t\ttime: elapsed,\n\t\t\t})\n\t\t\tif (this.trajectoryPoints.length > 100) {\n\t\t\t\tthis.trajectoryPoints.shift()\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate handlePointerUp(_pointer: Phaser.Input.Pointer) {\n\t\tif (this.gameState.phase === 'aiming' && this.isDragging) {\n\t\t\tthis.isDragging = false\n\t\t\tthis.isSwiping = false\n\n\t\t\t// Hide goal zone guides\n\t\t\tthis.hideGoalZoneGuides()\n\n\t\t\t// Calculate release velocity from recent movement\n\t\t\tconst releaseVelocity = this.calculateReleaseVelocity()\n\n\t\t\t// Check if ball was released with upward momentum (toward goal)\n\t\t\tif (releaseVelocity.y < -50 && this.spinPoints.length >= 3) {\n\t\t\t\t// Clear visuals\n\t\t\t\tthis.trajectoryGraphics.clear()\n\t\t\t\tthis.projectionGraphics.clear()\n\t\t\t\tthis.ballTrail.clear()\n\t\t\t\tthis.spinIndicator.setAlpha(0)\n\t\t\t\tthis.sparkSprite.setVisible(false)\n\t\t\t\tthis.sparkSprite.stop()\n\t\t\t\tthis.hidePowerBar()\n\n\t\t\t\t// Execute the shot\n\t\t\t\tthis.executeDragShot(releaseVelocity)\n\t\t\t} else {\n\t\t\t\t// Not enough momentum - reset ball position\n\t\t\t\tconst ballBaseScale = (BALL.radius * 1.5) / this.ball.width\n\t\t\t\tthis.tweens.add({\n\t\t\t\t\ttargets: this.ball,\n\t\t\t\t\tx: BALL.startX,\n\t\t\t\t\ty: BALL.startY,\n\t\t\t\t\tscale: ballBaseScale,\n\t\t\t\t\tduration: 200,\n\t\t\t\t\tease: 'Power2',\n\t\t\t\t})\n\t\t\t\tthis.tweens.add({\n\t\t\t\t\ttargets: this.ballShadow,\n\t\t\t\t\tx: BALL.startX,\n\t\t\t\t\ty: BALL.startY + 8,\n\t\t\t\t\tduration: 200,\n\t\t\t\t\tease: 'Power2',\n\t\t\t\t})\n\n\t\t\t\tthis.trajectoryGraphics.clear()\n\t\t\t\tthis.projectionGraphics.clear()\n\t\t\t\tthis.ballTrail.clear()\n\t\t\t\tthis.spinIndicator.setAlpha(0)\n\t\t\t\tthis.sparkSprite.setVisible(false)\n\t\t\t\tthis.sparkSprite.stop()\n\n\t\t\t\tthis.instructionText.setText('Arrastra hacia arriba\\ncon ms fuerza')\n\n\t\t\t\t// Show guides again (power bar stays visible)\n\t\t\t\tthis.showGoalZoneGuides()\n\t\t\t}\n\n\t\t\t// Reset spin state\n\t\t\tthis.spinPoints = []\n\t\t\tthis.accumulatedSpin = 0\n\t\t}\n\t}\n\n\tprivate calculateSpinFromPoints(): number {\n\t\tif (this.spinPoints.length < 5) return 0\n\n\t\t// Calculate angular velocity around ball center\n\t\tlet totalAngularChange = 0\n\t\tlet validSamples = 0\n\n\t\tconst centerX = this.ball.x\n\t\tconst centerY = this.ball.y\n\n\t\tfor (let i = 1; i < this.spinPoints.length; i++) {\n\t\t\tconst prev = this.spinPoints[i - 1]\n\t\t\tconst curr = this.spinPoints[i]\n\n\t\t\t// Calculate angles from ball center\n\t\t\tconst prevAngle = Math.atan2(prev.y - centerY, prev.x - centerX)\n\t\t\tconst currAngle = Math.atan2(curr.y - centerY, curr.x - centerX)\n\n\t\t\t// Calculate angular change\n\t\t\tlet angleDiff = currAngle - prevAngle\n\n\t\t\t// Normalize to [-PI, PI]\n\t\t\twhile (angleDiff > Math.PI) angleDiff -= 2 * Math.PI\n\t\t\twhile (angleDiff < -Math.PI) angleDiff += 2 * Math.PI\n\n\t\t\t// Only count if the point is far enough from center (actual rotation)\n\t\t\tconst distFromCenter = Math.sqrt(\n\t\t\t\tMath.pow(curr.x - centerX, 2) + Math.pow(curr.y - centerY, 2)\n\t\t\t)\n\t\t\tif (distFromCenter > 20) {\n\t\t\t\ttotalAngularChange += angleDiff\n\t\t\t\tvalidSamples++\n\t\t\t}\n\t\t}\n\n\t\tif (validSamples < 3) return 0\n\n\t\t// Normalize spin value (-1 to 1)\n\t\t// Positive = clockwise = right curve\n\t\t// Negative = counter-clockwise = left curve\n\t\tconst avgAngularVelocity = totalAngularChange / validSamples\n\t\treturn Phaser.Math.Clamp(avgAngularVelocity * 3, -1, 1)\n\t}\n\n\tprivate calculateReleaseVelocity(): { x: number; y: number; speed: number } {\n\t\tif (this.spinPoints.length < 2) {\n\t\t\treturn { x: 0, y: 0, speed: 0 }\n\t\t}\n\n\t\t// Get recent points for velocity calculation\n\t\tconst recentPoints = this.spinPoints.slice(-5)\n\t\tif (recentPoints.length < 2) {\n\t\t\treturn { x: 0, y: 0, speed: 0 }\n\t\t}\n\n\t\tconst first = recentPoints[0]\n\t\tconst last = recentPoints[recentPoints.length - 1]\n\t\tconst dt = (last.time - first.time) / 1000 // seconds\n\n\t\tif (dt <= 0) return { x: 0, y: 0, speed: 0 }\n\n\t\tconst vx = (last.x - first.x) / dt\n\t\tconst vy = (last.y - first.y) / dt\n\t\tconst speed = Math.sqrt(vx * vx + vy * vy)\n\n\t\treturn { x: vx, y: vy, speed }\n\t}\n\n\t// Calculate current movement speed for real-time visual feedback\n\tprivate calculateInstantaneousSpeed(): number {\n\t\tif (this.spinPoints.length < 3) return 0\n\n\t\t// Use last 3 points to calculate current speed\n\t\tconst recentPoints = this.spinPoints.slice(-3)\n\t\tconst first = recentPoints[0]\n\t\tconst last = recentPoints[recentPoints.length - 1]\n\t\tconst dt = (last.time - first.time) / 1000 // seconds\n\n\t\tif (dt <= 0) return 0\n\n\t\tconst dx = last.x - first.x\n\t\tconst dy = last.y - first.y\n\t\tconst speed = Math.sqrt(dx * dx + dy * dy) / dt\n\n\t\treturn speed\n\t}\n\n\t// Create power bar UI for strength visualization\n\tprivate createPowerBar() {\n\t\tconst { x, y, width, height } = POWER_BAR_UI\n\n\t\t// Background bar with zone colors\n\t\tthis.powerBarGraphics = this.add.graphics()\n\t\tthis.powerBarGraphics.setDepth(10)\n\n\t\t// Draw zone backgrounds (bottom to top)\n\t\t// Yellow zone (bottom 40%)\n\t\tthis.powerBarGraphics.fillStyle(0xfbbf24, 0.3)\n\t\tthis.powerBarGraphics.fillRect(x, y + height * 0.6, width, height * 0.4)\n\n\t\t// Green zone (middle 35%)\n\t\tthis.powerBarGraphics.fillStyle(0x22c55e, 0.3)\n\t\tthis.powerBarGraphics.fillRect(x, y + height * 0.25, width, height * 0.35)\n\n\t\t// Red zone (top 25%)\n\t\tthis.powerBarGraphics.fillStyle(0xef4444, 0.3)\n\t\tthis.powerBarGraphics.fillRect(x, y, width, height * 0.25)\n\n\t\t// Border\n\t\tthis.powerBarGraphics.lineStyle(2, 0xffffff, 0.8)\n\t\tthis.powerBarGraphics.strokeRect(x, y, width, height)\n\n\t\t// Fill indicator (separate graphics for easy updates)\n\t\tthis.powerBarFill = this.add.graphics()\n\t\tthis.powerBarFill.setDepth(11)\n\n\t\t// Initially hidden\n\t\tthis.powerBarGraphics.setVisible(false)\n\t\tthis.powerBarFill.setVisible(false)\n\t}\n\n\t// Update power bar fill based on current power (with smoothing)\n\tprivate updatePowerBar(targetPower: number) {\n\t\tconst { x, y, width, height } = POWER_BAR_UI\n\n\t\t// Smooth the power value using lerp (0.15 = responsive but smooth)\n\t\tconst smoothFactor = 0.15\n\t\tthis.smoothedPower = Phaser.Math.Linear(\n\t\t\tthis.smoothedPower,\n\t\t\ttargetPower,\n\t\t\tsmoothFactor\n\t\t)\n\n\t\tthis.powerBarFill.clear()\n\n\t\t// Calculate fill height (power is 30-100, normalize to 0-1)\n\t\tconst normalizedPower = (this.smoothedPower - 30) / 70 // 0 to 1\n\t\tconst fillHeight = height * Math.max(0, normalizedPower)\n\n\t\t// Determine current zone color\n\t\tlet fillColor: number\n\t\tif (normalizedPower < 0.4) {\n\t\t\tfillColor = 0xfbbf24 // Yellow\n\t\t} else if (normalizedPower < 0.75) {\n\t\t\tfillColor = 0x22c55e // Green\n\t\t} else {\n\t\t\tfillColor = 0xef4444 // Red\n\t\t}\n\n\t\t// Draw fill from bottom up\n\t\tthis.powerBarFill.fillStyle(fillColor, 0.9)\n\t\tthis.powerBarFill.fillRect(\n\t\t\tx + 2,\n\t\t\ty + height - fillHeight,\n\t\t\twidth - 4,\n\t\t\tfillHeight\n\t\t)\n\t}\n\n\t// Show power bar\n\tprivate showPowerBar() {\n\t\tthis.powerBarGraphics.setVisible(true)\n\t\tthis.powerBarFill.setVisible(true)\n\t}\n\n\t// Hide power bar\n\tprivate hidePowerBar() {\n\t\tthis.powerBarGraphics.setVisible(false)\n\t\tthis.powerBarFill.setVisible(false)\n\t\tthis.powerBarFill.clear()\n\t}\n\n\tprivate drawBallTrail() {\n\t\tthis.ballTrail.clear()\n\n\t\tif (this.spinPoints.length < 3) return\n\n\t\t// Draw trail behind ball (white color)\n\t\tthis.ballTrail.lineStyle(4, 0xffffff, 0.3)\n\t\tthis.ballTrail.beginPath()\n\n\t\tconst points = this.spinPoints.slice(-15)\n\t\tfor (let i = 0; i < points.length; i++) {\n\t\t\tconst alpha = i / points.length\n\t\t\tthis.ballTrail.lineStyle(4 * alpha, 0xffffff, 0.3 * alpha)\n\n\t\t\tif (i === 0) {\n\t\t\t\tthis.ballTrail.moveTo(points[i].x, points[i].y)\n\t\t\t} else {\n\t\t\t\tthis.ballTrail.lineTo(points[i].x, points[i].y)\n\t\t\t}\n\t\t}\n\n\t\tthis.ballTrail.strokePath()\n\t}\n\n\tprivate executeDragShot(velocity: { x: number; y: number; speed: number }) {\n\t\tthis.gameState.phase = 'shooting'\n\t\tthis.instructionText.setText('')\n\t\tpenaltyShootoutAudio.playKick()\n\n\t\t// Calculate power from velocity\n\t\tconst power = Math.min(100, Math.max(30, velocity.speed / 10))\n\t\tthis.gameState.power = power\n\n\t\t// Calculate target X position based on release direction\n\t\tconst ballX = this.ball.x\n\t\tconst ballY = this.ball.y\n\n\t\t// Normalize velocity direction\n\t\tconst vMag = Math.sqrt(velocity.x * velocity.x + velocity.y * velocity.y)\n\t\tconst vNormX = velocity.x / vMag\n\t\tconst vNormY = velocity.y / vMag\n\n\t\t// Project to goal line for X position\n\t\tconst goalCenterY = (GOAL.topY + GOAL.bottomY) / 2\n\t\tconst projectDist = (goalCenterY - ballY) / vNormY\n\t\tlet targetX = ballX + vNormX * projectDist\n\n\t\t// Clamp X to goal bounds\n\t\ttargetX = Phaser.Math.Clamp(\n\t\t\ttargetX,\n\t\t\tGOAL.x - GOAL.width / 2 + 15,\n\t\t\tGOAL.x + GOAL.width / 2 - 15\n\t\t)\n\n\t\t// Use accumulated spin for curve (negated so clockwise spin = left curve)\n\t\tconst curveDirection = -this.accumulatedSpin\n\n\t\t// Check for weak shot that falls short (power < 35%)\n\t\tif (power < 35) {\n\t\t\tthis.animateFallShort(targetX, curveDirection)\n\t\t\treturn\n\t\t}\n\n\t\t// Calculate target Y based on power (vertical targeting)\n\t\tconst goalHeight = GOAL.bottomY - GOAL.topY\n\t\tlet targetY: number\n\n\t\tif (power < 55) {\n\t\t\t// Weak shot - bottom row\n\t\t\ttargetY = GOAL.bottomY - goalHeight / 6\n\t\t} else if (power < 80) {\n\t\t\t// Normal shot - middle row\n\t\t\ttargetY = GOAL.topY + goalHeight / 2\n\t\t} else {\n\t\t\t// Strong shot - top row (can reach corners)\n\t\t\ttargetY = GOAL.topY + goalHeight / 6\n\t\t}\n\n\t\t// Clamp Y to goal bounds\n\t\ttargetY = Phaser.Math.Clamp(targetY, GOAL.topY + 10, GOAL.bottomY - 10)\n\n\t\tthis.gameState.aimPosition = { x: targetX, y: targetY }\n\n\t\t// Determine goalkeeper dive\n\t\tconst goalkeeperDive = this.decideGoalkeeperDive(targetX, curveDirection)\n\n\t\t// Check for miss (very powerful shots go over the bar)\n\t\tconst missChance = power > 95 ? 0.25 : power > 90 ? 0.1 : 0\n\t\tif (Math.random() < missChance) {\n\t\t\tthis.animateMiss({ x: targetX, y: targetY }, curveDirection)\n\t\t\treturn\n\t\t}\n\n\t\t// Animate the curved shot\n\t\tthis.animateCurvedShot(\n\t\t\t{ x: targetX, y: targetY },\n\t\t\tpower,\n\t\t\tcurveDirection,\n\t\t\tgoalkeeperDive\n\t\t)\n\t}\n\n\tprivate showStartScreen() {\n\t\tthis.gameState.phase = 'start'\n\t\tthis.instructionText.setText('Toca para comenzar\\n')\n\n\t\t// Pulse animation\n\t\tthis.tweens.add({\n\t\t\ttargets: this.instructionText,\n\t\t\talpha: { from: 1, to: 0.5 },\n\t\t\tduration: 800,\n\t\t\tyoyo: true,\n\t\t\trepeat: -1,\n\t\t})\n\t}\n\n\tprivate startRound() {\n\t\tthis.tweens.killTweensOf(this.instructionText)\n\t\tthis.instructionText.setAlpha(1)\n\n\t\tthis.currentDifficulty = DIFFICULTY[Math.min(this.gameState.round, 5)]\n\t\tthis.startAimingPhase()\n\t}\n\n\tprivate startAimingPhase() {\n\t\tthis.gameState.phase = 'aiming'\n\t\tthis.trajectoryPoints = []\n\t\tthis.trajectoryGraphics.clear()\n\t\tthis.projectionGraphics.clear()\n\n\t\t// Reset drag/spin state\n\t\tthis.isDragging = false\n\t\tthis.dragStartPos = null\n\t\tthis.spinPoints = []\n\t\tthis.accumulatedSpin = 0\n\t\tthis.spinIndicator.setAlpha(0)\n\t\tthis.sparkSprite.setVisible(false)\n\t\tthis.sparkSprite.stop()\n\t\tthis.ballTrail.clear()\n\t\tthis.smoothedPower = 30 // Reset power bar\n\n\t\t// Show goal zone guides and power bar\n\t\tthis.showGoalZoneGuides()\n\t\tthis.showPowerBar()\n\n\t\tthis.instructionText.setText(\n\t\t\t'Arrastra el baln hacia la portera\\nPuedes girar para curvar el tiro'\n\t\t)\n\t\tthis.instructionText.setFontSize(18)\n\n\t\t// Show animated gesture indicator\n\t\tthis.gestureIndicator.setVisible(true)\n\t\tconst gestureCenterX = GAME_WIDTH / 2\n\t\tconst gestureCenterY = GAME_HEIGHT / 2 + 60\n\t\tconst gestureRadius = 20\n\t\tthis.tweens.killTweensOf(this.gestureIndicator)\n\t\tthis.tweens.addCounter({\n\t\t\tfrom: 0,\n\t\t\tto: 360,\n\t\t\tduration: 1200,\n\t\t\trepeat: -1,\n\t\t\tonUpdate: tween => {\n\t\t\t\tconst angle = Phaser.Math.DegToRad(tween.getValue() ?? 0)\n\t\t\t\tthis.gestureIndicator.x =\n\t\t\t\t\tgestureCenterX + Math.cos(angle) * gestureRadius\n\t\t\t\tthis.gestureIndicator.y =\n\t\t\t\t\tgestureCenterY + Math.sin(angle) * gestureRadius\n\t\t\t},\n\t\t})\n\n\t\t// Highlight the ball to show where to start\n\t\tconst baseScale = this.ball.scale\n\t\tthis.tweens.add({\n\t\t\ttargets: this.ball,\n\t\t\tscale: { from: baseScale, to: baseScale * 1.15 },\n\t\t\tduration: 500,\n\t\t\tyoyo: true,\n\t\t\trepeat: 2,\n\t\t\tonComplete: () => {\n\t\t\t\tthis.ball.setScale(baseScale)\n\t\t\t},\n\t\t})\n\t}\n\n\tprivate calculateCurveDirection(): number {\n\t\t// Calculate the average horizontal deviation from straight line\n\t\tif (this.trajectoryPoints.length < 3) return 0\n\n\t\tconst start = this.trajectoryPoints[0]\n\t\tconst end = this.trajectoryPoints[this.trajectoryPoints.length - 1]\n\n\t\t// Line from start to end\n\t\tconst lineAngle = Math.atan2(end.y - start.y, end.x - start.x)\n\n\t\t// Check deviation of middle points\n\t\tlet totalDeviation = 0\n\t\tconst midPoints = this.trajectoryPoints.slice(\n\t\t\t1,\n\t\t\tthis.trajectoryPoints.length - 1\n\t\t)\n\n\t\tfor (const point of midPoints) {\n\t\t\t// Calculate expected position on straight line\n\t\t\tconst t =\n\t\t\t\tPhaser.Math.Distance.Between(start.x, start.y, point.x, point.y) /\n\t\t\t\tPhaser.Math.Distance.Between(start.x, start.y, end.x, end.y)\n\n\t\t\tconst expectedX = start.x + (end.x - start.x) * t\n\t\t\tconst expectedY = start.y + (end.y - start.y) * t\n\n\t\t\t// Deviation perpendicular to line\n\t\t\tconst perpAngle = lineAngle + Math.PI / 2\n\t\t\tconst deviation =\n\t\t\t\t(point.x - expectedX) * Math.cos(perpAngle) +\n\t\t\t\t(point.y - expectedY) * Math.sin(perpAngle)\n\n\t\t\ttotalDeviation += deviation\n\t\t}\n\n\t\t// Normalize curve (-1 = strong left curve, 1 = strong right curve)\n\t\tconst avgDeviation = totalDeviation / midPoints.length\n\t\treturn Phaser.Math.Clamp(avgDeviation / 50, -1, 1)\n\t}\n\n\tprivate decideGoalkeeperDive(\n\t\ttargetX: number,\n\t\tcurveDirection: number\n\t): 'left' | 'right' | 'center' {\n\t\tconst goalCenter = GOAL.x\n\t\tconst threshold = GOAL.width / 4\n\n\t\t// Where the ball will end up\n\t\tlet finalDirection: 'left' | 'right' | 'center'\n\t\tif (targetX < goalCenter - threshold) {\n\t\t\tfinalDirection = 'left'\n\t\t} else if (targetX > goalCenter + threshold) {\n\t\t\tfinalDirection = 'right'\n\t\t} else {\n\t\t\tfinalDirection = 'center'\n\t\t}\n\n\t\t// Curve can fool the goalkeeper!\n\t\t// If there's significant curve, goalkeeper might guess wrong initially\n\t\tconst curveFoolChance = Math.abs(curveDirection) * 0.3\n\n\t\tif (\n\t\t\tMath.random() <\n\t\t\tthis.currentDifficulty.correctDiveChance - curveFoolChance\n\t\t) {\n\t\t\treturn finalDirection // Correct guess\n\t\t} else {\n\t\t\t// Wrong guess\n\t\t\tconst directions: ('left' | 'right' | 'center')[] = [\n\t\t\t\t'left',\n\t\t\t\t'right',\n\t\t\t\t'center',\n\t\t\t]\n\t\t\tconst wrongDirections = directions.filter(d => d !== finalDirection)\n\t\t\treturn wrongDirections[Math.floor(Math.random() * wrongDirections.length)]\n\t\t}\n\t}\n\n\tprivate animateCurvedShot(\n\t\ttarget: { x: number; y: number },\n\t\tpower: number,\n\t\tcurveDirection: number,\n\t\tgoalkeeperDive: 'left' | 'right' | 'center'\n\t) {\n\t\t// Ball travel duration based on power\n\t\tconst travelDuration = TIMING.ballTravelDuration * (1.8 - power / 150)\n\n\t\t// Create curved path using control points\n\t\t// Start from ball's CURRENT position (after dragging), not fixed start\n\t\tconst startX = this.ball.x\n\t\tconst startY = this.ball.y\n\t\tconst currentScale = this.ball.scale\n\n\t\t// Control point for curve (offset based on curve direction)\n\t\tconst midY = (startY + target.y) / 2\n\t\tconst curveOffset = curveDirection * 80 // Max 80px curve\n\t\tconst controlX = (startX + target.x) / 2 + curveOffset\n\t\tconst controlY = midY\n\n\t\t// Create bezier curve\n\t\tconst curve = new Phaser.Curves.QuadraticBezier(\n\t\t\tnew Phaser.Math.Vector2(startX, startY),\n\t\t\tnew Phaser.Math.Vector2(controlX, controlY),\n\t\t\tnew Phaser.Math.Vector2(target.x, target.y)\n\t\t)\n\n\t\t// Clear the trajectory preview\n\t\tthis.trajectoryGraphics.clear()\n\n\t\t// Animate ball along curve\n\t\tconst pathFollower = { t: 0 }\n\t\tthis.tweens.add({\n\t\t\ttargets: pathFollower,\n\t\t\tt: 1,\n\t\t\tduration: travelDuration,\n\t\t\tease: 'Sine.easeIn',\n\t\t\tonUpdate: () => {\n\t\t\t\tconst point = curve.getPoint(pathFollower.t)\n\t\t\t\tthis.ball.setPosition(point.x, point.y)\n\n\t\t\t\t// Shadow follows on ground plane\n\t\t\t\tthis.ballShadow.setPosition(\n\t\t\t\t\tpoint.x,\n\t\t\t\t\tpoint.y + 20 * (1 - pathFollower.t)\n\t\t\t\t)\n\t\t\t},\n\t\t})\n\n\t\t// Ball scale (perspective effect) - shrink as ball moves away\n\t\tthis.tweens.add({\n\t\t\ttargets: this.ball,\n\t\t\tscale: { from: currentScale, to: currentScale * 0.6 },\n\t\t\tduration: travelDuration,\n\t\t\tease: 'Sine.easeIn',\n\t\t})\n\n\t\t// Ball rotation - more rotation for curved shots\n\t\tconst rotationAmount = 720 + Math.abs(curveDirection) * 360\n\t\tthis.tweens.add({\n\t\t\ttargets: this.ball,\n\t\t\tangle: curveDirection > 0 ? rotationAmount : -rotationAmount,\n\t\t\tduration: travelDuration,\n\t\t})\n\n\t\t// Shadow fade\n\t\tthis.tweens.add({\n\t\t\ttargets: this.ballShadow,\n\t\t\tscale: { from: 1, to: 0.4 },\n\t\t\talpha: { from: 0.3, to: 0.1 },\n\t\t\tduration: travelDuration,\n\t\t})\n\n\t\t// Goalkeeper dive\n\t\tthis.time.delayedCall(this.currentDifficulty.reactionSpeed, () => {\n\t\t\tthis.animateGoalkeeperDive(goalkeeperDive)\n\t\t})\n\n\t\t// Check result after ball arrives\n\t\tthis.time.delayedCall(travelDuration + 100, () => {\n\t\t\tthis.checkShotResult(target, goalkeeperDive, power, curveDirection)\n\t\t})\n\t}\n\n\tprivate animateGoalkeeperDive(direction: 'left' | 'right' | 'center') {\n\t\tlet targetX = GOALKEEPER.startX\n\n\t\tif (direction === 'left') {\n\t\t\ttargetX = GOALKEEPER.startX - GOALKEEPER.diveDistance\n\t\t\t// Flip sprite for left dive (sprite faces right by default)\n\t\t\tthis.goalkeeper.setFlipX(true)\n\t\t\t// Play dive animation\n\t\t\tthis.goalkeeper.play('gk-dive')\n\t\t} else if (direction === 'right') {\n\t\t\ttargetX = GOALKEEPER.startX + GOALKEEPER.diveDistance\n\t\t\t// No flip needed for right dive\n\t\t\tthis.goalkeeper.setFlipX(false)\n\t\t\t// Play dive animation\n\t\t\tthis.goalkeeper.play('gk-dive')\n\t\t} else {\n\t\t\t// Center - just crouch or jump\n\t\t\tthis.goalkeeper.setFlipX(false)\n\t\t\tthis.goalkeeper.play('gk-crouch')\n\t\t}\n\n\t\t// Animate position\n\t\tthis.tweens.add({\n\t\t\ttargets: this.goalkeeper,\n\t\t\tx: targetX,\n\t\t\tduration: 300,\n\t\t\tease: 'Power2',\n\t\t})\n\t}\n\n\tprivate animateMiss(\n\t\ttarget: { x: number; y: number },\n\t\tcurveDirection: number\n\t) {\n\t\t// Miss target - over the bar or wide\n\t\tconst missTarget = {\n\t\t\tx: target.x + curveDirection * 50 + (Math.random() - 0.5) * 80,\n\t\t\ty: target.y - 80 - Math.random() * 80,\n\t\t}\n\n\t\t// Clear all graphics\n\t\tthis.trajectoryGraphics.clear()\n\t\tthis.projectionGraphics.clear()\n\t\tthis.ballTrail.clear()\n\t\tthis.spinIndicator.setAlpha(0)\n\t\tthis.sparkSprite.setVisible(false)\n\t\tthis.sparkSprite.stop()\n\n\t\tconst currentScale = this.ball.scale\n\n\t\tthis.tweens.add({\n\t\t\ttargets: this.ball,\n\t\t\tx: missTarget.x,\n\t\t\ty: missTarget.y,\n\t\t\tduration: 600,\n\t\t\tease: 'Quad.easeOut',\n\t\t})\n\n\t\tthis.tweens.add({\n\t\t\ttargets: this.ball,\n\t\t\tscale: { from: currentScale, to: 0.3 },\n\t\t\talpha: { from: 1, to: 0 },\n\t\t\tduration: 600,\n\t\t})\n\n\t\tthis.tweens.add({\n\t\t\ttargets: this.ballShadow,\n\t\t\talpha: 0,\n\t\t\tduration: 300,\n\t\t})\n\n\t\t// Goalkeeper reacts\n\t\tconst randomDive = ['left', 'right', 'center'][\n\t\t\tMath.floor(Math.random() * 3)\n\t\t] as 'left' | 'right' | 'center'\n\t\tthis.time.delayedCall(200, () => {\n\t\t\tthis.animateGoalkeeperDive(randomDive)\n\t\t})\n\n\t\tthis.time.delayedCall(700, () => {\n\t\t\tthis.showResult('miss')\n\t\t})\n\t}\n\n\t// Animation for weak shots that fall short of the goal\n\tprivate animateFallShort(targetX: number, curveDirection: number) {\n\t\t// Ball lands in front of goal\n\t\tconst shortTarget = {\n\t\t\tx: targetX + curveDirection * 30,\n\t\t\ty: GOAL.bottomY + 60, // In front of goal line\n\t\t}\n\n\t\t// Clear all graphics\n\t\tthis.trajectoryGraphics.clear()\n\t\tthis.projectionGraphics.clear()\n\t\tthis.ballTrail.clear()\n\t\tthis.spinIndicator.setAlpha(0)\n\t\tthis.sparkSprite.setVisible(false)\n\t\tthis.sparkSprite.stop()\n\n\t\tconst currentScale = this.ball.scale\n\n\t\t// Ball rolls forward but falls short\n\t\tthis.tweens.add({\n\t\t\ttargets: this.ball,\n\t\t\tx: shortTarget.x,\n\t\t\ty: shortTarget.y,\n\t\t\tduration: 500,\n\t\t\tease: 'Quad.easeOut',\n\t\t})\n\n\t\t// Ball shrinks and fades as it \"rolls away\"\n\t\tthis.tweens.add({\n\t\t\ttargets: this.ball,\n\t\t\tscale: { from: currentScale, to: 0.4 },\n\t\t\talpha: { from: 1, to: 0.3 },\n\t\t\tduration: 500,\n\t\t})\n\n\t\tthis.tweens.add({\n\t\t\ttargets: this.ballShadow,\n\t\t\tx: shortTarget.x,\n\t\t\ty: shortTarget.y + 8,\n\t\t\talpha: 0.3,\n\t\t\tduration: 500,\n\t\t})\n\n\t\t// Goalkeeper stays put and watches\n\t\tthis.time.delayedCall(600, () => {\n\t\t\tthis.showResult('miss')\n\t\t})\n\t}\n\n\tprivate checkShotResult(\n\t\ttarget: { x: number; y: number },\n\t\tgoalkeeperDive: 'left' | 'right' | 'center',\n\t\tpower: number,\n\t\tcurveDirection: number\n\t) {\n\t\tconst goalCenter = GOAL.x\n\t\tconst threshold = GOAL.width / 4\n\n\t\tlet shotDirection: 'left' | 'right' | 'center'\n\t\tif (target.x < goalCenter - threshold) {\n\t\t\tshotDirection = 'left'\n\t\t} else if (target.x > goalCenter + threshold) {\n\t\t\tshotDirection = 'right'\n\t\t} else {\n\t\t\tshotDirection = 'center'\n\t\t}\n\n\t\t// If goalkeeper dove correct direction, check coverage\n\t\tif (goalkeeperDive === shotDirection) {\n\t\t\tconst goalkeeperX =\n\t\t\t\tgoalkeeperDive === 'left'\n\t\t\t\t\t? GOALKEEPER.startX - GOALKEEPER.diveDistance\n\t\t\t\t\t: goalkeeperDive === 'right'\n\t\t\t\t\t\t? GOALKEEPER.startX + GOALKEEPER.diveDistance\n\t\t\t\t\t\t: GOALKEEPER.startX\n\n\t\t\tconst distance = Math.abs(target.x - goalkeeperX)\n\t\t\tconst baseCoverage =\n\t\t\t\tGOALKEEPER.width * (1 + this.currentDifficulty.saveCoverage)\n\n\t\t\t// Power factor: faster shots are harder to save (reduces coverage)\n\t\t\t// At power 50 = 1.0x, at power 100 = 0.5x coverage\n\t\t\tconst powerFactor = Math.max(0.5, 1 - (power - 50) / 100)\n\n\t\t\t// Curve factor: curve balls are harder to save (reduces coverage)\n\t\t\t// Straight shot (curve 0) = 1.2x coverage (easier), max curve = 0.6x coverage\n\t\t\tconst curveAmount = Math.abs(curveDirection)\n\t\t\tconst curveFactor = 1.2 - curveAmount * 0.6\n\n\t\t\t// Top corners are harder to save\n\t\t\tconst goalTopY =\n\t\t\t\t(GOAL as { topY?: number }).topY ?? GOAL.y - GOAL.height / 2\n\t\t\tconst goalMidY = goalTopY + GOAL.height / 4\n\t\t\tconst isTopCorner =\n\t\t\t\ttarget.y < goalMidY &&\n\t\t\t\t(target.x < GOAL.x - GOAL.width / 3 ||\n\t\t\t\t\ttarget.x > GOAL.x + GOAL.width / 3)\n\n\t\t\tconst cornerFactor = isTopCorner ? 0.5 : 1.0\n\n\t\t\t// Combined effective coverage\n\t\t\tconst effectiveCoverage =\n\t\t\t\tbaseCoverage * powerFactor * curveFactor * cornerFactor\n\n\t\t\tif (distance < effectiveCoverage) {\n\t\t\t\tthis.showResult('save')\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\n\t\t// GOAL!\n\t\tthis.showResult('goal')\n\t}\n\n\tprivate showResult(result: ShotResult) {\n\t\tthis.gameState.phase = 'result'\n\t\tthis.gameState.lastResult = result\n\n\t\t// Play result sound\n\t\tif (result === 'goal') {\n\t\t\tpenaltyShootoutAudio.playGoal()\n\t\t} else if (result === 'save') {\n\t\t\tpenaltyShootoutAudio.playSave()\n\t\t} else {\n\t\t\tpenaltyShootoutAudio.playMiss()\n\t\t}\n\n\t\t// Calculate points\n\t\tlet points = 0\n\t\tconst bonuses = { corner: false, curve: false, streak: 0 }\n\n\t\tif (result === 'goal') {\n\t\t\tpoints = SCORING.baseGoal\n\n\t\t\t// Check corner bonus\n\t\t\tconst aimPos = this.gameState.aimPosition!\n\t\t\tconst cornerGoalTopY =\n\t\t\t\t(GOAL as { topY?: number }).topY ?? GOAL.y - GOAL.height / 2\n\t\t\tconst cornerMidY = cornerGoalTopY + GOAL.height / 4\n\t\t\tconst isCorner =\n\t\t\t\taimPos.y < cornerMidY &&\n\t\t\t\t(aimPos.x < GOAL.x - GOAL.width / 3 ||\n\t\t\t\t\taimPos.x > GOAL.x + GOAL.width / 3)\n\t\t\tif (isCorner) {\n\t\t\t\tpoints += SCORING.cornerBonus\n\t\t\t\tbonuses.corner = true\n\t\t\t}\n\n\t\t\t// Curve bonus (replaces perfect power bonus)\n\t\t\tconst curveAmount = Math.abs(this.calculateCurveDirection())\n\t\t\tif (curveAmount > 0.5) {\n\t\t\t\tpoints += SCORING.perfectPowerBonus // Reuse this for curve bonus\n\t\t\t\tbonuses.curve = true\n\t\t\t}\n\n\t\t\t// Streak bonus\n\t\t\tthis.gameState.consecutiveGoals++\n\t\t\tif (this.gameState.consecutiveGoals > 1) {\n\t\t\t\tconst streakBonus =\n\t\t\t\t\t(this.gameState.consecutiveGoals - 1) * SCORING.streakBonusPerGoal\n\t\t\t\tpoints += streakBonus\n\t\t\t\tbonuses.streak = this.gameState.consecutiveGoals\n\t\t\t}\n\n\t\t\tthis.gameState.goals++\n\t\t\tthis.gameState.totalScore += points\n\t\t} else {\n\t\t\tthis.gameState.consecutiveGoals = 0\n\t\t}\n\n\t\t// Update goal indicator for this round\n\t\tconst roundIndex = this.gameState.round - 1\n\t\tif (roundIndex < this.goalIndicators.length) {\n\t\t\tlet indicatorColor = 0x666666 // default gray\n\t\t\tif (result === 'goal') {\n\t\t\t\tindicatorColor = 0x22c55e // green\n\t\t\t} else if (result === 'save') {\n\t\t\t\tindicatorColor = 0xfbbf24 // yellow\n\t\t\t} else {\n\t\t\t\tindicatorColor = 0xef4444 // red\n\t\t\t}\n\t\t\tthis.goalIndicators[roundIndex].setFillStyle(indicatorColor, 1)\n\t\t\tthis.shotResults[roundIndex] = result\n\t\t}\n\n\t\t// Show result text\n\t\tlet resultMessage = ''\n\t\tlet resultColor = '#ffffff'\n\n\t\tif (result === 'goal') {\n\t\t\tresultMessage = 'GOL!'\n\t\t\tresultColor = '#22c55e'\n\n\t\t\tlet bonusText = ''\n\t\t\tif (bonuses.corner) bonusText += '\\n+50 Esquina'\n\t\t\tif (bonuses.curve) bonusText += '\\n+25 Curva'\n\t\t\tif (bonuses.streak > 1)\n\t\t\t\tbonusText += `\\n+${(bonuses.streak - 1) * 10} Racha x${bonuses.streak}`\n\n\t\t\tif (bonusText) {\n\t\t\t\tresultMessage += bonusText\n\t\t\t}\n\t\t} else if (result === 'save') {\n\t\t\tresultMessage = 'Atajada!'\n\t\t\tresultColor = '#fbbf24'\n\t\t} else {\n\t\t\tresultMessage = 'Fallaste!'\n\t\t\tresultColor = '#ef4444'\n\t\t}\n\n\t\tthis.resultText.setText(resultMessage)\n\t\tthis.resultText.setColor(resultColor)\n\t\tthis.resultText.setVisible(true)\n\n\t\t// Animate result text based on result type\n\t\tthis.tweens.killTweensOf(this.resultText)\n\t\tthis.resultText.setScale(0)\n\t\tthis.resultText.setAlpha(1)\n\n\t\tif (result === 'goal') {\n\t\t\t// Goal: Bounce in with scale overshoot\n\t\t\tthis.tweens.add({\n\t\t\t\ttargets: this.resultText,\n\t\t\t\tscale: { from: 0, to: 1.3 },\n\t\t\t\tduration: 250,\n\t\t\t\tease: 'Back.easeOut',\n\t\t\t\tonComplete: () => {\n\t\t\t\t\tthis.tweens.add({\n\t\t\t\t\t\ttargets: this.resultText,\n\t\t\t\t\t\tscale: 1,\n\t\t\t\t\t\tduration: 150,\n\t\t\t\t\t\tease: 'Sine.easeInOut',\n\t\t\t\t\t\tonComplete: () => {\n\t\t\t\t\t\t\t// Pulse effect\n\t\t\t\t\t\t\tthis.tweens.add({\n\t\t\t\t\t\t\t\ttargets: this.resultText,\n\t\t\t\t\t\t\t\tscale: { from: 1, to: 1.1 },\n\t\t\t\t\t\t\t\tduration: 300,\n\t\t\t\t\t\t\t\tyoyo: true,\n\t\t\t\t\t\t\t\trepeat: 2,\n\t\t\t\t\t\t\t\tease: 'Sine.easeInOut',\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t})\n\t\t} else if (result === 'save') {\n\t\t\t// Save: Slide in from right with fade\n\t\t\tthis.resultText.setX(GAME_WIDTH + 100)\n\t\t\tthis.resultText.setScale(1)\n\t\t\tthis.tweens.add({\n\t\t\t\ttargets: this.resultText,\n\t\t\t\tx: GAME_WIDTH / 2,\n\t\t\t\tduration: 300,\n\t\t\t\tease: 'Back.easeOut',\n\t\t\t\tonComplete: () => {\n\t\t\t\t\t// Gentle pulse\n\t\t\t\t\tthis.tweens.add({\n\t\t\t\t\t\ttargets: this.resultText,\n\t\t\t\t\t\talpha: { from: 1, to: 0.7 },\n\t\t\t\t\t\tduration: 200,\n\t\t\t\t\t\tyoyo: true,\n\t\t\t\t\t\trepeat: 2,\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t})\n\t\t} else {\n\t\t\t// Miss: Shake effect\n\t\t\tthis.resultText.setScale(1)\n\t\t\tthis.tweens.add({\n\t\t\t\ttargets: this.resultText,\n\t\t\t\tscale: { from: 0.5, to: 1 },\n\t\t\t\tduration: 200,\n\t\t\t\tease: 'Elastic.easeOut',\n\t\t\t\tonComplete: () => {\n\t\t\t\t\t// Horizontal shake\n\t\t\t\t\tconst originalX = GAME_WIDTH / 2\n\t\t\t\t\tthis.tweens.add({\n\t\t\t\t\t\ttargets: this.resultText,\n\t\t\t\t\t\tx: { from: originalX - 10, to: originalX + 10 },\n\t\t\t\t\t\tduration: 50,\n\t\t\t\t\t\tyoyo: true,\n\t\t\t\t\t\trepeat: 4,\n\t\t\t\t\t\tonComplete: () => {\n\t\t\t\t\t\t\tthis.resultText.setX(originalX)\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\n\t\t// Notify React\n\t\tconst onScoreUpdate = this.registry.get('onScoreUpdate')\n\t\tif (onScoreUpdate) {\n\t\t\tonScoreUpdate(this.gameState.totalScore)\n\t\t}\n\n\t\tconst onRoundComplete = this.registry.get('onRoundComplete')\n\t\tif (onRoundComplete) {\n\t\t\tonRoundComplete(this.gameState.round, result)\n\t\t}\n\n\t\t// Continue to next round or end game\n\t\tthis.time.delayedCall(TIMING.resultDisplayDuration, () => {\n\t\t\tthis.tweens.killTweensOf(this.resultText)\n\t\t\tthis.resultText.setVisible(false)\n\t\t\tthis.resultText.setScale(1)\n\t\t\tthis.resultText.setX(GAME_WIDTH / 2)\n\t\t\tthis.resultText.setAlpha(1)\n\n\t\t\tif (this.gameState.round >= this.totalRounds) {\n\t\t\t\tthis.endGame()\n\t\t\t} else {\n\t\t\t\tthis.gameState.round++\n\t\t\t\tthis.resetForNextRound()\n\t\t\t}\n\t\t})\n\t}\n\n\tprivate resetForNextRound() {\n\t\t// Reset ball sprite to base scale\n\t\tconst ballBaseScale = (BALL.radius * 1.5) / this.ball.width\n\t\tthis.ball.setPosition(BALL.startX, BALL.startY)\n\t\tthis.ball.setScale(ballBaseScale)\n\t\tthis.ball.setAlpha(1)\n\t\tthis.ball.setAngle(0)\n\n\t\tthis.ballShadow.setPosition(BALL.startX, BALL.startY + 8)\n\t\tthis.ballShadow.setScale(1)\n\t\tthis.ballShadow.setAlpha(0.3)\n\n\t\t// Reset goalkeeper sprite\n\t\tthis.goalkeeper.setPosition(\n\t\t\tGOALKEEPER.startX,\n\t\t\tGOALKEEPER.startY + GOALKEEPER.height / 2 // Bottom-center origin\n\t\t)\n\t\tthis.goalkeeper.setFlipX(false)\n\t\tthis.goalkeeper.play('gk-idle')\n\n\t\t// Reset all graphics\n\t\tthis.trajectoryPoints = []\n\t\tthis.trajectoryGraphics.clear()\n\t\tthis.projectionGraphics.clear()\n\t\tthis.ballTrail.clear()\n\t\tthis.spinIndicator.setAlpha(0)\n\t\tthis.sparkSprite.setVisible(false)\n\t\tthis.sparkSprite.stop()\n\t\tthis.goalZoneGraphics.setAlpha(0)\n\n\t\t// Reset drag/spin state\n\t\tthis.isDragging = false\n\t\tthis.dragStartPos = null\n\t\tthis.spinPoints = []\n\t\tthis.accumulatedSpin = 0\n\n\t\t// Hide gesture indicator (will be shown again in startAimingPhase)\n\t\tthis.tweens.killTweensOf(this.gestureIndicator)\n\t\tthis.gestureIndicator.setVisible(false)\n\n\t\tthis.gameState.aimPosition = null\n\n\t\tthis.updateUI()\n\t\tthis.startRound()\n\t}\n\n\tprivate endGame() {\n\t\tthis.gameState.phase = 'gameover'\n\n\t\tconst goals = this.gameState.goals\n\t\tconst totalScore = this.gameState.totalScore\n\n\t\tlet message = ''\n\t\tlet color = '#ffffff'\n\n\t\tif (goals >= 3) {\n\t\t\tif (goals === 5) {\n\t\t\t\tmessage = 'VICTORIA PERFECTA!\\n'\n\t\t\t\tcolor = '#fbbf24'\n\t\t\t} else if (goals === 4) {\n\t\t\t\tmessage = 'GRAN VICTORIA!\\n'\n\t\t\t\tcolor = '#22c55e'\n\t\t\t} else {\n\t\t\t\tmessage = 'VICTORIA!\\n'\n\t\t\t\tcolor = '#22c55e'\n\t\t\t}\n\t\t} else {\n\t\t\tmessage = `DERROTA\\n${goals}/5 goles`\n\t\t\tcolor = '#ef4444'\n\t\t}\n\n\t\tmessage += `\\n\\nPuntos: ${totalScore}`\n\n\t\tthis.resultText.setText(message)\n\t\tthis.resultText.setColor(color)\n\t\tthis.resultText.setFontSize(28)\n\t\tthis.resultText.setVisible(true)\n\n\t\tthis.instructionText.setText('Toca para continuar')\n\t\tthis.instructionText.setY(GAME_HEIGHT - 80)\n\n\t\t// Notify React\n\t\tconst onGameOver = this.registry.get('onGameOver')\n\t\tif (onGameOver) {\n\t\t\tonGameOver(goals, totalScore)\n\t\t}\n\t}\n\n\tupdate(_time: number, _delta: number) {\n\t\t// No longer need power bar update\n\t\t// Could add visual effects here if needed\n\t}\n}\n","'use client'\n\nimport React, { useEffect, useRef, useCallback } from 'react'\nimport Phaser from 'phaser'\nimport { BootScene } from './scenes/BootScene'\nimport { MainScene } from './scenes/MainScene'\nimport { GAME_WIDTH, GAME_HEIGHT, COLORS } from './constants'\nimport { GamePhase, ShotResult } from './types'\n\ninterface PenaltyGameCoreProps {\n\tonScoreUpdate: (score: number) => void\n\tonRoundComplete: (round: number, result: ShotResult) => void\n\tonGameOver: (goals: number, totalScore: number) => void\n\tonPhaseChange?: (phase: GamePhase) => void\n\tbrandColor?: string\n\ttotalRounds?: number\n\tskin?: string\n}\n\nconst PenaltyShootoutCore: React.FC<PenaltyGameCoreProps> = ({\n\tonScoreUpdate,\n\tonRoundComplete,\n\tonGameOver,\n\tonPhaseChange,\n\tbrandColor,\n\ttotalRounds = 5,\n\tskin,\n}) => {\n\tconst gameContainerRef = useRef<HTMLDivElement>(null)\n\tconst gameRef = useRef<Phaser.Game | null>(null)\n\n\t// Memoize callbacks to prevent unnecessary re-renders\n\tconst handleScoreUpdate = useCallback(\n\t\t(score: number) => {\n\t\t\tonScoreUpdate(score)\n\t\t},\n\t\t[onScoreUpdate]\n\t)\n\n\tconst handleRoundComplete = useCallback(\n\t\t(round: number, result: ShotResult) => {\n\t\t\tonRoundComplete(round, result)\n\t\t},\n\t\t[onRoundComplete]\n\t)\n\n\tconst handleGameOver = useCallback(\n\t\t(goals: number, totalScore: number) => {\n\t\t\tonGameOver(goals, totalScore)\n\t\t},\n\t\t[onGameOver]\n\t)\n\n\tconst handlePhaseChange = useCallback(\n\t\t(phase: GamePhase) => {\n\t\t\tif (onPhaseChange) {\n\t\t\t\tonPhaseChange(phase)\n\t\t\t}\n\t\t},\n\t\t[onPhaseChange]\n\t)\n\n\t// Initialize Phaser game\n\tuseEffect(() => {\n\t\tif (!gameContainerRef.current || gameRef.current) return\n\n\t\tconst config: Phaser.Types.Core.GameConfig = {\n\t\t\ttype: Phaser.AUTO,\n\t\t\tparent: gameContainerRef.current,\n\t\t\twidth: GAME_WIDTH,\n\t\t\theight: GAME_HEIGHT,\n\t\t\tbackgroundColor: brandColor\n\t\t\t\t? parseInt(brandColor.replace('#', '0x'))\n\t\t\t\t: COLORS.field,\n\t\t\tphysics: {\n\t\t\t\tdefault: 'arcade',\n\t\t\t\tarcade: {\n\t\t\t\t\tgravity: { x: 0, y: 0 },\n\t\t\t\t\tdebug: false,\n\t\t\t\t},\n\t\t\t},\n\t\t\tscene: [BootScene, MainScene],\n\t\t\tscale: {\n\t\t\t\tmode: Phaser.Scale.FIT,\n\t\t\t\tautoCenter: Phaser.Scale.CENTER_BOTH,\n\t\t\t},\n\t\t\trender: {\n\t\t\t\tpixelArt: false,\n\t\t\t\tantialias: true,\n\t\t\t},\n\t\t\tinput: {\n\t\t\t\tactivePointers: 1,\n\t\t\t},\n\t\t}\n\n\t\tgameRef.current = new Phaser.Game(config)\n\n\t\t// Pass callbacks to Phaser via registry\n\t\tgameRef.current.registry.set('onScoreUpdate', handleScoreUpdate)\n\t\tgameRef.current.registry.set('onRoundComplete', handleRoundComplete)\n\t\tgameRef.current.registry.set('onGameOver', handleGameOver)\n\t\tgameRef.current.registry.set('onPhaseChange', handlePhaseChange)\n\t\tgameRef.current.registry.set('brandColor', brandColor)\n\t\tgameRef.current.registry.set('totalRounds', totalRounds)\n\t\tgameRef.current.registry.set('skin', skin)\n\n\t\t// Cleanup on unmount\n\t\treturn () => {\n\t\t\tif (gameRef.current) {\n\t\t\t\tgameRef.current.destroy(true)\n\t\t\t\tgameRef.current = null\n\t\t\t}\n\t\t}\n\t}, [\n\t\thandleScoreUpdate,\n\t\thandleRoundComplete,\n\t\thandleGameOver,\n\t\thandlePhaseChange,\n\t\tbrandColor,\n\t\ttotalRounds,\n\t\tskin,\n\t])\n\n\treturn (\n\t\t<div\n\t\t\tref={gameContainerRef}\n\t\t\tclassName=\"w-full h-full flex items-center justify-center\"\n\t\t\tstyle={{\n\t\t\t\ttouchAction: 'none',\n\t\t\t\tuserSelect: 'none',\n\t\t\t}}\n\t\t/>\n\t)\n}\n\nexport default PenaltyShootoutCore\n"],"names":["GAME_WIDTH","GAME_HEIGHT","GOAL","width","height","x","y","topY","bottomY","postWidth","crossbarHeight","BALL","radius","startX","startY","maxVelocity","GOALKEEPER","diveDistance","SCORING","POWER_BAR_UI","DIFFICULTY","correctDiveChance","reactionSpeed","saveCoverage","TIMING","COLORS","BootScene","Phaser","constructor","super","key","preload","progressBar","this","add","graphics","progressBox","fillStyle","fillRect","loadingText","text","font","color","setOrigin","load","on","value","clear","destroy","skin","registry","get","basePath","skinPath","concat","spritesheet","frameWidth","frameHeight","image","create","fontLoadPromise","document","fonts","timeoutPromise","Promise","resolve","setTimeout","race","ready","e","console","warn","scene","start","penaltyShootoutAudio","initialized","muted","kickSynth","goalSynth","saveSynth","whistleSynth","missSynth","init","Tone","pitchDecay","octaves","oscillator","type","envelope","attack","decay","sustain","release","volume","toDestination","noise","playKick","now","triggerAttackRelease","playGoal","notes","time","forEach","_ref","playSave","playMiss","note","i","setMuted","isMuted","dispose","_this$kickSynth","_this$goalSynth","_this$saveSynth","_this$whistleSynth","_this$missSynth","MainScene","gameState","ball","ballShadow","goalkeeper","goalGraphics","fieldGraphics","trajectoryGraphics","goalZoneGraphics","projectionGraphics","roundText","instructionText","resultText","gestureIndicator","goalIndicators","shotResults","isDragging","dragStartPos","spinPoints","accumulatedSpin","ballGrabOffset","spinIndicator","ballTrail","sparkSprite","powerBarGraphics","powerBarFill","smoothedPower","trajectoryPoints","isSwiping","swipeStartTime","currentDifficulty","totalRounds","initializeGameState","createGoalkeeperAnimations","drawField","drawGoal","createGoalZoneGuides","createBall","createGoalkeeper","createTrajectoryGraphics","createSpinIndicator","createPowerBar","createUI","setupInput","showStartScreen","anims","frames","frame","frameRate","generateFrameNumbers","end","repeat","phase","round","goals","totalScore","lastResult","consecutiveGoals","aimPosition","power","length","indicator","setFillStyle","setDepth","vanishingPointX","goalLeft","goalRight","goalTop","goalBottom","t","Math","floor","tileSprite","horizonY","fieldBottom","fieldLines","lineStyle","goalLineY","lineBetween","goalAreaTopY","goalAreaBottomY","fillCircle","beginPath","arcCenterY","angle","sin","cos","moveTo","lineTo","strokePath","middleLineY","addAdBanners","adBottom","sprite","setDisplaySize","goalBottomY","goalTopY","goalWidth","backTopY","backWidth","goalCenterX","closePath","fillPath","frontY","backY","frontX","backX","fillEllipse","ellipse","scale","setScale","play","setAlpha","setVisible","drawGoalZoneGuides","goalHeight","zoneWidth","zoneHeight","drawStar","cx","cy","outerRadius","points","innerRadius","PI","showGoalZoneGuides","tweens","targets","alpha","duration","ease","hideGoalZoneGuides","updateProjectionIndicator","targetX","targetY","clampedX","Clamp","clampedY","dashLength","gapLength","dx","dy","distance","sqrt","steps","t1","t2","strokeCircle","highlightTargetZone","col","row","zoneX","zoneY","updateSpinIndicator","spin","abs","stop","min","setPosition","visible","ballX","ballY","arrowSize","arc","tipAngle","tipX","tipY","tangent","fillTriangle","stroke","strokeThickness","setResolution","indicatorStartX","circle","setStrokeStyle","push","align","updateUI","setText","input","handlePointerDown","handlePointerMove","handlePointerUp","pointer","startRound","Distance","Between","killTweensOf","grabScale","maxDragDistance","dist","newX","newY","ratio","smoothFactor","smoothX","smoothY","spinWindow","filter","p","calculateSpinFromPoints","drawBallTrail","currentSpeed","calculateInstantaneousSpeed","max","updatePowerBar","dragVector","projectedY","projectionScale","projectedX","elapsed","shift","_pointer","releaseVelocity","calculateReleaseVelocity","hidePowerBar","executeDragShot","ballBaseScale","totalAngularChange","validSamples","centerX","centerY","prev","curr","prevAngle","atan2","angleDiff","pow","avgAngularVelocity","speed","recentPoints","slice","first","last","dt","vx","vy","strokeRect","targetPower","Linear","normalizedPower","fillHeight","fillColor","showPowerBar","velocity","vMag","vNormX","vNormY","curveDirection","animateFallShort","goalkeeperDive","decideGoalkeeperDive","missChance","random","animateMiss","animateCurvedShot","from","to","yoyo","startAimingPhase","setFontSize","addCounter","onUpdate","tween","_tween$getValue","DegToRad","getValue","baseScale","onComplete","calculateCurveDirection","lineAngle","totalDeviation","midPoints","point","expectedX","expectedY","perpAngle","avgDeviation","goalCenter","threshold","finalDirection","curveFoolChance","wrongDirections","d","target","travelDuration","currentScale","midY","curveOffset","controlX","controlY","curve","QuadraticBezier","Vector2","pathFollower","getPoint","rotationAmount","delayedCall","animateGoalkeeperDive","checkShotResult","direction","setFlipX","missTarget","randomDive","showResult","shortTarget","shotDirection","_topY","goalkeeperX","baseCoverage","powerFactor","curveAmount","goalMidY","result","bonuses","corner","streak","_topY2","aimPos","cornerMidY","roundIndex","indicatorColor","resultMessage","resultColor","bonusText","setColor","setX","originalX","onScoreUpdate","onRoundComplete","endGame","resetForNextRound","setAngle","message","setY","onGameOver","update","_time","_delta","onPhaseChange","brandColor","gameContainerRef","useRef","gameRef","handleScoreUpdate","useCallback","score","handleRoundComplete","handleGameOver","handlePhaseChange","useEffect","current","config","parent","backgroundColor","parseInt","replace","physics","default","arcade","gravity","debug","mode","FIT","autoCenter","CENTER_BOTH","render","pixelArt","antialias","activePointers","set","_jsx","ref","className","style","touchAction","userSelect"],"sourceRoot":""}