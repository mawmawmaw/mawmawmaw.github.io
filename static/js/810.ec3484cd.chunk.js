/*! For license information please see 810.ec3484cd.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkmawmawmaw=self.webpackChunkmawmawmaw||[]).push([[810],{64:(t,e,n)=>{n.d(e,{Wp:()=>r.Wp});var r=n(232);(0,r.KO)("firebase","12.1.0","app")},232:(t,e,n)=>{n.d(e,{MF:()=>lt,j6:()=>ot,xZ:()=>at,om:()=>st,Sx:()=>ft,Wp:()=>dt,KO:()=>gt});var r=n(379),i=n(606),s=n(965),o=n(776);let a,c;const h=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,f=new WeakMap;let g={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return u.get(t);if("objectStoreNames"===e)return t.objectStoreNames||l.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return y(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function p(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.apply(v(this),n),y(h.get(this))}:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return y(t.apply(v(this),n))}:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];const s=t.call(v(this),e,...r);return l.set(s,e.sort?e.sort():[e]),y(s)}}function m(t){return"function"===typeof t?p(t):(t instanceof IDBTransaction&&function(t){if(u.has(t))return;const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)});u.set(t,e)}(t),e=t,(a||(a=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(t,g):t);var e}function y(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(y(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)});return e.then(e=>{e instanceof IDBCursor&&h.set(e,t)}).catch(()=>{}),f.set(e,t),e}(t);if(d.has(t))return d.get(t);const e=m(t);return e!==t&&(d.set(t,e),f.set(e,t)),e}const v=t=>f.get(t);const w=["get","getKey","getAll","getAllKeys","count"],E=["put","add","delete","clear"],b=new Map;function _(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!==typeof e)return;if(b.get(e))return b.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=E.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!w.includes(n))return;const s=async function(t){const e=this.transaction(t,i?"readwrite":"readonly");let s=e.store;for(var o=arguments.length,a=new Array(o>1?o-1:0),c=1;c<o;c++)a[c-1]=arguments[c];return r&&(s=s.index(a.shift())),(await Promise.all([s[n](...a),i&&e.done]))[0]};return b.set(e,s),s}g=(t=>(0,r.A)((0,r.A)({},t),{},{get:(e,n,r)=>_(e,n)||t.get(e,n,r),has:(e,n)=>!!_(e,n)||t.has(e,n)}))(g);class T{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null===e||void 0===e?void 0:e.type)}(t)){const e=t.getImmediate();return"".concat(e.library,"/").concat(e.version)}return null}).filter(t=>t).join(" ")}}const S="@firebase/app",C="0.14.1",I=new s.Vy("@firebase/app"),A="@firebase/app-compat",D="@firebase/analytics-compat",N="@firebase/analytics",k="@firebase/app-check-compat",R="@firebase/app-check",O="@firebase/auth",x="@firebase/auth-compat",L="@firebase/database",M="@firebase/data-connect",P="@firebase/database-compat",V="@firebase/functions",F="@firebase/functions-compat",U="@firebase/installations",j="@firebase/installations-compat",B="@firebase/messaging",q="@firebase/messaging-compat",z="@firebase/performance",G="@firebase/performance-compat",K="@firebase/remote-config",H="@firebase/remote-config-compat",Q="@firebase/storage",W="@firebase/storage-compat",X="@firebase/firestore",Y="@firebase/ai",J="@firebase/firestore-compat",Z="firebase",$="[DEFAULT]",tt={[S]:"fire-core",[A]:"fire-core-compat",[N]:"fire-analytics",[D]:"fire-analytics-compat",[R]:"fire-app-check",[k]:"fire-app-check-compat",[O]:"fire-auth",[x]:"fire-auth-compat",[L]:"fire-rtdb",[M]:"fire-data-connect",[P]:"fire-rtdb-compat",[V]:"fire-fn",[F]:"fire-fn-compat",[U]:"fire-iid",[j]:"fire-iid-compat",[B]:"fire-fcm",[q]:"fire-fcm-compat",[z]:"fire-perf",[G]:"fire-perf-compat",[K]:"fire-rc",[H]:"fire-rc-compat",[Q]:"fire-gcs",[W]:"fire-gcs-compat",[X]:"fire-fst",[J]:"fire-fst-compat",[Y]:"fire-vertex","fire-js":"fire-js",[Z]:"fire-js-all"},et=new Map,nt=new Map,rt=new Map;function it(t,e){try{t.container.addComponent(e)}catch(n){I.debug("Component ".concat(e.name," failed to register with FirebaseApp ").concat(t.name),n)}}function st(t){const e=t.name;if(rt.has(e))return I.debug("There were multiple attempts to register component ".concat(e,".")),!1;rt.set(e,t);for(const n of et.values())it(n,t);for(const n of nt.values())it(n,t);return!0}function ot(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function at(t){return null!==t&&void 0!==t&&void 0!==t.settings}const ct={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ht=new o.FA("app","Firebase",ct);class ut{constructor(t,e,n){this._isDeleted=!1,this._options=(0,r.A)({},t),this._config=(0,r.A)({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new i.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ht.create("app-deleted",{appName:this._name})}}const lt="12.1.0";function dt(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t;if("object"!==typeof e){e={name:e}}const s=(0,r.A)({name:$,automaticDataCollectionEnabled:!0},e),a=s.name;if("string"!==typeof a||!a)throw ht.create("bad-app-name",{appName:String(a)});if(n||(n=(0,o.T9)()),!n)throw ht.create("no-options");const c=et.get(a);if(c){if((0,o.bD)(n,c.options)&&(0,o.bD)(s,c.config))return c;throw ht.create("duplicate-app",{appName:a})}const h=new i.h1(a);for(const r of rt.values())h.addComponent(r);const u=new ut(n,s,h);return et.set(a,u),u}function ft(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$;const e=et.get(t);if(!e&&t===$&&(0,o.T9)())return dt();if(!e)throw ht.create("no-app",{appName:t});return e}function gt(t,e,n){var r;let s=null!==(r=tt[t])&&void 0!==r?r:t;n&&(s+="-".concat(n));const o=s.match(/\s|\//),a=e.match(/\s|\//);if(o||a){const t=['Unable to register library "'.concat(s,'" with version "').concat(e,'":')];return o&&t.push('library name "'.concat(s,'" contains illegal characters (whitespace or "/")')),o&&a&&t.push("and"),a&&t.push('version name "'.concat(e,'" contains illegal characters (whitespace or "/")')),void I.warn(t.join(" "))}st(new i.uA("".concat(s,"-version"),()=>({library:s,version:e}),"VERSION"))}const pt="firebase-heartbeat-store";let mt=null;function yt(){return mt||(mt=function(t,e){let{blocked:n,upgrade:r,blocking:i,terminated:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=indexedDB.open(t,e),a=y(o);return r&&o.addEventListener("upgradeneeded",t=>{r(y(o.result),t.oldVersion,t.newVersion,y(o.transaction),t)}),n&&o.addEventListener("blocked",t=>n(t.oldVersion,t.newVersion,t)),a.then(t=>{s&&t.addEventListener("close",()=>s()),i&&t.addEventListener("versionchange",t=>i(t.oldVersion,t.newVersion,t))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(pt)}catch(n){console.warn(n)}}}).catch(t=>{throw ht.create("idb-open",{originalErrorMessage:t.message})})),mt}async function vt(t,e){try{const n=(await yt()).transaction(pt,"readwrite"),r=n.objectStore(pt);await r.put(e,wt(t)),await n.done}catch(n){if(n instanceof o.g)I.warn(n.message);else{const t=ht.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});I.warn(t.message)}}}function wt(t){return"".concat(t.name,"!").concat(t.options.appId)}class Et{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new _t(e),this._heartbeatsCachePromise=this._storage.read().then(t=>(this._heartbeatsCache=t,t))}async triggerHeartbeat(){try{var t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=bt();var e;if(null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats))if(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(t=>t.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const t=function(t){if(0===t.length)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){I.warn(n)}}async getHeartbeatsHeader(){try{var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=bt(),{heartbeatsToSend:n,unsentEntries:r}=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=t.slice();for(const i of t){const t=n.find(t=>t.agent===i.agent);if(t){if(t.dates.push(i.date),Tt(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Tt(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=(0,o.Uj)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return I.warn(e),""}}}function bt(){return(new Date).toISOString().substring(0,10)}class _t{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,o.zW)()&&(0,o.eX)().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await yt()).transaction(pt),n=await e.objectStore(pt).get(wt(t));return await e.done,n}catch(e){if(e instanceof o.g)I.warn(e.message);else{const t=ht.create("idb-get",{originalErrorMessage:null===e||void 0===e?void 0:e.message});I.warn(t.message)}}}(this.app);return null!==t&&void 0!==t&&t.heartbeats?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){var e;const n=await this.read();return vt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){if(await this._canUseIndexedDBPromise){var e;const n=await this.read();return vt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function Tt(t){return(0,o.Uj)(JSON.stringify({version:2,heartbeats:t})).length}var St;St="",st(new i.uA("platform-logger",t=>new T(t),"PRIVATE")),st(new i.uA("heartbeat",t=>new Et(t),"PRIVATE")),gt(S,C,St),gt(S,C,"esm2020"),gt("fire-js","")},379:(t,e,n)=>{n.d(e,{A:()=>s});var r=n(705);function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach(function(e){(0,r.A)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}},606:(t,e,n)=>{n.d(e,{h1:()=>a,uA:()=>i});var r=n(776);class i{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const s="[DEFAULT]";class o{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new r.cY;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(n){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null===t||void 0===t?void 0:t.identifier),r=null!==(e=null===t||void 0===t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error("Mismatching Component ".concat(t.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:r});n.resolve(t)}catch(e){}}}}clearInstance(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...t.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;return this.instances.has(t)}getOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;return this.instancesOptions.get(t)||{}}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[i,s]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&s.resolve(r)}return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&t(s,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(r){}}getOrInitializeService(t){let{instanceIdentifier:e,options:n={}}=t,r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===s?void 0:i),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(o){}var i;return r||null}normalizeInstanceIdentifier(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;return this.component?this.component.multipleInstances?t:s:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component ".concat(t.name," has already been registered with ").concat(this.name));e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new o(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}},667:(t,e,n)=>{n.d(e,{rJ:()=>ya,GG:()=>za,aU:()=>_a});var r,i,s=n(379),o=n(232),a=n(606),c=n(965),h=n(776),u="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},l={};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(t,e,n){n||(n=0);var r=Array(16);if("string"===typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}function s(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=0|t[i];r&&s==e||(n[i]=s,r=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.D=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.C=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}(e,function(){this.blockSize=-1}),e.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.u=function(t,e){void 0===e&&(e=t.length);for(var r=e-this.blockSize,i=this.B,s=this.h,o=0;o<e;){if(0==s)for(;o<=r;)n(this,t,o),o+=this.blockSize;if("string"===typeof t){for(;o<e;)if(i[s++]=t.charCodeAt(o++),s==this.blockSize){n(this,i),s=0;break}}else for(;o<e;)if(i[s++]=t[o++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=e},e.prototype.v=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.o;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.u(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var o={};function a(t){return-128<=t&&128>t?function(t,e){var n=o;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(t){return new s([0|t],0>t?-1:0)}):new s([0|t],0>t?-1:0)}function c(t){if(isNaN(t)||!isFinite(t))return h;if(0>t)return p(c(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=4294967296;return new s(e,0)}var h=a(0),u=a(1),d=a(16777216);function f(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function g(t){return-1==t.h}function p(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new s(n,~t.h).add(u)}function m(t,e){return t.add(p(e))}function y(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function v(t,e){this.g=t,this.h=e}function w(t,e){if(f(e))throw Error("division by zero");if(f(t))return new v(h,h);if(g(t))return e=w(p(t),e),new v(p(e.g),p(e.h));if(g(e))return e=w(t,p(e)),new v(p(e.g),e.h);if(30<t.g.length){if(g(t)||g(e))throw Error("slowDivide_ only works with positive integers.");for(var n=u,r=e;0>=r.l(t);)n=E(n),r=E(r);var i=b(n,1),s=b(r,1);for(r=b(r,2),n=b(n,2);!f(r);){var o=s.add(r);0>=o.l(t)&&(i=i.add(n),s=o),r=b(r,1),n=b(n,1)}return e=m(t,i.j(e)),new v(i,e)}for(i=h;0<=t.l(e);){for(n=Math.max(1,Math.floor(t.m()/e.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=c(n)).j(e);g(o)||0<o.l(t);)o=(s=c(n-=r)).j(e);f(s)&&(s=u),i=i.add(s),t=m(t,o)}return new v(i,t)}function E(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.i(r)<<1|t.i(r-1)>>>31;return new s(n,t.h)}function b(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,i=[],o=0;o<r;o++)i[o]=0<e?t.i(o+n)>>>e|t.i(o+n+1)<<32-e:t.i(o+n);return new s(i,t.h)}(t=s.prototype).m=function(){if(g(this))return-p(this).m();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.i(n);t+=(0<=r?r:4294967296+r)*e,e*=4294967296}return t},t.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(f(this))return"0";if(g(this))return"-"+p(this).toString(t);for(var e=c(Math.pow(t,6)),n=this,r="";;){var i=w(n,e).g,s=((0<(n=m(n,i.j(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(f(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},t.i=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return g(t=m(this,t))?-1:f(t)?0:1},t.abs=function(){return g(this)?p(this):this},t.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,i=0;i<=e;i++){var o=r+(65535&this.i(i))+(65535&t.i(i)),a=(o>>>16)+(this.i(i)>>>16)+(t.i(i)>>>16);r=a>>>16,o&=65535,a&=65535,n[i]=a<<16|o}return new s(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(f(this)||f(t))return h;if(g(this))return g(t)?p(this).j(p(t)):p(p(this).j(t));if(g(t))return p(this.j(p(t)));if(0>this.l(d)&&0>t.l(d))return c(this.m()*t.m());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<t.g.length;i++){var o=this.i(r)>>>16,a=65535&this.i(r),u=t.i(i)>>>16,l=65535&t.i(i);n[2*r+2*i]+=a*l,y(n,2*r+2*i),n[2*r+2*i+1]+=o*l,y(n,2*r+2*i+1),n[2*r+2*i+1]+=a*u,y(n,2*r+2*i+1),n[2*r+2*i+2]+=o*u,y(n,2*r+2*i+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new s(n,0)},t.A=function(t){return w(this,t).h},t.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.i(r)&t.i(r);return new s(n,this.h&t.h)},t.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.i(r)|t.i(r);return new s(n,this.h|t.h)},t.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.i(r)^t.i(r);return new s(n,this.h^t.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,i=l.Md5=e,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=c,s.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return p(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=c(Math.pow(n,8)),i=h,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),a=parseInt(e.substring(s,s+o),n);8>o?(o=c(Math.pow(n,o)),i=i.j(o).add(c(a))):i=(i=i.j(r)).add(c(a))}return i},r=l.Integer=s}).apply("undefined"!==typeof u?u:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var d,f,g,p,m,y,v,w,E="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},b={};(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t};var n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof E&&E];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(t,r){if(r)t:{var i=n;t=t.split(".");for(var s=0;s<t.length-1;s++){var o=t[s];if(!(o in i))break t;i=i[o]}(r=r(s=i[t=t[t.length-1]]))!=s&&null!=r&&e(i,t,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,r=!1,i={next:function(){if(!r&&n<t.length){var i=n++;return{value:e(i,t[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,function(t,e){return e})}});var r=r||{},i=this||self;function s(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function o(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function c(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function h(t,e,n){return(h=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function u(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function l(t,e){function n(){}n.prototype=e.prototype,t.aa=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Qb=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}function _(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function T(t,e){for(let n=1;n<arguments.length;n++){const e=arguments[n];if(s(e)){const n=t.length||0,r=e.length||0;t.length=n+r;for(let i=0;i<r;i++)t[n+i]=e[i]}else t.push(e)}}function S(t){return/^[\s\xa0]*$/.test(t)}function C(){var t=i.navigator;return t&&(t=t.userAgent)?t:""}function I(t){return I[" "](t),t}I[" "]=function(){};var A=-1!=C().indexOf("Gecko")&&!(-1!=C().toLowerCase().indexOf("webkit")&&-1==C().indexOf("Edge"))&&!(-1!=C().indexOf("Trident")||-1!=C().indexOf("MSIE"))&&-1==C().indexOf("Edge");function D(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function N(t){const e={};for(const n in t)e[n]=t[n];return e}const k="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function R(t,e){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)t[n]=r[n];for(let e=0;e<k.length;e++)n=k[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function O(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function x(t){i.setTimeout(()=>{throw t},0)}function L(){var t=U;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var M=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new P,t=>t.reset());class P{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let V,F=!1,U=new class{constructor(){this.h=this.g=null}add(t,e){const n=M.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},j=()=>{const t=i.Promise.resolve(void 0);V=()=>{t.then(B)}};var B=()=>{for(var t;t=L();){try{t.h.call(t.g)}catch(n){x(n)}var e=M;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}F=!1};function q(){this.s=this.s,this.C=this.C}function z(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}q.prototype.s=!1,q.prototype.ma=function(){this.s||(this.s=!0,this.N())},q.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},z.prototype.h=function(){this.defaultPrevented=!0};var G=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};i.addEventListener("test",t,e),i.removeEventListener("test",t,e)}catch(n){}return t}();function K(t,e){if(z.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(A){t:{try{I(e.nodeName);var i=!0;break t}catch(s){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"===typeof t.pointerType?t.pointerType:H[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&K.aa.h.call(this)}}l(K,z);var H={2:"touch",3:"pen",4:"mouse"};K.prototype.h=function(){K.aa.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Q="closure_listenable_"+(1e6*Math.random()|0),W=0;function X(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=i,this.key=++W,this.da=this.fa=!1}function Y(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function J(t){this.src=t,this.g={},this.h=0}function Z(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],s=Array.prototype.indexOf.call(i,e,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(Y(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function $(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.da&&s.listener==e&&s.capture==!!n&&s.ha==r)return i}return-1}J.prototype.add=function(t,e,n,r,i){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=$(t,e,r,i);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new X(e,this.src,s,!!r,i)).fa=n,t.push(e)),e};var tt="closure_lm_"+(1e6*Math.random()|0),et={};function nt(t,e,n,r,i){if(r&&r.once)return it(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)nt(t,e[s],n,r,i);return null}return n=lt(n),t&&t[Q]?t.K(e,n,o(r)?!!r.capture:!!r,i):rt(t,e,n,!1,r,i)}function rt(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var a=o(i)?!!i.capture:!!i,c=ht(t);if(c||(t[tt]=c=new J(t)),(n=c.add(e,n,r,a,s)).proxy)return n;if(r=function(){function t(n){return e.call(t.src,t.listener,n)}const e=ct;return t}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)G||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(at(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function it(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)it(t,e[s],n,r,i);return null}return n=lt(n),t&&t[Q]?t.L(e,n,o(r)?!!r.capture:!!r,i):rt(t,e,n,!0,r,i)}function st(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)st(t,e[s],n,r,i);else r=o(r)?!!r.capture:!!r,n=lt(n),t&&t[Q]?(t=t.i,(e=String(e).toString())in t.g&&(-1<(n=$(s=t.g[e],n,r,i))&&(Y(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--)))):t&&(t=ht(t))&&(e=t.g[e.toString()],t=-1,e&&(t=$(e,n,r,i)),(n=-1<t?e[t]:null)&&ot(n))}function ot(t){if("number"!==typeof t&&t&&!t.da){var e=t.src;if(e&&e[Q])Z(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(at(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ht(e))?(Z(n,t),0==n.h&&(n.src=null,e[tt]=null)):Y(t)}}}function at(t){return t in et?et[t]:et[t]="on"+t}function ct(t,e){if(t.da)t=!0;else{e=new K(e,this);var n=t.listener,r=t.ha||t.src;t.fa&&ot(t),t=n.call(r,e)}return t}function ht(t){return(t=t[tt])instanceof J?t:null}var ut="__closure_events_fn_"+(1e9*Math.random()>>>0);function lt(t){return"function"===typeof t?t:(t[ut]||(t[ut]=function(e){return t.handleEvent(e)}),t[ut])}function dt(){q.call(this),this.i=new J(this),this.M=this,this.F=null}function ft(t,e){var n,r=t.F;if(r)for(n=[];r;r=r.F)n.push(r);if(t=t.M,r=e.type||e,"string"===typeof e)e=new z(e,t);else if(e instanceof z)e.target=e.target||t;else{var i=e;R(e=new z(r,t),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=gt(o,r,!0,e)&&i}if(i=gt(o=e.g=t,r,!0,e)&&i,i=gt(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)i=gt(o=e.g=n[s],r,!1,e)&&i}function gt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&Z(t.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}function pt(t,e,n){if("function"===typeof t)n&&(t=h(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=h(t.handleEvent,t)}return 2147483647<Number(e)?-1:i.setTimeout(t,e||0)}function mt(t){t.g=pt(()=>{t.g=null,t.i&&(t.i=!1,mt(t))},t.l);const e=t.h;t.h=null,t.m.apply(null,e)}l(dt,q),dt.prototype[Q]=!0,dt.prototype.removeEventListener=function(t,e,n,r){st(this,t,e,n,r)},dt.prototype.N=function(){if(dt.aa.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Y(n[r]);delete e.g[t],e.h--}}this.F=null},dt.prototype.K=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},dt.prototype.L=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};class yt extends q{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:mt(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function vt(t){q.call(this),this.h=t,this.g={}}l(vt,q);var wt=[];function Et(t){D(t.g,function(t,e){this.g.hasOwnProperty(e)&&ot(t)},t),t.g={}}vt.prototype.N=function(){vt.aa.N.call(this),Et(this)},vt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var bt=i.JSON.stringify,_t=i.JSON.parse,Tt=class{stringify(t){return i.JSON.stringify(t,void 0)}parse(t){return i.JSON.parse(t,void 0)}};function St(){}function Ct(t){return t.h||(t.h=t.i())}function It(){}St.prototype.h=null;var At={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Dt(){z.call(this,"d")}function Nt(){z.call(this,"c")}l(Dt,z),l(Nt,z);var kt={},Rt=null;function Ot(){return Rt=Rt||new dt}function xt(t){z.call(this,kt.La,t)}function Lt(t){const e=Ot();ft(e,new xt(e))}function Mt(t,e){z.call(this,kt.STAT_EVENT,t),this.stat=e}function Pt(t){const e=Ot();ft(e,new Mt(e,t))}function Vt(t,e){z.call(this,kt.Ma,t),this.size=e}function Ft(t,e){if("function"!==typeof t)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){t()},e)}function Ut(){this.g=!0}function jt(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return bt(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}kt.La="serverreachability",l(xt,z),kt.STAT_EVENT="statevent",l(Mt,z),kt.Ma="timingevent",l(Vt,z),Ut.prototype.xa=function(){this.g=!1},Ut.prototype.info=function(){};var Bt,qt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},zt={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Gt(){}function Kt(t,e,n,r){this.j=t,this.i=e,this.l=n,this.R=r||1,this.U=new vt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ht}function Ht(){this.i=null,this.g="",this.h=!1}l(Gt,St),Gt.prototype.g=function(){return new XMLHttpRequest},Gt.prototype.i=function(){return{}},Bt=new Gt;var Qt={},Wt={};function Xt(t,e,n){t.L=1,t.v=be(me(e)),t.m=n,t.P=!0,Yt(t,null)}function Yt(t,e){t.F=Date.now(),$t(t),t.A=me(t.v);var n=t.A,r=t.R;Array.isArray(r)||(r=[String(r)]),Me(n.i,"t",r),t.C=0,n=t.j.J,t.h=new Ht,t.g=Tn(t.j,n?e:null,!t.m),0<t.O&&(t.M=new yt(h(t.Y,t,t.g),t.O)),e=t.U,n=t.g,r=t.ca;var i="readystatechange";Array.isArray(i)||(i&&(wt[0]=i.toString()),i=wt);for(var s=0;s<i.length;s++){var o=nt(n,i[s],r||e.handleEvent,!1,e.h||e);if(!o)break;e.g[o.key]=o}e=t.H?N(t.H):{},t.m?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.m,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Lt(),function(t,e,n,r,i,s){t.info(function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var h=a[c].split("=");if(1<h.length){var u=h[0];h=h[1];var l=u.split("_");o=2<=l.length&&"type"==l[1]?o+(u+"=")+h+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o})}(t.i,t.u,t.A,t.l,t.R,t.m)}function Jt(t){return!!t.g&&("GET"==t.u&&2!=t.L&&t.j.Ca)}function Zt(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Wt:(n=Number(e.substring(n,r)),isNaN(n)?Qt:(r+=1)+n>e.length?Wt:(e=e.slice(r,r+n),t.C=r+n,e))}function $t(t){t.S=Date.now()+t.I,te(t,t.I)}function te(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Ft(h(t.ba,t),e)}function ee(t){t.B&&(i.clearTimeout(t.B),t.B=null)}function ne(t){0==t.j.G||t.J||vn(t.j,t)}function re(t){ee(t);var e=t.M;e&&"function"==typeof e.ma&&e.ma(),t.M=null,Et(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.ma())}function ie(t,e){try{var n=t.j;if(0!=n.G&&(n.g==t||he(n.h,t)))if(!t.K&&he(n.h,t)&&3==n.G){try{var r=n.Da.g.parse(e)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;yn(n),an(n)}gn(n),Pt(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Ft(h(n.Za,n),6e3));if(1>=ce(n.h)&&n.ca){try{n.ca()}catch(u){}n.ca=void 0}}else En(n,11)}else if((t.K||n.g==t)&&yn(n),!S(e))for(i=n.Da.g.parse(e),e=0;e<i.length;e++){let h=i[e];if(n.T=h[0],h=h[1],2==n.G)if("c"==h[0]){n.K=h[1],n.ia=h[2];const e=h[3];null!=e&&(n.la=e,n.j.info("VER="+n.la));const i=h[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const u=h[5];null!=u&&"number"===typeof u&&0<u&&(r=1.5*u,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.h;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(ue(s,s.h),s.h=null))}if(r.D){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.ya=t,Ee(r.I,r.D,t))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-t.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=t;if((r=n).qa=_n(r,r.J?r.ia:null,r.W),o.K){le(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&(ee(a),$t(a)),r.g=o}else fn(r);0<n.i.length&&hn(n)}else"stop"!=h[0]&&"close"!=h[0]||En(n,7);else 3==n.G&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?En(n,7):on(n):"noop"!=h[0]&&n.l&&n.l.ta(h),n.v=0)}Lt()}catch(u){}}Kt.prototype.ca=function(t){t=t.target;const e=this.M;e&&3==en(t)?e.j():this.Y(t)},Kt.prototype.Y=function(t){try{if(t==this.g)t:{const d=en(this.g);var e=this.g.Ba();this.g.Z();if(!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||nn(this.g)))){this.J||4!=d||7==e||Lt(),ee(this);var n=this.g.Z();this.X=n;e:if(Jt(this)){var r=nn(this.g);t="";var s=r.length,o=4==en(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){re(this),ne(this);var a="";break e}this.h.i=new i.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:!(o&&e==s-1)});r.length=0,this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(t,e,n,r,i,s,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o})}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!S(c)){var u=c;break e}}u=null}if(!(n=u)){this.o=!1,this.s=3,Pt(12),re(this),ne(this);break t}jt(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ie(this,n)}if(this.P){let t;for(n=!0;!this.J&&this.C<a.length;){if(t=Zt(this,a),t==Wt){4==d&&(this.s=4,Pt(14),n=!1),jt(this.i,this.l,null,"[Incomplete Response]");break}if(t==Qt){this.s=4,Pt(15),jt(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}jt(this.i,this.l,t,null),ie(this,t)}if(Jt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,Pt(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var l=this.j;l.g==this&&l.ba&&!l.M&&(l.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),pn(l),l.M=!0,Pt(11))}}else jt(this.i,this.l,a,"[Invalid Chunked Response]"),re(this),ne(this)}else jt(this.i,this.l,a,null),ie(this,a);4==d&&re(this),this.o&&!this.J&&(4==d?vn(this.j,this):(this.o=!1,$t(this)))}else(function(t){const e={};t=(t.g&&2<=en(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(S(t[r]))continue;var n=O(t[r]);const i=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,function(t){return t.join(", ")})})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Pt(12)):(this.s=0,Pt(13)),re(this),ne(this)}}}catch(d){}},Kt.prototype.cancel=function(){this.J=!0,re(this)},Kt.prototype.ba=function(){this.B=null;const t=Date.now();0<=t-this.S?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.i,this.A),2!=this.L&&(Lt(),Pt(17)),re(this),this.s=2,ne(this)):te(this,this.S-t)};var se=class{constructor(t,e){this.g=t,this.map=e}};function oe(t){this.l=t||10,i.PerformanceNavigationTiming?t=0<(t=i.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ae(t){return!!t.h||!!t.g&&t.g.size>=t.j}function ce(t){return t.h?1:t.g?t.g.size:0}function he(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function ue(t,e){t.g?t.g.add(e):t.h=e}function le(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function de(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return _(t.i)}function fe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(s(t)||"string"===typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.na&&"function"==typeof t.na)return t.na();if(!t.V||"function"!=typeof t.V){if("undefined"!==typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!==typeof Set&&t instanceof Set)){if(s(t)||"string"===typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.V&&"function"==typeof t.V)return t.V();if("undefined"!==typeof Map&&t instanceof Map||"undefined"!==typeof Set&&t instanceof Set)return Array.from(t.values());if("string"===typeof t)return t.split("");if(s(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}oe.prototype.cancel=function(){if(this.i=de(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var ge=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function pe(t){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,t instanceof pe){this.h=t.h,ye(this,t.j),this.o=t.o,this.g=t.g,ve(this,t.s),this.l=t.l;var e=t.i,n=new Re;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),we(this,n),this.m=t.m}else t&&(e=String(t).match(ge))?(this.h=!1,ye(this,e[1]||"",!0),this.o=_e(e[2]||""),this.g=_e(e[3]||"",!0),ve(this,e[4]),this.l=_e(e[5]||"",!0),we(this,e[6]||"",!0),this.m=_e(e[7]||"")):(this.h=!1,this.i=new Re(null,this.h))}function me(t){return new pe(t)}function ye(t,e,n){t.j=n?_e(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ve(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.s=e}else t.s=null}function we(t,e,n){e instanceof Re?(t.i=e,function(t,e){e&&!t.j&&(Oe(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(xe(this,e),Me(this,n,t))},t)),t.j=e}(t.i,t.h)):(n||(e=Te(e,Ne)),t.i=new Re(e,t.h))}function Ee(t,e,n){t.i.set(e,n)}function be(t){return Ee(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function _e(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Te(t,e,n){return"string"===typeof t?(t=encodeURI(t).replace(e,Se),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Se(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}pe.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Te(e,Ie,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(Te(e,Ie,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Te(n,"/"==n.charAt(0)?De:Ae,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",Te(n,ke)),t.join("")};var Ce,Ie=/[#\/\?@]/g,Ae=/[#\?:]/g,De=/[#\?]/g,Ne=/[#\?@]/g,ke=/#/g;function Re(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Oe(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function xe(t,e){Oe(t),e=Pe(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Le(t,e){return Oe(t),e=Pe(t,e),t.g.has(e)}function Me(t,e,n){xe(t,e),0<n.length&&(t.i=null,t.g.set(Pe(t,e),_(n)),t.h+=n.length)}function Pe(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Ve(t,e,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(s){}}function Fe(){this.g=new Tt}function Ue(t,e,n){const r=n||"";try{fe(t,function(t,n){let i=t;o(t)&&(i=bt(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function je(t){this.l=t.Ub||null,this.j=t.eb||!1}function Be(t,e){dt.call(this),this.D=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function qe(t){t.j.read().then(t.Pa.bind(t)).catch(t.ga.bind(t))}function ze(t){t.readyState=4,t.l=null,t.j=null,t.v=null,Ge(t)}function Ge(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Ke(t){let e="";return D(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}function He(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Ke(n),"string"===typeof t?null!=n&&encodeURIComponent(String(n)):Ee(t,e,n))}function Qe(t){dt.call(this),this.headers=new Map,this.o=t||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(t=Re.prototype).add=function(t,e){Oe(this),this.i=null,t=Pe(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){Oe(this),this.g.forEach(function(n,r){n.forEach(function(n){t.call(e,n,r,this)},this)},this)},t.na=function(){Oe(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let t=0;t<i.length;t++)n.push(e[r])}return n},t.V=function(t){Oe(this);let e=[];if("string"===typeof t)Le(this,t)&&(e=e.concat(this.g.get(Pe(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},t.set=function(t,e){return Oe(this),this.i=null,Le(this,t=Pe(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&0<(t=this.V(t)).length?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")},l(je,St),je.prototype.g=function(){return new Be(this.l,this.j)},je.prototype.i=(Ce={},function(){return Ce}),l(Be,dt),(t=Be.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=t,this.A=e,this.readyState=1,Ge(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.u,method:this.B,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||i).fetch(new Request(this.A,e)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ze(this)),this.readyState=0},t.Sa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Ge(this)),this.g&&(this.readyState=3,Ge(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if("undefined"!==typeof i.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;qe(this)}else t.text().then(this.Ra.bind(this),this.ga.bind(this))},t.Pa=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.v.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?ze(this):Ge(this),3==this.readyState&&qe(this)}},t.Ra=function(t){this.g&&(this.response=this.responseText=t,ze(this))},t.Qa=function(t){this.g&&(this.response=t,ze(this))},t.ga=function(){this.g&&ze(this)},t.setRequestHeader=function(t,e){this.u.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Be.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),l(Qe,dt);var We=/^https?$/i,Xe=["POST","PUT"];function Ye(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.m=5,Je(t),$e(t)}function Je(t){t.A||(t.A=!0,ft(t,"complete"),ft(t,"error"))}function Ze(t){if(t.h&&"undefined"!=typeof r&&(!t.v[1]||4!=en(t)||2!=t.Z()))if(t.u&&4==en(t))pt(t.Ea,0,t);else if(ft(t,"readystatechange"),4==en(t)){t.h=!1;try{const r=t.Z();t:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var s;if(s=0===r){var o=String(t.D).match(ge)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),s=!We.test(o?o.toLowerCase():"")}n=s}if(n)ft(t,"complete"),ft(t,"success");else{t.m=6;try{var a=2<en(t)?t.g.statusText:""}catch(c){a=""}t.l=a+" ["+t.Z()+"]",Je(t)}}finally{$e(t)}}}function $e(t,e){if(t.g){tn(t);const r=t.g,i=t.v[0]?()=>{}:null;t.g=null,t.v=null,e||ft(t,"ready");try{r.onreadystatechange=i}catch(n){}}}function tn(t){t.I&&(i.clearTimeout(t.I),t.I=null)}function en(t){return t.g?t.g.readyState:0}function nn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.H){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function rn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function sn(t){this.Aa=0,this.i=[],this.j=new Ut,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=rn("failFast",!1,t),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=rn("baseRetryDelayMs",5e3,t),this.cb=rn("retryDelaySeedMs",1e4,t),this.Wa=rn("forwardChannelMaxRetries",2,t),this.wa=rn("forwardChannelRequestTimeoutMs",2e4,t),this.pa=t&&t.xmlHttpFactory||void 0,this.Xa=t&&t.Tb||void 0,this.Ca=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.h=new oe(t&&t.concurrentRequestLimit),this.Da=new Fe,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=t&&t.Rb||!1,t&&t.xa&&this.j.xa(),t&&t.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&t&&t.detectBufferingProxy||!1,this.ja=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.ja=t.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function on(t){if(cn(t),3==t.G){var e=t.U++,n=me(t.I);if(Ee(n,"SID",t.K),Ee(n,"RID",e),Ee(n,"TYPE","terminate"),ln(t,n),(e=new Kt(t,t.j,e)).L=2,e.v=be(me(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(e.v.toString(),"")}catch(r){}!n&&i.Image&&((new Image).src=e.v,n=!0),n||(e.g=Tn(e.j,null),e.g.ea(e.v)),e.F=Date.now(),$t(e)}bn(t)}function an(t){t.g&&(pn(t),t.g.cancel(),t.g=null)}function cn(t){an(t),t.u&&(i.clearTimeout(t.u),t.u=null),yn(t),t.h.cancel(),t.s&&("number"===typeof t.s&&i.clearTimeout(t.s),t.s=null)}function hn(t){if(!ae(t.h)&&!t.s){t.s=!0;var e=t.Ga;V||j(),F||(V(),F=!0),U.add(e,t),t.B=0}}function un(t,e){var n;n=e?e.l:t.U++;const r=me(t.I);Ee(r,"SID",t.K),Ee(r,"RID",n),Ee(r,"AID",t.T),ln(t,r),t.m&&t.o&&He(r,t.m,t.o),n=new Kt(t,t.j,n,t.B+1),null===t.m&&(n.H=t.o),e&&(t.i=e.D.concat(t.i)),e=dn(t,n,1e3),n.I=Math.round(.5*t.wa)+Math.round(.5*t.wa*Math.random()),ue(t.h,n),Xt(n,r,e)}function ln(t,e){t.H&&D(t.H,function(t,n){Ee(e,n,t)}),t.l&&fe({},function(t,n){Ee(e,n,t)})}function dn(t,e,n){n=Math.min(t.i.length,n);var r=t.l?h(t.l.Na,t.l,t):null;t:{var i=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let o=!0;for(let a=0;a<n;a++){let n=i[a].g;const c=i[a].map;if(n-=e,0>n)e=Math.max(0,i[a].g-100),o=!1;else try{Ue(c,t,"req"+n+"_")}catch(s){r&&r(c)}}if(o){r=t.join("&");break t}}}return t=t.i.splice(0,n),e.D=t,r}function fn(t){if(!t.g&&!t.u){t.Y=1;var e=t.Fa;V||j(),F||(V(),F=!0),U.add(e,t),t.v=0}}function gn(t){return!(t.g||t.u||3<=t.v)&&(t.Y++,t.u=Ft(h(t.Fa,t),wn(t,t.v)),t.v++,!0)}function pn(t){null!=t.A&&(i.clearTimeout(t.A),t.A=null)}function mn(t){t.g=new Kt(t,t.j,"rpc",t.Y),null===t.m&&(t.g.H=t.o),t.g.O=0;var e=me(t.qa);Ee(e,"RID","rpc"),Ee(e,"SID",t.K),Ee(e,"AID",t.T),Ee(e,"CI",t.F?"0":"1"),!t.F&&t.ja&&Ee(e,"TO",t.ja),Ee(e,"TYPE","xmlhttp"),ln(t,e),t.m&&t.o&&He(e,t.m,t.o),t.L&&(t.g.I=t.L);var n=t.g;t=t.ia,n.L=1,n.v=be(me(e)),n.m=null,n.P=!0,Yt(n,t)}function yn(t){null!=t.C&&(i.clearTimeout(t.C),t.C=null)}function vn(t,e){var n=null;if(t.g==e){yn(t),pn(t),t.g=null;var r=2}else{if(!he(t.h,e))return;n=e.D,le(t.h,e),r=1}if(0!=t.G)if(e.o)if(1==r){n=e.m?e.m.length:0,e=Date.now()-e.F;var i=t.B;ft(r=Ot(),new Vt(r,n)),hn(t)}else fn(t);else if(3==(i=e.s)||0==i&&0<e.X||!(1==r&&function(t,e){return!(ce(t.h)>=t.h.j-(t.s?1:0))&&(t.s?(t.i=e.D.concat(t.i),!0):!(1==t.G||2==t.G||t.B>=(t.Va?0:t.Wa))&&(t.s=Ft(h(t.Ga,t,e),wn(t,t.B)),t.B++,!0))}(t,e)||2==r&&gn(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),i){case 1:En(t,5);break;case 4:En(t,10);break;case 3:En(t,6);break;default:En(t,2)}}function wn(t,e){let n=t.Ta+Math.floor(Math.random()*t.cb);return t.isActive()||(n*=2),n*e}function En(t,e){if(t.j.info("Error code "+e),2==e){var n=h(t.fb,t),r=t.Xa;const e=!r;r=new pe(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||ye(r,"https"),be(r),e?function(t,e){const n=new Ut;if(i.Image){const r=new Image;r.onload=u(Ve,n,"TestLoadImage: loaded",!0,e,r),r.onerror=u(Ve,n,"TestLoadImage: error",!1,e,r),r.onabort=u(Ve,n,"TestLoadImage: abort",!1,e,r),r.ontimeout=u(Ve,n,"TestLoadImage: timeout",!1,e,r),i.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(r.toString(),n):function(t,e){new Ut;const n=new AbortController,r=setTimeout(()=>{n.abort(),Ve(0,0,!1,e)},1e4);fetch(t,{signal:n.signal}).then(t=>{clearTimeout(r),t.ok?Ve(0,0,!0,e):Ve(0,0,!1,e)}).catch(()=>{clearTimeout(r),Ve(0,0,!1,e)})}(r.toString(),n)}else Pt(2);t.G=0,t.l&&t.l.sa(e),bn(t),cn(t)}function bn(t){if(t.G=0,t.ka=[],t.l){const e=de(t.h);0==e.length&&0==t.i.length||(T(t.ka,e),T(t.ka,t.i),t.h.i.length=0,_(t.i),t.i.length=0),t.l.ra()}}function _n(t,e,n){var r=n instanceof pe?me(n):new pe(n);if(""!=r.g)e&&(r.g=e+"."+r.g),ve(r,r.s);else{var s=i.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var o=new pe(null);r&&ye(o,r),e&&(o.g=e),s&&ve(o,s),n&&(o.l=n),r=o}return n=t.D,e=t.ya,n&&e&&Ee(r,n,e),Ee(r,"VER",t.la),ln(t,r),r}function Tn(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ca&&!t.pa?new Qe(new je({eb:n})):new Qe(t.pa)).Ha(t.J),e}function Sn(){}function Cn(){}function In(t,e){dt.call(this),this.g=new sn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.va&&(t?t["X-WebChannel-Client-Profile"]=e.va:t={"X-WebChannel-Client-Profile":e.va}),this.g.S=t,(t=e&&e.Sb)&&!S(t)&&(this.g.m=t),this.v=e&&e.supportsCrossDomainXhr||!1,this.u=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!S(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new Nn(this)}function An(t){Dt.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Dn(){Nt.call(this),this.status=1}function Nn(t){this.g=t}(t=Qe.prototype).Ha=function(t){this.J=t},t.ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Bt.g(),this.v=this.o?Ct(this.o):Ct(Bt),this.g.onreadystatechange=h(this.Ea,this);try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(o){return void Ye(this,o)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find(t=>"content-type"==t.toLowerCase()),s=i.FormData&&t instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Xe,e,void 0))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,a]of n)this.g.setRequestHeader(i,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tn(this),this.u=!0,this.g.send(t),this.u=!1}catch(o){Ye(this,o)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=t||7,ft(this,"complete"),ft(this,"abort"),$e(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),$e(this,!0)),Qe.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Ze(this):this.bb())},t.bb=function(){Ze(this)},t.isActive=function(){return!!this.g},t.Z=function(){try{return 2<en(this)?this.g.status:-1}catch(Ce){return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch(Ce){return""}},t.Oa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),_t(e)}},t.Ba=function(){return this.m},t.Ka=function(){return"string"===typeof this.l?this.l:String(this.l)},(t=sn.prototype).la=8,t.G=1,t.connect=function(t,e,n,r){Pt(0),this.W=t,this.H=e||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=_n(this,null,this.W),hn(this)},t.Ga=function(t){if(this.s)if(this.s=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const i=new Kt(this,this.j,t);let s=this.o;if(this.S&&(s?(s=N(s),R(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)t:{for(var e=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"===typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=dn(this,i,e),Ee(n=me(this.I),"RID",t),Ee(n,"CVER",22),this.D&&Ee(n,"X-HTTP-Session-Id",this.D),ln(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(Ke(s)))+"&"+e:this.m&&He(n,this.m,s)),ue(this.h,i),this.Ua&&Ee(n,"TYPE","init"),this.P?(Ee(n,"$req",e),Ee(n,"SID","null"),i.T=!0,Xt(i,n,null)):Xt(i,n,e),this.G=2}}else 3==this.G&&(t?un(this,t):0==this.i.length||ae(this.h)||un(this))},t.Fa=function(){if(this.u=null,mn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var t=2*this.R;this.j.info("BP detection timer enabled: "+t),this.A=Ft(h(this.ab,this),t)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Pt(10),an(this),mn(this))},t.Za=function(){null!=this.C&&(this.C=null,an(this),gn(this),Pt(19))},t.fb=function(t){t?(this.j.info("Successfully pinged google.com"),Pt(2)):(this.j.info("Failed to ping google.com"),Pt(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=Sn.prototype).ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){},Cn.prototype.g=function(t,e){return new In(t,e)},l(In,dt),In.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},In.prototype.close=function(){on(this.g)},In.prototype.o=function(t){var e=this.g;if("string"===typeof t){var n={};n.__data__=t,t=n}else this.u&&((n={}).__data__=bt(t),t=n);e.i.push(new se(e.Ya++,t)),3==e.G&&hn(e)},In.prototype.N=function(){this.g.l=null,delete this.j,on(this.g),delete this.g,In.aa.N.call(this)},l(An,Dt),l(Dn,Nt),l(Nn,Sn),Nn.prototype.ua=function(){ft(this.g,"a")},Nn.prototype.ta=function(t){ft(this.g,new An(t))},Nn.prototype.sa=function(t){ft(this.g,new Dn)},Nn.prototype.ra=function(){ft(this.g,"b")},Cn.prototype.createWebChannel=Cn.prototype.g,In.prototype.send=In.prototype.o,In.prototype.open=In.prototype.m,In.prototype.close=In.prototype.close,w=b.createWebChannelTransport=function(){return new Cn},v=b.getStatEventTarget=function(){return Ot()},y=b.Event=kt,m=b.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},qt.NO_ERROR=0,qt.TIMEOUT=8,qt.HTTP_ERROR=6,p=b.ErrorCode=qt,zt.COMPLETE="complete",g=b.EventType=zt,It.EventType=At,At.OPEN="a",At.CLOSE="b",At.ERROR="c",At.MESSAGE="d",dt.prototype.listen=dt.prototype.K,f=b.WebChannel=It,b.FetchXmlHttpFactory=je,Qe.prototype.listenOnce=Qe.prototype.L,Qe.prototype.getLastError=Qe.prototype.Ka,Qe.prototype.getLastErrorCode=Qe.prototype.Ba,Qe.prototype.getStatus=Qe.prototype.Z,Qe.prototype.getResponseJson=Qe.prototype.Oa,Qe.prototype.getResponseText=Qe.prototype.oa,Qe.prototype.send=Qe.prototype.ea,Qe.prototype.setWithCredentials=Qe.prototype.Ha,d=b.XhrIo=Qe}).apply("undefined"!==typeof E?E:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const _="@firebase/firestore",T="4.9.0";class S{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}S.UNAUTHENTICATED=new S(null),S.GOOGLE_CREDENTIALS=new S("google-credentials-uid"),S.FIRST_PARTY=new S("first-party-uid"),S.MOCK_USER=new S("mock-user");let C="12.0.0";const I=new c.Vy("@firebase/firestore");function A(){return I.logLevel}function D(t){if(I.logLevel<=c.$b.DEBUG){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];const i=n.map(R);I.debug("Firestore (".concat(C,"): ").concat(t),...i)}}function N(t){if(I.logLevel<=c.$b.ERROR){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];const i=n.map(R);I.error("Firestore (".concat(C,"): ").concat(t),...i)}}function k(t){if(I.logLevel<=c.$b.WARN){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];const i=n.map(R);I.warn("Firestore (".concat(C,"): ").concat(t),...i)}}function R(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function O(t,e,n){let r="Unexpected state";"string"==typeof e?r=e:n=e,x(t,r,n)}function x(t,e,n){let r="FIRESTORE (".concat(C,") INTERNAL ASSERTION FAILED: ").concat(e," (ID: ").concat(t.toString(16),")");if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(t){r+=" CONTEXT: "+n}throw N(r),new Error(r)}function L(t,e,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,t||x(e,i,r)}function M(t,e){return t}const P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class V extends h.g{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class F{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class U{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))}}class j{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(S.UNAUTHENTICATED))}shutdown(){}}class B{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class q{constructor(t){this.t=t,this.currentUser=S.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){L(void 0===this.o,42304);let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new F;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new F,t.enqueueRetryable(()=>r(this.currentUser))};const s=()=>{const e=i;t.enqueueRetryable(async()=>{await e.promise,await r(this.currentUser)})},o=t=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(t=>o(t)),setTimeout(()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new F)}},0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(L("string"==typeof e.accessToken,31837,{l:e}),new U(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return L(null===t||"string"==typeof t,2055,{h:t}),new S(t)}}class z{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=S.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class G{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new z(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(S.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class K{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class H{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,o.xZ)(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){L(void 0===this.o,3512);const n=t=>{null!=t.error&&D("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(t.error.message));const n=t.token!==this.m;return this.m=t.token,D("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>n(e))};const r=t=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(t=>r(t)),setTimeout(()=>{if(!this.appCheck){const t=this.V.getImmediate({optional:!0});t?r(t):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new K(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(t=>t?(L("string"==typeof t.token,44558,{tokenResult:t}),this.m=t.token,new K(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Q(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class W{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Q(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function X(t,e){return t<e?-1:t>e?1:0}function Y(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.charAt(r),i=e.charAt(r);if(n!==i)return $(n)===$(i)?X(n,i):$(n)?1:-1}return X(t.length,e.length)}const J=55296,Z=57343;function $(t){const e=t.charCodeAt(0);return e>=J&&e<=Z}function tt(t,e,n){return t.length===e.length&&t.every((t,r)=>n(t,e[r]))}const et="__name__";class nt{constructor(t,e,n){void 0===e?e=0:e>t.length&&O(637,{offset:e,range:t.length}),void 0===n?n=t.length-e:n>t.length-e&&O(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===nt.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof nt?t.forEach(t=>{e.push(t)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=nt.compareSegments(t.get(r),e.get(r));if(0!==n)return n}return X(t.length,e.length)}static compareSegments(t,e){const n=nt.isNumericId(t),r=nt.isNumericId(e);return n&&!r?-1:!n&&r?1:n&&r?nt.extractNumericId(t).compare(nt.extractNumericId(e)):Y(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return r.fromString(t.substring(4,t.length-2))}}class rt extends nt{construct(t,e,n){return new rt(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const t=[];for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(const i of n){if(i.indexOf("//")>=0)throw new V(P.INVALID_ARGUMENT,"Invalid segment (".concat(i,"). Paths must not contain // in them."));t.push(...i.split("/").filter(t=>t.length>0))}return new rt(t)}static emptyPath(){return new rt([])}}const it=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class st extends nt{construct(t,e,n){return new st(t,e,n)}static isValidIdentifier(t){return it.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),st.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===et}static keyField(){return new st([et])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new V(P.INVALID_ARGUMENT,"Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new V(P.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new V(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new V(P.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new st(e)}static emptyPath(){return new st([])}}class ot{constructor(t){this.path=t}static fromPath(t){return new ot(rt.fromString(t))}static fromName(t){return new ot(rt.fromString(t).popFirst(5))}static empty(){return new ot(rt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===rt.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return rt.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new ot(new rt(t.slice()))}}function at(t,e,n){if(!n)throw new V(P.INVALID_ARGUMENT,"Function ".concat(t,"() cannot be called with an empty ").concat(e,"."))}function ct(t){if(ot.isDocumentKey(t))throw new V(P.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(t," has ").concat(t.length,"."))}function ht(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function ut(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t="".concat(t.substring(0,20),"...")),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?"a custom ".concat(e," object"):"an object"}}return"function"==typeof t?"a function":O(12329,{type:typeof t})}function lt(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new V(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ut(t);throw new V(P.INVALID_ARGUMENT,"Expected type '".concat(e.name,"', but it was: ").concat(n))}}return t}function dt(t,e){const n={typeString:t};return e&&(n.value=e),n}function ft(t,e){if(!ht(t))throw new V(P.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n="JSON missing required field: '".concat(r,"'");break}const o=t[r];if(i&&typeof o!==i){n="JSON field '".concat(r,"' must be a ").concat(i,".");break}if(void 0!==s&&o!==s.value){n="Expected '".concat(r,"' field to equal '").concat(s.value,"'");break}}if(n)throw new V(P.INVALID_ARGUMENT,n);return!0}const gt=-62135596800,pt=1e6;class mt{static now(){return mt.fromMillis(Date.now())}static fromDate(t){return mt.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*pt);return new mt(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new V(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new V(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<gt)throw new V(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new V(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/pt}_compareTo(t){return this.seconds===t.seconds?X(this.nanoseconds,t.nanoseconds):X(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:mt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(ft(t,mt._jsonSchema))return new mt(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-gt;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}mt._jsonSchemaVersion="firestore/timestamp/1.0",mt._jsonSchema={type:dt("string",mt._jsonSchemaVersion),seconds:dt("number"),nanoseconds:dt("number")};class yt{static fromTimestamp(t){return new yt(t)}static min(){return new yt(new mt(0,0))}static max(){return new yt(new mt(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const vt=-1;class wt{constructor(t,e,n,r){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=r}}wt.UNKNOWN_ID=-1;function Et(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=yt.fromTimestamp(1e9===r?new mt(n+1,0):new mt(n,r));return new _t(i,ot.empty(),e)}function bt(t){return new _t(t.readTime,t.key,vt)}class _t{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new _t(yt.min(),ot.empty(),vt)}static max(){return new _t(yt.max(),ot.empty(),vt)}}function Tt(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=ot.comparator(t.documentKey,e.documentKey),0!==n?n:X(t.largestBatchId,e.largestBatchId))}const St="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ct{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}async function It(t){if(t.code!==P.FAILED_PRECONDITION||t.message!==St)throw t;D("LocalStore","Unexpectedly lost primary lease")}class At{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&O(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new At((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof At?e:At.resolve(e)}catch(t){return At.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):At.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):At.reject(e)}static resolve(t){return new At((e,n)=>{e(t)})}static reject(t){return new At((e,n)=>{n(t)})}static waitFor(t){return new At((e,n)=>{let r=0,i=0,s=!1;t.forEach(t=>{++r,t.next(()=>{++i,s&&i===r&&e()},t=>n(t))}),s=!0,i===r&&e()})}static or(t){let e=At.resolve(!1);for(const n of t)e=e.next(t=>t?At.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,r)=>{n.push(e.call(this,t,r))}),this.waitFor(n)}static mapArray(t,e){return new At((n,r)=>{const i=t.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;e(t[c]).next(t=>{s[c]=t,++o,o===i&&n(s)},t=>r(t))}})}static doWhile(t,e){return new At((n,r)=>{const i=()=>{!0===t()?e().next(()=>{i()},r):n()};i()})}}function Dt(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Nt(t){return"IndexedDbTransactionError"===t.name}class kt{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ae(t),this.ue=t=>e.writeSequenceNumber(t))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}kt.ce=-1;const Rt=-1;function Ot(t){return null==t}function xt(t){return 0===t&&1/t==-1/0}const Lt="\x01";function Mt(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Vt(e)),e=Pt(t.get(n),e);return Vt(e)}function Pt(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const e=t.charAt(i);switch(e){case"\0":n+="\x01\x10";break;case Lt:n+="\x01\x11";break;default:n+=e}}return n}function Vt(t){return t+Lt+"\x01"}const Ft="remoteDocuments",Ut="owner",jt="mutationQueues",Bt="mutations";const qt="documentMutations",zt="remoteDocumentsV14",Gt="remoteDocumentGlobal",Kt="targets",Ht="targetDocuments",Qt="targetGlobal",Wt="collectionParents",Xt="clientMetadata",Yt="bundles",Jt="namedQueries",Zt="indexConfiguration",$t="indexState",te="indexEntries",ee="documentOverlays",ne="globals",re=[jt,Bt,qt,Ft,Kt,Ut,Qt,Ht,Xt,Gt,Wt,Yt,Jt],ie=[jt,Bt,qt,zt,Kt,Ut,Qt,Ht,Xt,Gt,Wt,Yt,Jt,ee],se=ie,oe=[...se,Zt,$t,te];function ae(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ce(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function he(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class ue{constructor(t,e){this.comparator=t,this.root=e||de.EMPTY}insert(t,e){return new ue(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,de.BLACK,null,null))}remove(t){return new ue(this.comparator,this.root.remove(t,this.comparator).copy(null,null,de.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.inorderTraversal((e,n)=>(t.push("".concat(e,":").concat(n)),!1)),"{".concat(t.join(", "),"}")}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new le(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new le(this.root,t,this.comparator,!1)}getReverseIterator(){return new le(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new le(this.root,t,this.comparator,!0)}}class le{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class de{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:de.RED,this.left=null!=r?r:de.EMPTY,this.right=null!=i?i:de.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new de(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return de.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return de.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,de.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,de.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw O(43730,{key:this.key,value:this.value});if(this.right.isRed())throw O(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw O(27949);return t+(this.isRed()?0:1)}}de.EMPTY=null,de.RED=!0,de.BLACK=!1,de.EMPTY=new class{constructor(){this.size=0}get key(){throw O(57766)}get value(){throw O(16141)}get color(){throw O(16727)}get left(){throw O(29726)}get right(){throw O(36894)}copy(t,e,n,r,i){return this}insert(t,e,n){return new de(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class fe{constructor(t){this.comparator=t,this.data=new ue(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new ge(this.data.getIterator())}getIteratorFrom(t){return new ge(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof fe))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new fe(this.comparator);return e.data=t,e}}class ge{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class pe{constructor(t){this.fields=t,t.sort(st.comparator)}static empty(){return new pe([])}unionWith(t){let e=new fe(st.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new pe(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return tt(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class me extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ye{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new me("Invalid base64 string: "+t):t}}(t);return new ye(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new ye(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return X(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ye.EMPTY_BYTE_STRING=new ye("");const ve=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function we(t){if(L(!!t,39018),"string"==typeof t){let e=0;const n=ve.exec(t);if(L(!!n,46558,{timestamp:t}),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ee(t.seconds),nanos:Ee(t.nanos)}}function Ee(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function be(t){return"string"==typeof t?ye.fromBase64String(t):ye.fromUint8Array(t)}const _e="server_timestamp",Te="__type__",Se="__previous_value__",Ce="__local_write_time__";function Ie(t){var e,n;return(null===(e=((null===t||void 0===t||null===(n=t.mapValue)||void 0===n?void 0:n.fields)||{})[Te])||void 0===e?void 0:e.stringValue)===_e}function Ae(t){const e=t.mapValue.fields[Se];return Ie(e)?Ae(e):e}function De(t){const e=we(t.mapValue.fields[Ce].timestampValue);return new mt(e.seconds,e.nanos)}class Ne{constructor(t,e,n,r,i,s,o,a,c,h){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=h}}const ke="(default)";class Re{constructor(t,e){this.projectId=t,this.database=e||ke}static empty(){return new Re("","")}get isDefaultDatabase(){return this.database===ke}isEqual(t){return t instanceof Re&&t.projectId===this.projectId&&t.database===this.database}}const Oe="__type__",xe="__max__",Le={mapValue:{fields:{__type__:{stringValue:xe}}}},Me="__vector__",Pe="value";function Ve(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ie(t)?4:$e(t)?9007199254740991:Je(t)?10:11:O(28295,{value:t})}function Fe(t,e){if(t===e)return!0;const n=Ve(t);if(n!==Ve(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return De(t).isEqual(De(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=we(t.timestampValue),r=we(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return be(t.bytesValue).isEqual(be(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ee(t.geoPointValue.latitude)===Ee(e.geoPointValue.latitude)&&Ee(t.geoPointValue.longitude)===Ee(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ee(t.integerValue)===Ee(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Ee(t.doubleValue),r=Ee(e.doubleValue);return n===r?xt(n)===xt(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return tt(t.arrayValue.values||[],e.arrayValue.values||[],Fe);case 10:case 11:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ae(n)!==ae(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Fe(n[i],r[i])))return!1;return!0}(t,e);default:return O(52216,{left:t})}}function Ue(t,e){return void 0!==(t.values||[]).find(t=>Fe(t,e))}function je(t,e){if(t===e)return 0;const n=Ve(t),r=Ve(e);if(n!==r)return X(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return X(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Ee(t.integerValue||t.doubleValue),r=Ee(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Be(t.timestampValue,e.timestampValue);case 4:return Be(De(t),De(e));case 5:return Y(t.stringValue,e.stringValue);case 6:return function(t,e){const n=be(t),r=be(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let i=0;i<n.length&&i<r.length;i++){const t=X(n[i],r[i]);if(0!==t)return t}return X(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=X(Ee(t.latitude),Ee(e.latitude));return 0!==n?n:X(Ee(t.longitude),Ee(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return qe(t.arrayValue,e.arrayValue);case 10:return function(t,e,n,r,i,s){const o=t.fields||{},a=e.fields||{},c=null===(n=o[Pe])||void 0===n?void 0:n.arrayValue,h=null===(r=a[Pe])||void 0===r?void 0:r.arrayValue,u=X((null===c||void 0===c||null===(i=c.values)||void 0===i?void 0:i.length)||0,(null===h||void 0===h||null===(s=h.values)||void 0===s?void 0:s.length)||0);return 0!==u?u:qe(c,h)}(t.mapValue,e.mapValue);case 11:return function(t,e){if(t===Le.mapValue&&e===Le.mapValue)return 0;if(t===Le.mapValue)return 1;if(e===Le.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const t=Y(r[o],s[o]);if(0!==t)return t;const e=je(n[r[o]],i[s[o]]);if(0!==e)return e}return X(r.length,s.length)}(t.mapValue,e.mapValue);default:throw O(23264,{he:n})}}function Be(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return X(t,e);const n=we(t),r=we(e),i=X(n.seconds,r.seconds);return 0!==i?i:X(n.nanos,r.nanos)}function qe(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const t=je(n[i],r[i]);if(t)return t}return X(n.length,r.length)}function ze(t){return Ge(t)}function Ge(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=we(t);return"time(".concat(e.seconds,",").concat(e.nanos,")")}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return be(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return ot.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return"geo(".concat(t.latitude,",").concat(t.longitude,")")}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=Ge(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+="".concat(i,":").concat(Ge(t.fields[i]));return n+"}"}(t.mapValue):O(61005,{value:t})}function Ke(t){switch(Ve(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ae(t);return e?16+Ke(e):16;case 5:return 2*t.stringValue.length;case 6:return be(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(t){return(t.values||[]).reduce((t,e)=>t+Ke(e),0)}(t.arrayValue);case 10:case 11:return function(t){let e=0;return ce(t.fields,(t,n)=>{e+=t.length+Ke(n)}),e}(t.mapValue);default:throw O(13486,{value:t})}}function He(t){return!!t&&"integerValue"in t}function Qe(t){return!!t&&"arrayValue"in t}function We(t){return!!t&&"nullValue"in t}function Xe(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ye(t){return!!t&&"mapValue"in t}function Je(t){var e,n;return(null===(e=((null===t||void 0===t||null===(n=t.mapValue)||void 0===n?void 0:n.fields)||{})[Oe])||void 0===e?void 0:e.stringValue)===Me}function Ze(t){if(t.geoPointValue)return{geoPointValue:(0,s.A)({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:(0,s.A)({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return ce(t.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Ze(n)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ze(t.arrayValue.values[n]);return e}return(0,s.A)({},t)}function $e(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===xe}class tn{constructor(t){this.value=t}static empty(){return new tn({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Ye(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ze(e)}setAll(t){let e=st.emptyPath(),n={},r=[];t.forEach((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=Ze(t):r.push(i.lastSegment())});const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());Ye(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Fe(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];Ye(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){ce(e,(e,n)=>t[e]=n);for(const r of n)delete t[r]}clone(){return new tn(Ze(this.value))}}class en{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new en(t,0,yt.min(),yt.min(),yt.min(),tn.empty(),0)}static newFoundDocument(t,e,n,r){return new en(t,1,e,yt.min(),n,r,0)}static newNoDocument(t,e){return new en(t,2,e,yt.min(),yt.min(),tn.empty(),0)}static newUnknownDocument(t,e){return new en(t,3,e,yt.min(),yt.min(),tn.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(yt.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=tn.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=tn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=yt.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof en&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new en(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class nn{constructor(t,e){this.position=t,this.inclusive=e}}function rn(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?ot.comparator(ot.fromName(o.referenceValue),n.key):je(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function sn(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Fe(t.position[n],e.position[n]))return!1;return!0}class on{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=t,this.dir=e}}function an(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class cn{}class hn extends cn{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new yn(t,e,n):"array-contains"===e?new bn(t,n):"in"===e?new _n(t,n):"not-in"===e?new Tn(t,n):"array-contains-any"===e?new Sn(t,n):new hn(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new vn(t,n):new wn(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&void 0===e.nullValue&&this.matchesComparison(je(e,this.value)):null!==e&&Ve(this.value)===Ve(e)&&this.matchesComparison(je(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return O(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class un extends cn{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new un(t,e)}matches(t){return ln(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ln(t){return"and"===t.op}function dn(t){return fn(t)&&ln(t)}function fn(t){for(const e of t.filters)if(e instanceof un)return!1;return!0}function gn(t){if(t instanceof hn)return t.field.canonicalString()+t.op.toString()+ze(t.value);if(dn(t))return t.filters.map(t=>gn(t)).join(",");{const e=t.filters.map(t=>gn(t)).join(",");return"".concat(t.op,"(").concat(e,")")}}function pn(t,e){return t instanceof hn?function(t,e){return e instanceof hn&&t.op===e.op&&t.field.isEqual(e.field)&&Fe(t.value,e.value)}(t,e):t instanceof un?function(t,e){return e instanceof un&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce((t,n,r)=>t&&pn(n,e.filters[r]),!0)}(t,e):void O(19439)}function mn(t){return t instanceof hn?function(t){return"".concat(t.field.canonicalString()," ").concat(t.op," ").concat(ze(t.value))}(t):t instanceof un?function(t){return t.op.toString()+" {"+t.getFilters().map(mn).join(" ,")+"}"}(t):"Filter"}class yn extends hn{constructor(t,e,n){super(t,e,n),this.key=ot.fromName(n.referenceValue)}matches(t){const e=ot.comparator(t.key,this.key);return this.matchesComparison(e)}}class vn extends hn{constructor(t,e){super(t,"in",e),this.keys=En("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class wn extends hn{constructor(t,e){super(t,"not-in",e),this.keys=En("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function En(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>ot.fromName(t.referenceValue))}class bn extends hn{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Qe(e)&&Ue(e.arrayValue,this.value)}}class _n extends hn{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Ue(this.value.arrayValue,e)}}class Tn extends hn{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ue(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&void 0===e.nullValue&&!Ue(this.value.arrayValue,e)}}class Sn extends hn{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Qe(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>Ue(this.value.arrayValue,t))}}class Cn{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Te=null}}function In(t){return new Cn(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function An(t){const e=M(t);if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>gn(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>function(t){return t.field.canonicalString()+t.dir}(t)).join(","),Ot(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(t=>ze(t)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(t=>ze(t)).join(",")),e.Te=t}return e.Te}function Dn(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!an(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!pn(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!sn(t.startAt,e.startAt)&&sn(t.endAt,e.endAt)}function Nn(t){return ot.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class kn{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Rn(t,e,n,r,i,s,o,a){return new kn(t,e,n,r,i,s,o,a)}function On(t){return new kn(t)}function xn(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Ln(t){return null!==t.collectionGroup}function Mn(t){const e=M(t);if(null===e.Ie){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new fe(st.comparator);return t.filters.forEach(t=>{t.getFlattenedFilters().forEach(t=>{t.isInequality()&&(e=e.add(t.field))})}),e}(e);r.forEach(r=>{t.has(r.canonicalString())||r.isKeyField()||e.Ie.push(new on(r,n))}),t.has(st.keyField().canonicalString())||e.Ie.push(new on(st.keyField(),n))}return e.Ie}function Pn(t){const e=M(t);return e.Ee||(e.Ee=Vn(e,Mn(t))),e.Ee}function Vn(t,e){if("F"===t.limitType)return In(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(t=>{const e="desc"===t.dir?"asc":"desc";return new on(t.field,e)});const n=t.endAt?new nn(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new nn(t.startAt.position,t.startAt.inclusive):null;return In(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Fn(t,e,n){return new kn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Un(t,e){return Dn(Pn(t),Pn(e))&&t.limitType===e.limitType}function jn(t){return"".concat(An(Pn(t)),"|lt:").concat(t.limitType)}function Bn(t){return"Query(target=".concat(function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: [".concat(t.filters.map(t=>mn(t)).join(", "),"]")),Ot(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: [".concat(t.orderBy.map(t=>function(t){return"".concat(t.field.canonicalString()," (").concat(t.dir,")")}(t)).join(", "),"]")),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(t=>ze(t)).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(t=>ze(t)).join(",")),"Target(".concat(e,")")}(Pn(t)),"; limitType=").concat(t.limitType,")")}function qn(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ot.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Mn(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=rn(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,Mn(t),e))&&!(t.endAt&&!function(t,e,n){const r=rn(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,Mn(t),e))}(t,e)}function zn(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Gn(t){return(e,n)=>{let r=!1;for(const i of Mn(t)){const t=Kn(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function Kn(t,e,n){const r=t.field.isKeyField()?ot.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?je(r,i):O(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return O(19790,{direction:t.dir})}}class Hn{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,t))return i}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){ce(this.inner,(e,n)=>{for(const[r,i]of n)t(r,i)})}isEmpty(){return he(this.inner)}size(){return this.innerSize}}const Qn=new ue(ot.comparator);function Wn(){return Qn}const Xn=new ue(ot.comparator);function Yn(){let t=Xn;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(const i of n)t=t.insert(i.key,i);return t}function Jn(t){let e=Xn;return t.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Zn(){return tr()}function $n(){return tr()}function tr(){return new Hn(t=>t.toString(),(t,e)=>t.isEqual(e))}new ue(ot.comparator);const er=new fe(ot.comparator);function nr(){let t=er;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(const i of n)t=t.add(i);return t}const rr=new fe(X);function ir(){return rr}function sr(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xt(e)?"-0":e}}function or(t){return{integerValue:""+t}}class ar{constructor(){this._=void 0}}function cr(t,e,n){return t instanceof lr?function(t,e){const n={fields:{[Te]:{stringValue:_e},[Ce]:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Ie(e)&&(e=Ae(e)),e&&(n.fields[Se]=e),{mapValue:n}}(n,e):t instanceof dr?fr(t,e):t instanceof gr?pr(t,e):function(t,e){const n=ur(t,e),r=yr(n)+yr(t.Ae);return He(n)&&He(t.Ae)?or(r):sr(t.serializer,r)}(t,e)}function hr(t,e,n){return t instanceof dr?fr(t,e):t instanceof gr?pr(t,e):n}function ur(t,e){return t instanceof mr?function(t){return He(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class lr extends ar{}class dr extends ar{constructor(t){super(),this.elements=t}}function fr(t,e){const n=vr(e);for(const r of t.elements)n.some(t=>Fe(t,r))||n.push(r);return{arrayValue:{values:n}}}class gr extends ar{constructor(t){super(),this.elements=t}}function pr(t,e){let n=vr(e);for(const r of t.elements)n=n.filter(t=>!Fe(t,r));return{arrayValue:{values:n}}}class mr extends ar{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function yr(t){return Ee(t.integerValue||t.doubleValue)}function vr(t){return Qe(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class wr{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new wr}static exists(t){return new wr(void 0,t)}static updateTime(t){return new wr(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Er(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class br{}function _r(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Rr(t.key,wr.none()):new Ir(t.key,t.data,wr.none());{const n=t.data,r=tn.empty();let i=new fe(st.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),i=i.add(t)}return new Ar(t.key,r,new pe(i.toArray()),wr.none())}}function Tr(t,e,n){t instanceof Ir?function(t,e,n){const r=t.value.clone(),i=Nr(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Ar?function(t,e,n){if(!Er(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Nr(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Dr(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Sr(t,e,n,r){return t instanceof Ir?function(t,e,n,r){if(!Er(t.precondition,e))return n;const i=t.value.clone(),s=kr(t.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof Ar?function(t,e,n,r){if(!Er(t.precondition,e))return n;const i=kr(t.fieldTransforms,r,e),s=e.data;return s.setAll(Dr(t)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map(t=>t.field))}(t,e,n,r):function(t,e,n){return Er(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Cr(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&tt(t,e,(t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof dr&&e instanceof dr||t instanceof gr&&e instanceof gr?tt(t.elements,e.elements,Fe):t instanceof mr&&e instanceof mr?Fe(t.Ae,e.Ae):t instanceof lr&&e instanceof lr}(t.transform,e.transform)}(t,e))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Ir extends br{constructor(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Ar extends br{constructor(t,e,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Dr(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function Nr(t,e,n){const r=new Map;L(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,hr(o,a,n[i]))}return r}function kr(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,cr(t,s,e))}return r}class Rr extends br{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Or{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let r=0;r<this.mutations.length;r++){const e=this.mutations[r];e.key.isEqual(t.key)&&Tr(e,t,n[r])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Sr(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Sr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=$n();return this.mutations.forEach(r=>{const i=t.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=e.has(r.key)?null:o;const a=_r(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(yt.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),nr())}isEqual(t){return this.batchId===t.batchId&&tt(this.mutations,t.mutations,(t,e)=>Cr(t,e))&&tt(this.baseMutations,t.baseMutations,(t,e)=>Cr(t,e))}}class xr{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class Lr{constructor(t,e){this.count=t,this.unchangedNames=e}}var Mr,Pr;function Vr(t){if(void 0===t)return N("GRPC error has no .code"),P.UNKNOWN;switch(t){case Mr.OK:return P.OK;case Mr.CANCELLED:return P.CANCELLED;case Mr.UNKNOWN:return P.UNKNOWN;case Mr.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case Mr.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case Mr.INTERNAL:return P.INTERNAL;case Mr.UNAVAILABLE:return P.UNAVAILABLE;case Mr.UNAUTHENTICATED:return P.UNAUTHENTICATED;case Mr.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case Mr.NOT_FOUND:return P.NOT_FOUND;case Mr.ALREADY_EXISTS:return P.ALREADY_EXISTS;case Mr.PERMISSION_DENIED:return P.PERMISSION_DENIED;case Mr.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case Mr.ABORTED:return P.ABORTED;case Mr.OUT_OF_RANGE:return P.OUT_OF_RANGE;case Mr.UNIMPLEMENTED:return P.UNIMPLEMENTED;case Mr.DATA_LOSS:return P.DATA_LOSS;default:return O(39323,{code:t})}}(Pr=Mr||(Mr={}))[Pr.OK=0]="OK",Pr[Pr.CANCELLED=1]="CANCELLED",Pr[Pr.UNKNOWN=2]="UNKNOWN",Pr[Pr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Pr[Pr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Pr[Pr.NOT_FOUND=5]="NOT_FOUND",Pr[Pr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Pr[Pr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Pr[Pr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Pr[Pr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Pr[Pr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Pr[Pr.ABORTED=10]="ABORTED",Pr[Pr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Pr[Pr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Pr[Pr.INTERNAL=13]="INTERNAL",Pr[Pr.UNAVAILABLE=14]="UNAVAILABLE",Pr[Pr.DATA_LOSS=15]="DATA_LOSS";let Fr=null;function Ur(){return new TextEncoder}const jr=new r([4294967295,4294967295],0);function Br(t){const e=Ur().encode(t),n=new i;return n.update(e),new Uint8Array(n.digest())}function qr(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),i=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new r([n,i],0),new r([s,o],0)]}class zr{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Gr("Invalid padding: ".concat(e));if(n<0)throw new Gr("Invalid hash count: ".concat(n));if(t.length>0&&0===this.hashCount)throw new Gr("Invalid hash count: ".concat(n));if(0===t.length&&0!==e)throw new Gr("Invalid padding when bitmap length is 0: ".concat(e));this.ge=8*t.length-e,this.pe=r.fromNumber(this.ge)}ye(t,e,n){let i=t.add(e.multiply(r.fromNumber(n)));return 1===i.compare(jr)&&(i=new r([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.ge)return!1;const e=Br(t),[n,r]=qr(e);for(let i=0;i<this.hashCount;i++){const t=this.ye(n,r,i);if(!this.we(t))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),s=new zr(i,r,e);return n.forEach(t=>s.insert(t)),s}insert(t){if(0===this.ge)return;const e=Br(t),[n,r]=qr(e);for(let i=0;i<this.hashCount;i++){const t=this.ye(n,r,i);this.Se(t)}}Se(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Gr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Kr{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,Hr.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Kr(yt.min(),r,new ue(X),Wn(),nr())}}class Hr{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Hr(n,e,nr(),nr(),nr())}}class Qr{constructor(t,e,n,r){this.be=t,this.removedTargetIds=e,this.key=n,this.De=r}}class Wr{constructor(t,e){this.targetId=t,this.Ce=e}}class Xr{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ye.EMPTY_BYTE_STRING,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class Yr{constructor(){this.ve=0,this.Fe=$r(),this.Me=ye.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=nr(),e=nr(),n=nr();return this.Fe.forEach((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:O(38017,{changeType:i})}}),new Hr(this.Me,this.xe,t,e,n)}qe(){this.Oe=!1,this.Fe=$r()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,L(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Jr{constructor(t){this.Ge=t,this.ze=new Map,this.je=Wn(),this.Je=Zr(),this.He=Zr(),this.Ye=new ue(X)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,e=>{const n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(t.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.We(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:O(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach((t,n)=>{this.rt(n)&&e(n)})}st(t){const e=t.targetId,n=t.Ce.count,r=this.ot(e);if(r){const s=r.target;if(Nn(s))if(0===n){const t=new ot(s.path);this.et(e,t,en.newNoDocument(t,yt.min()))}else L(1===n,20013,{expectedCount:n});else{const r=this._t(e);if(r!==n){var i;const n=this.ut(t),s=n?this.ct(n,t,r):1;if(0!==s){this.it(e);const t=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,t)}null===(i=Fr)||void 0===i||i.lt(function(t,e,n,r,i,s,o,a,c,h){const u={localCacheCount:t,existenceFilterCount:e.count,databaseId:n.database,projectId:n.projectId},l=e.unchangedNames;return l&&(u.bloomFilter={applied:0===i,hashCount:null!==(s=null===l||void 0===l?void 0:l.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(o=null===l||void 0===l||null===(a=l.bits)||void 0===a||null===(a=a.bitmap)||void 0===a?void 0:a.length)&&void 0!==o?o:0,padding:null!==(c=null===l||void 0===l||null===(h=l.bits)||void 0===h?void 0:h.padding)&&void 0!==c?c:0,mightContain:t=>{var e;return null!==(e=null===r||void 0===r?void 0:r.mightContain(t))&&void 0!==e&&e}}),u}(r,t.Ce,this.Ge.ht(),n,s))}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=e;let s,o;try{s=be(n).toUint8Array()}catch(t){if(t instanceof me)return k("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new zr(s,r,i)}catch(t){return k(t instanceof Gr?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.ge?null:o}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){const n=this.Ge.getRemoteKeysForTarget(e);let r=0;return n.forEach(n=>{const i=this.Ge.ht(),s="projects/".concat(i.projectId,"/databases/").concat(i.database,"/documents/").concat(n.path.canonicalString());t.mightContain(s)||(this.et(e,n,null),r++)}),r}Tt(t){const e=new Map;this.ze.forEach((n,r)=>{const i=this.ot(r);if(i){if(n.current&&Nn(i.target)){const e=new ot(i.target.path);this.It(e).has(r)||this.Et(r,e)||this.et(r,e,en.newNoDocument(e,t))}n.Be&&(e.set(r,n.ke()),n.qe())}});let n=nr();this.He.forEach((t,e)=>{let r=!0;e.forEachWhile(t=>{const e=this.ot(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)}),r&&(n=n.add(t))}),this.je.forEach((e,n)=>n.setReadTime(t));const r=new Kr(t,e,this.Ye,this.je,n);return this.je=Wn(),this.Je=Zr(),this.He=Zr(),this.Ye=new ue(X),r}Xe(t,e){if(!this.rt(t))return;const n=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,n),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;const r=this.nt(t);this.Et(t,e)?r.Qe(e,1):r.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new Yr,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new fe(X),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new fe(X),this.Je=this.Je.insert(t,e)),e}rt(t){const e=null!==this.ot(t);return e||D("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new Yr),this.Ge.getRemoteKeysForTarget(t).forEach(e=>{this.et(t,e,null)})}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function Zr(){return new ue(ot.comparator)}function $r(){return new ue(ot.comparator)}const ti={asc:"ASCENDING",desc:"DESCENDING"},ei={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ni={and:"AND",or:"OR"};class ri{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function ii(t,e){return t.useProto3Json||Ot(e)?e:{value:e}}function si(t,e){return t.useProto3Json?"".concat(new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+e.nanoseconds).slice(-9),"Z"):{seconds:""+e.seconds,nanos:e.nanoseconds}}function oi(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function ai(t){return L(!!t,49232),yt.fromTimestamp(function(t){const e=we(t);return new mt(e.seconds,e.nanos)}(t))}function ci(t,e){return hi(t,e).canonicalString()}function hi(t,e){const n=function(t){return new rt(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function ui(t){const e=rt.fromString(t);return L(Ii(e),10190,{key:e.toString()}),e}function li(t,e){const n=ui(e);if(n.get(1)!==t.databaseId.projectId)throw new V(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new V(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ot(pi(n))}function di(t,e){return ci(t.databaseId,e)}function fi(t){const e=ui(t);return 4===e.length?rt.emptyPath():pi(e)}function gi(t){return new rt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function pi(t){return L(t.length>4&&"documents"===t.get(4),29091,{key:t.toString()}),t.popFirst(5)}function mi(t,e){return{documents:[di(t,e.path)]}}function yi(t,e){const n={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=di(t,i);const s=function(t){if(0!==t.length)return Ci(un.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(t){if(0!==t.length)return t.map(t=>function(t){return{field:Ti(t.field),direction:Ei(t.dir)}}(t))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=ii(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ft:n,parent:i}}function vi(t){let e=fi(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){L(1===r,65062);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=wi(t);return e instanceof un&&dn(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map(t=>function(t){return new on(Si(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Ot(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new nn(n,e)}(n.startAt));let h=null;return n.endAt&&(h=function(t){const e=!t.before,n=t.values||[];return new nn(n,e)}(n.endAt)),Rn(e,i,o,s,a,"F",c,h)}function wi(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Si(t.unaryFilter.field);return hn.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Si(t.unaryFilter.field);return hn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Si(t.unaryFilter.field);return hn.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Si(t.unaryFilter.field);return hn.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return O(61313);default:return O(60726)}}(t):void 0!==t.fieldFilter?function(t){return hn.create(Si(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return O(58110);default:return O(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return un.create(t.compositeFilter.filters.map(t=>wi(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return O(1026)}}(t.compositeFilter.op))}(t):O(30097,{filter:t})}function Ei(t){return ti[t]}function bi(t){return ei[t]}function _i(t){return ni[t]}function Ti(t){return{fieldPath:t.canonicalString()}}function Si(t){return st.fromServerFormat(t.fieldPath)}function Ci(t){return t instanceof hn?function(t){if("=="===t.op){if(Xe(t.value))return{unaryFilter:{field:Ti(t.field),op:"IS_NAN"}};if(We(t.value))return{unaryFilter:{field:Ti(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Xe(t.value))return{unaryFilter:{field:Ti(t.field),op:"IS_NOT_NAN"}};if(We(t.value))return{unaryFilter:{field:Ti(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ti(t.field),op:bi(t.op),value:t.value}}}(t):t instanceof un?function(t){const e=t.getFilters().map(t=>Ci(t));return 1===e.length?e[0]:{compositeFilter:{op:_i(t.op),filters:e}}}(t):O(54877,{filter:t})}function Ii(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Ai{constructor(t,e,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:yt.min(),s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:yt.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:ye.EMPTY_BYTE_STRING,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Ai(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Ai(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Ai(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Ai(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Di{constructor(t){this.yt=t}}function Ni(t){const e=vi({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Fn(e,e.limit,"L"):e}class ki{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(Ee(t.integerValue));else if("doubleValue"in t){const n=Ee(t.doubleValue);isNaN(n)?this.Ft(e,13):(this.Ft(e,15),xt(n)?e.Mt(0):e.Mt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ft(e,20),"string"==typeof n&&(n=we(n)),e.xt("".concat(n.seconds||"")),e.Mt(n.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(be(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Ft(e,45),e.Mt(n.latitude||0),e.Mt(n.longitude||0)}else"mapValue"in t?$e(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):Je(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):O(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){const n=t.fields||{};this.Ft(e,55);for(const r of Object.keys(n))this.Ot(r,e),this.Ct(n[r],e)}kt(t,e){var n;const r=t.fields||{};this.Ft(e,53);const i=Pe,s=(null===(n=r[i].arrayValue)||void 0===n||null===(n=n.values)||void 0===n?void 0:n.length)||0;this.Ft(e,15),e.Mt(Ee(s)),this.Ot(i,e),this.Ct(r[i],e)}Qt(t,e){const n=t.values||[];this.Ft(e,50);for(const r of n)this.Ct(r,e)}Lt(t,e){this.Ft(e,37),ot.fromName(t).path.forEach(t=>{this.Ft(e,60),this.Ut(t,e)})}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}}ki.Kt=new ki;class Ri{constructor(){this.Cn=new Oi}addToCollectionParentIndex(t,e){return this.Cn.add(e),At.resolve()}getCollectionParents(t,e){return At.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return At.resolve()}deleteFieldIndex(t,e){return At.resolve()}deleteAllFieldIndexes(t){return At.resolve()}createTargetIndexes(t,e){return At.resolve()}getDocumentsMatchingTarget(t,e){return At.resolve(null)}getIndexType(t,e){return At.resolve(0)}getFieldIndexes(t,e){return At.resolve([])}getNextCollectionGroupToUpdate(t){return At.resolve(null)}getMinOffset(t,e){return At.resolve(_t.min())}getMinOffsetFromCollectionGroup(t,e){return At.resolve(_t.min())}updateCollectionGroup(t,e,n){return At.resolve()}updateIndexEntries(t,e){return At.resolve()}}class Oi{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new fe(rt.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new fe(rt.comparator)).toArray()}}new Uint8Array(0);const xi={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Li=41943040;class Mi{static withCacheSize(t){return new Mi(t,Mi.DEFAULT_COLLECTION_PERCENTILE,Mi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}Mi.DEFAULT_COLLECTION_PERCENTILE=10,Mi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Mi.DEFAULT=new Mi(Li,Mi.DEFAULT_COLLECTION_PERCENTILE,Mi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Mi.DISABLED=new Mi(-1,0,0);class Pi{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new Pi(0)}static cr(){return new Pi(-1)}}const Vi="LruGarbageCollector",Fi=1048576;function Ui(t,e){let[n,r]=t,[i,s]=e;const o=X(n,i);return 0===o?X(r,s):o}class ji{constructor(t){this.Ir=t,this.buffer=new fe(Ui),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Ui(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Bi{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(t){D(Vi,"Garbage collection scheduled in ".concat(t,"ms")),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Nt(t)?D(Vi,"Ignoring IndexedDB error during garbage collection: ",t):await It(t)}await this.Vr(3e5)})}}class qi{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next(t=>Math.floor(e/100*t))}nthSequenceNumber(t,e){if(0===e)return At.resolve(kt.ce);const n=new ji(e);return this.mr.forEachTarget(t,t=>n.Ar(t.sequenceNumber)).next(()=>this.mr.pr(t,t=>n.Ar(t))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.mr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector","Garbage collection skipped; disabled"),At.resolve(xi)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(n," is lower than threshold ").concat(this.params.cacheSizeCollectionThreshold)),xi):this.yr(t,e))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let n,r,i,s,o,a,h;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(e>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(this.params.maximumSequenceNumbersToCollect," from ").concat(e)),r=this.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),this.nthSequenceNumber(t,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(t,n,e))).next(e=>(i=e,a=Date.now(),this.removeOrphanedDocuments(t,n))).next(t=>(h=Date.now(),A()<=c.$b.DEBUG&&D("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(s-u,"ms\n\tDetermined least recently used ").concat(r," in ")+(o-s)+"ms\n"+"\tRemoved ".concat(i," targets in ")+(a-o)+"ms\n"+"\tRemoved ".concat(t," documents in ")+(h-a)+"ms\n"+"Total Duration: ".concat(h-u,"ms")),At.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})))}}function zi(t,e){return new qi(t,e)}class Gi{constructor(){this.changes=new Hn(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,en.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?At.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Ki{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Hi{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(r=>(n=r,this.remoteDocumentCache.getEntry(t,e))).next(t=>(null!==n&&Sr(n.mutation,t,pe.empty(),mt.now()),t))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,nr()).next(()=>e))}getLocalViewOfDocuments(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:nr();const r=Zn();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,n).next(t=>{let e=Yn();return t.forEach((t,n)=>{e=e.insert(t,n.overlayedDocument)}),e}))}getOverlayedDocuments(t,e){const n=Zn();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,nr()))}populateOverlays(t,e,n){const r=[];return n.forEach(t=>{e.has(t)||r.push(t)}),this.documentOverlayCache.getOverlays(t,r).next(t=>{t.forEach((t,n)=>{e.set(t,n)})})}computeViews(t,e,n,r){let i=Wn();const s=tr(),o=tr();return e.forEach((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Ar)?i=i.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),Sr(o.mutation,e,o.mutation.getFieldMask(),mt.now())):s.set(e.key,pe.empty())}),this.recalculateAndSaveOverlays(t,i).next(t=>(t.forEach((t,e)=>s.set(t,e)),e.forEach((t,e)=>{var n;return o.set(t,new Ki(e,null!==(n=s.get(t))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(t,e){const n=tr();let r=new ue((t,e)=>t-e),i=nr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(t=>{for(const i of t)i.keys().forEach(t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||pe.empty();o=i.applyToLocalView(s,o),n.set(t,o);const a=(r.get(i.batchId)||nr()).add(t);r=r.insert(i.batchId,a)})}).next(()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,h=$n();c.forEach(t=>{if(!i.has(t)){const r=_r(e.get(t),n.get(t));null!==r&&h.set(t,r),i=i.add(t)}}),s.push(this.documentOverlayCache.saveOverlays(t,a,h))}return At.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return ot.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Ln(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next(i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-i.size):At.resolve(Zn());let o=vt,a=i;return s.next(e=>At.forEach(e,(e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?At.resolve():this.remoteDocumentCache.getEntry(t,e).next(t=>{a=a.insert(e,t)}))).next(()=>this.populateOverlays(t,e,i)).next(()=>this.computeViews(t,a,e,nr())).next(t=>({batchId:o,changes:Jn(t)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new ot(e)).next(t=>{let e=Yn();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const i=e.collectionGroup;let s=Yn();return this.indexManager.getCollectionParents(t,i).next(o=>At.forEach(o,o=>{const a=function(t,e){return new kn(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next(t=>{t.forEach((t,e)=>{s=s.insert(t,e)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(t,e,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,r))).next(t=>{i.forEach((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,en.newInvalidDocument(r)))});let n=Yn();return t.forEach((t,r)=>{const s=i.get(t);void 0!==s&&Sr(s.mutation,r,pe.empty(),mt.now()),qn(e,r)&&(n=n.insert(t,r))}),n})}}class Qi{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return At.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:ai(t.createTime)}}(e)),At.resolve()}getNamedQuery(t,e){return At.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,function(t){return{name:t.name,query:Ni(t.bundledQuery),readTime:ai(t.readTime)}}(e)),At.resolve()}}class Wi{constructor(){this.overlays=new ue(ot.comparator),this.qr=new Map}getOverlay(t,e){return At.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Zn();return At.forEach(e,e=>this.getOverlay(t,e).next(t=>{null!==t&&n.set(e,t)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((n,r)=>{this.St(t,e,r)}),At.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.qr.get(n);return void 0!==r&&(r.forEach(t=>this.overlays=this.overlays.remove(t)),this.qr.delete(n)),At.resolve()}getOverlaysForCollection(t,e,n){const r=Zn(),i=e.length+1,s=new ot(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&t.largestBatchId>n&&r.set(t.getKey(),t)}return At.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new ue((t,e)=>t-e);const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=Zn(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Zn(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((t,e)=>o.set(t,e)),!(o.size()>=r)););return At.resolve(o)}St(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new xr(e,n));let i=this.qr.get(e);void 0===i&&(i=nr(),this.qr.set(e,i)),this.qr.set(e,i.add(n.key))}}class Xi{constructor(){this.sessionToken=ye.EMPTY_BYTE_STRING}getSessionToken(t){return At.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,At.resolve()}}class Yi{constructor(){this.Qr=new fe(Ji.$r),this.Ur=new fe(Ji.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const n=new Ji(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach(t=>this.addReference(t,e))}removeReference(t,e){this.Gr(new Ji(t,e))}zr(t,e){t.forEach(t=>this.removeReference(t,e))}jr(t){const e=new ot(new rt([])),n=new Ji(e,t),r=new Ji(e,t+1),i=[];return this.Ur.forEachInRange([n,r],t=>{this.Gr(t),i.push(t.key)}),i}Jr(){this.Qr.forEach(t=>this.Gr(t))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new ot(new rt([])),n=new Ji(e,t),r=new Ji(e,t+1);let i=nr();return this.Ur.forEachInRange([n,r],t=>{i=i.add(t.key)}),i}containsKey(t){const e=new Ji(t,0),n=this.Qr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Ji{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return ot.comparator(t.key,e.key)||X(t.Yr,e.Yr)}static Kr(t,e){return X(t.Yr,e.Yr)||ot.comparator(t.key,e.key)}}class Zi{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new fe(Ji.$r)}checkEmpty(t){return At.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Or(i,e,n,r);this.mutationQueue.push(s);for(const o of r)this.Zr=this.Zr.add(new Ji(o.key,i)),this.indexManager.addToCollectionParentIndex(t,o.key.path.popLast());return At.resolve(s)}lookupMutationBatch(t,e){return At.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.ei(n),i=r<0?0:r;return At.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return At.resolve(0===this.mutationQueue.length?Rt:this.tr-1)}getAllMutationBatches(t){return At.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Ji(e,0),r=new Ji(e,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([n,r],t=>{const e=this.Xr(t.Yr);i.push(e)}),At.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new fe(X);return e.forEach(t=>{const e=new Ji(t,0),r=new Ji(t,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([e,r],t=>{n=n.add(t.Yr)})}),At.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;ot.isDocumentKey(i)||(i=i.child(""));const s=new Ji(new ot(i),0);let o=new fe(X);return this.Zr.forEachWhile(t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.Yr)),!0)},s),At.resolve(this.ti(o))}ti(t){const e=[];return t.forEach(t=>{const n=this.Xr(t);null!==n&&e.push(n)}),e}removeMutationBatch(t,e){L(0===this.ni(e.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return At.forEach(e.mutations,r=>{const i=new Ji(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)}).next(()=>{this.Zr=n})}ir(t){}containsKey(t,e){const n=new Ji(e,0),r=this.Zr.firstAfterOrEqual(n);return At.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,At.resolve()}ni(t,e){return this.ei(t)}ei(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class $i{constructor(t){this.ri=t,this.docs=new ue(ot.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),i=r?r.size:0,s=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return At.resolve(n?n.document.mutableCopy():en.newInvalidDocument(e))}getEntries(t,e){let n=Wn();return e.forEach(t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():en.newInvalidDocument(t))}),At.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let i=Wn();const s=e.path,o=new ot(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||Tt(bt(o),n)<=0||(r.has(o.key)||qn(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return At.resolve(i)}getAllFromCollectionGroup(t,e,n,r){O(9500)}ii(t,e){return At.forEach(this.docs,t=>e(t))}newChangeBuffer(t){return new ts(this)}getSize(t){return At.resolve(this.size)}}class ts extends Gi{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?e.push(this.Nr.addEntry(t,r)):this.Nr.removeEntry(n)}),At.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class es{constructor(t){this.persistence=t,this.si=new Hn(t=>An(t),Dn),this.lastRemoteSnapshotVersion=yt.min(),this.highestTargetId=0,this.oi=0,this._i=new Yi,this.targetCount=0,this.ai=Pi.ur()}forEachTarget(t,e){return this.si.forEach((t,n)=>e(n)),At.resolve()}getLastRemoteSnapshotVersion(t){return At.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return At.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),At.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),At.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new Pi(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,At.resolve()}updateTargetData(t,e){return this.Pr(e),At.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,At.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.si.forEach((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)}),At.waitFor(i).next(()=>r)}getTargetCount(t){return At.resolve(this.targetCount)}getTargetData(t,e){const n=this.si.get(e)||null;return At.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),At.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),At.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),At.resolve()}getMatchingKeysForTargetId(t,e){const n=this._i.Hr(e);return At.resolve(n)}containsKey(t,e){return At.resolve(this._i.containsKey(e))}}class ns{constructor(t,e){this.ui={},this.overlays={},this.ci=new kt(0),this.li=!1,this.li=!0,this.hi=new Xi,this.referenceDelegate=t(this),this.Pi=new es(this),this.indexManager=new Ri,this.remoteDocumentCache=function(t){return new $i(t)}(t=>this.referenceDelegate.Ti(t)),this.serializer=new Di(e),this.Ii=new Qi(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Wi,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new Zi(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){D("MemoryPersistence","Starting transaction:",t);const r=new rs(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(t=>this.referenceDelegate.di(r).next(()=>t)).toPromise().then(t=>(r.raiseOnCommittedEvent(),t))}Ai(t,e){return At.or(Object.values(this.ui).map(n=>()=>n.containsKey(t,e)))}}class rs extends Ct{constructor(t){super(),this.currentSequenceNumber=t}}class is{constructor(t){this.persistence=t,this.Ri=new Yi,this.Vi=null}static mi(t){return new is(t)}get fi(){if(this.Vi)return this.Vi;throw O(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),At.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),At.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),At.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach(t=>this.fi.add(t.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(t=>{t.forEach(t=>this.fi.add(t.toString()))}).next(()=>n.removeTargetData(t,e))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return At.forEach(this.fi,n=>{const r=ot.fromPath(n);return this.gi(t,r).next(t=>{t||e.removeEntry(r,yt.min())})}).next(()=>(this.Vi=null,e.apply(t)))}updateLimboDocument(t,e){return this.gi(t,e).next(t=>{t?this.fi.delete(e.toString()):this.fi.add(e.toString())})}Ti(t){return 0}gi(t,e){return At.or([()=>At.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class ss{constructor(t,e){this.persistence=t,this.pi=new Hn(t=>Mt(t.path),(t,e)=>t.isEqual(e)),this.garbageCollector=zi(this,e)}static mi(t,e){return new ss(t,e)}Ei(){}di(t){return At.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next(t=>e.next(e=>t+e))}wr(t){let e=0;return this.pr(t,t=>{e++}).next(()=>e)}pr(t,e){return At.forEach(this.pi,(n,r)=>this.br(t,n,r).next(t=>t?At.resolve():e(r)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(t,r=>this.br(t,r,e).next(t=>{t||(n++,i.removeEntry(r,yt.min()))})).next(()=>i.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),At.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),At.resolve()}removeReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),At.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),At.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Ke(t.data.value)),e}br(t,e,n){return At.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const t=this.pi.get(e);return At.resolve(void 0!==t&&t>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class os{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=r}static As(t,e){let n=nr(),r=nr();for(const i of e.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new os(t,e.fromCache,n,r)}}class as{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class cs{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(0,h.nr)()?8:Dt((0,h.ZQ)())>0?6:4}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,r){const i={result:null};return this.ys(t,e).next(t=>{i.result=t}).next(()=>{if(!i.result)return this.ws(t,e,r,n).next(t=>{i.result=t})}).next(()=>{if(i.result)return;const n=new as;return this.Ss(t,e,n).next(r=>{if(i.result=r,this.Vs)return this.bs(t,e,n,r.size)})}).next(()=>i.result)}bs(t,e,n,r){return n.documentReadCount<this.fs?(A()<=c.$b.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",Bn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),At.resolve()):(A()<=c.$b.DEBUG&&D("QueryEngine","Query:",Bn(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(A()<=c.$b.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",Bn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Pn(e))):At.resolve())}ys(t,e){if(xn(e))return At.resolve(null);let n=Pn(e);return this.indexManager.getIndexType(t,n).next(r=>0===r?null:(null!==e.limit&&1===r&&(e=Fn(e,null,"F"),n=Pn(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(r=>{const i=nr(...r);return this.ps.getDocuments(t,i).next(r=>this.indexManager.getMinOffset(t,n).next(n=>{const s=this.Ds(e,r);return this.Cs(e,s,i,n.readTime)?this.ys(t,Fn(e,null,"F")):this.vs(t,s,e,n)}))})))}ws(t,e,n,r){return xn(e)||r.isEqual(yt.min())?At.resolve(null):this.ps.getDocuments(t,n).next(i=>{const s=this.Ds(e,i);return this.Cs(e,s,n,r)?At.resolve(null):(A()<=c.$b.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Bn(e)),this.vs(t,s,e,Et(r,vt)).next(t=>t))})}Ds(t,e){let n=new fe(Gn(t));return e.forEach((e,r)=>{qn(t,r)&&(n=n.add(r))}),n}Cs(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(t,e,n){return A()<=c.$b.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",Bn(e)),this.ps.getDocumentsMatchingQuery(t,e,_t.min(),n)}vs(t,e,n,r){return this.ps.getDocumentsMatchingQuery(t,n,r).next(t=>(e.forEach(e=>{t=t.insert(e.key,e)}),t))}}const hs="LocalStore",us=3e8;class ls{constructor(t,e,n,r){this.persistence=t,this.Fs=e,this.serializer=r,this.Ms=new ue(X),this.xs=new Hn(t=>An(t),Dn),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Hi(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}}function ds(t,e,n,r){return new ls(t,e,n,r)}async function fs(t,e){const n=M(t);return await n.persistence.runTransaction("Handle user change","readonly",t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next(i=>(r=i,n.Bs(e),n.mutationQueue.getAllMutationBatches(t))).next(e=>{const i=[],s=[];let o=nr();for(const t of r){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next(t=>({Ls:t,removedBatchIds:i,addedBatchIds:s}))})})}function gs(t){const e=M(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function ps(t,e,n){let r=nr(),i=nr();return n.forEach(t=>r=r.add(t)),e.getEntries(t,r).next(t=>{let r=Wn();return n.forEach((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(yt.min())?(e.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),r=r.insert(n,s)):D(hs,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{ks:r,qs:i}})}function ms(t,e){const n=M(t);return n.persistence.runTransaction("Allocate target","readwrite",t=>{let r;return n.Pi.getTargetData(t,e).next(i=>i?(r=i,At.resolve(r)):n.Pi.allocateTargetId(t).next(i=>(r=new Ai(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.Pi.addTargetData(t,r).next(()=>r))))}).then(t=>{const r=n.Ms.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(t.targetId,t),n.xs.set(e,t.targetId)),t})}async function ys(t,e,n){const r=M(t),i=r.Ms.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,t=>r.persistence.referenceDelegate.removeTarget(t,i))}catch(t){if(!Nt(t))throw t;D(hs,"Failed to update sequence numbers for target ".concat(e,": ").concat(t))}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function vs(t,e,n){const r=M(t);let i=yt.min(),s=nr();return r.persistence.runTransaction("Execute query","readwrite",t=>function(t,e,n){const r=M(t),i=r.xs.get(n);return void 0!==i?At.resolve(r.Ms.get(i)):r.Pi.getTargetData(e,n)}(r,t,Pn(e)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(t,e.targetId).next(t=>{s=t})}).next(()=>r.Fs.getDocumentsMatchingQuery(t,e,n?i:yt.min(),n?s:nr())).next(t=>(ws(r,zn(e),t),{documents:t,Qs:s})))}function ws(t,e,n){let r=t.Os.get(e)||yt.min();n.forEach((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)}),t.Os.set(e,r)}class Es{constructor(){this.activeTargetIds=ir()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class bs{constructor(){this.Mo=new Es,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new Es,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class _s{Oo(t){}shutdown(){}}const Ts="ConnectivityMonitor";class Ss{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){D(Ts,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){D(Ts,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Cs=null;function Is(){return null===Cs?Cs=268435456+Math.round(2147483648*Math.random()):Cs++,"0x"+Cs.toString(16)}const As="RestConnection",Ds={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Ns{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko="projects/".concat(n,"/databases/").concat(r),this.Wo=this.databaseId.database===ke?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(r)}Go(t,e,n,r,i){const s=Is(),o=this.zo(t,e.toUriEncodedString());D(As,"Sending RPC '".concat(t,"' ").concat(s,":"),o,n);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,r,i);const{host:c}=new URL(o),u=(0,h.zJ)(c);return this.Jo(t,o,a,n,u).then(e=>(D(As,"Received RPC '".concat(t,"' ").concat(s,": "),e),e),e=>{throw k(As,"RPC '".concat(t,"' ").concat(s," failed with error: "),e,"url: ",o,"request:",n),e})}Ho(t,e,n,r,i,s){return this.Go(t,e,n,r,i)}jo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+C,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,n)=>t[n]=e),n&&n.headers.forEach((e,n)=>t[n]=e)}zo(t,e){const n=Ds[t];return"".concat(this.Uo,"/v1/").concat(e,":").concat(n)}terminate(){}}class ks{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const Rs="WebChannelConnection";class Os extends Ns{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,r,i){const s=Is();return new Promise((i,o)=>{const a=new d;a.setWithCredentials(!0),a.listenOnce(g.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case p.NO_ERROR:const n=a.getResponseJson();D(Rs,"XHR for RPC '".concat(t,"' ").concat(s," received:"),JSON.stringify(n)),i(n);break;case p.TIMEOUT:D(Rs,"RPC '".concat(t,"' ").concat(s," timed out")),o(new V(P.DEADLINE_EXCEEDED,"Request time out"));break;case p.HTTP_ERROR:const r=a.getStatus();if(D(Rs,"RPC '".concat(t,"' ").concat(s," failed with status:"),r,"response text:",a.getResponseText()),r>0){var e;let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const n=null===(e=t)||void 0===e?void 0:e.error;if(n&&n.status&&n.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(e)>=0?e:P.UNKNOWN}(n.status);o(new V(t,n.message))}else o(new V(P.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new V(P.UNAVAILABLE,"Connection failed."));break;default:O(9055,{l_:t,streamId:s,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{D(Rs,"RPC '".concat(t,"' ").concat(s," completed."))}});const c=JSON.stringify(r);D(Rs,"RPC '".concat(t,"' ").concat(s," sending request:"),r),a.send(e,"POST",c,n,15)})}T_(t,e,n){const r=Is(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=w(),o=v(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const h=i.join("");D(Rs,"Creating RPC '".concat(t,"' stream ").concat(r,": ").concat(h),a);const u=s.createWebChannel(h,a);this.I_(u);let l=!1,d=!1;const g=new ks({Yo:e=>{d?D(Rs,"Not sending because RPC '".concat(t,"' stream ").concat(r," is closed:"),e):(l||(D(Rs,"Opening RPC '".concat(t,"' stream ").concat(r," transport.")),u.open(),l=!0),D(Rs,"RPC '".concat(t,"' stream ").concat(r," sending:"),e),u.send(e))},Zo:()=>u.close()}),p=(t,e,n)=>{t.listen(e,t=>{try{n(t)}catch(t){setTimeout(()=>{throw t},0)}})};return p(u,f.EventType.OPEN,()=>{d||(D(Rs,"RPC '".concat(t,"' stream ").concat(r," transport opened.")),g.o_())}),p(u,f.EventType.CLOSE,()=>{d||(d=!0,D(Rs,"RPC '".concat(t,"' stream ").concat(r," transport closed")),g.a_(),this.E_(u))}),p(u,f.EventType.ERROR,e=>{d||(d=!0,k(Rs,"RPC '".concat(t,"' stream ").concat(r," transport errored. Name:"),e.name,"Message:",e.message),g.a_(new V(P.UNAVAILABLE,"The operation could not be completed")))}),p(u,f.EventType.MESSAGE,e=>{if(!d){var n;const i=e.data[0];L(!!i,16349);const s=i,o=(null===s||void 0===s?void 0:s.error)||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){D(Rs,"RPC '".concat(t,"' stream ").concat(r," received error:"),o);const e=o.status;let n=function(t){const e=Mr[t];if(void 0!==e)return Vr(e)}(e),i=o.message;void 0===n&&(n=P.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),d=!0,g.a_(new V(n,i)),u.close()}else D(Rs,"RPC '".concat(t,"' stream ").concat(r," received:"),i),g.u_(i)}}),p(o,y.STAT_EVENT,e=>{e.stat===m.PROXY?D(Rs,"RPC '".concat(t,"' stream ").concat(r," detected buffering proxy")):e.stat===m.NOPROXY&&D(Rs,"RPC '".concat(t,"' stream ").concat(r," detected no buffering proxy"))}),setTimeout(()=>{g.__()},0),g}terminate(){this.c_.forEach(t=>t.close()),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter(e=>e===t)}}function xs(){return"undefined"!=typeof document?document:null}function Ls(t){return new ri(t,!0)}class Ms{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.Mi=t,this.timerId=e,this.d_=n,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,e-n);r>0&&D("ExponentialBackoff","Backing off for ".concat(r," ms (base delay: ").concat(this.V_," ms, delay with jitter: ").concat(e," ms, last attempt: ").concat(n," ms ago)")),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),t())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Ps="PersistentStream";class Vs{constructor(t,e,n,r,i,s,o,a){this.Mi=t,this.S_=n,this.b_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Ms(t,e)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==t?this.M_.reset():e&&e.code===P.RESOURCE_EXHAUSTED?(N(e.toString()),N("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===P.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(t=>{let[n,r]=t;this.D_===e&&this.G_(n,r)},e=>{t(()=>{const t=new V(P.UNKNOWN,"Fetching auth token failed: "+e.message);return this.z_(t)})})}G_(t,e){const n=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(t=>{n(()=>this.z_(t))}),this.stream.onMessage(t=>{n(()=>1==++this.F_?this.J_(t):this.onNext(t))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(t){return D(Ps,"close with error: ".concat(t)),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget(()=>this.D_===t?e():(D(Ps,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Fs extends Vs{constructor(t,e,n,r,i,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:O(39313,{state:t})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(L(void 0===e||"string"==typeof e,58123),ye.fromBase64String(e||"")):(L(void 0===e||e instanceof Buffer||e instanceof Uint8Array,16193),ye.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?P.UNKNOWN:Vr(t.code);return new V(e,t.message||"")}(o);n=new Xr(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=li(t,r.document.name),s=ai(r.document.updateTime),o=r.document.createTime?ai(r.document.createTime):yt.min(),a=new tn({mapValue:{fields:r.document.fields}}),c=en.newFoundDocument(i,s,o,a),h=r.targetIds||[],u=r.removedTargetIds||[];n=new Qr(h,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=li(t,r.document),s=r.readTime?ai(r.readTime):yt.min(),o=en.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Qr([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=li(t,r.document),s=r.removedTargetIds||[];n=new Qr([],s,i,null)}else{if(!("filter"in e))return O(11601,{Rt:e});{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:i}=t,s=new Lr(r,i),o=t.targetId;n=new Wr(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return yt.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?yt.min():e.readTime?ai(e.readTime):yt.min()}(t);return this.listener.H_(e,n)}Y_(t){const e={};e.database=gi(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=Nn(r)?{documents:mi(t,r)}:{query:yi(t,r).ft},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=oi(t,e.resumeToken);const r=ii(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(yt.min())>0){n.readTime=si(t,e.snapshotVersion.toTimestamp());const r=ii(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return O(28987,{purpose:t})}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.q_(e)}Z_(t){const e={};e.database=gi(this.serializer),e.removeTarget=t,this.q_(e)}}class Us{}class js extends Us{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new V(P.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(i=>{let[s,o]=i;return this.connection.Go(t,hi(e,n),r,s,o)}).catch(t=>{throw"FirebaseError"===t.name?(t.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new V(P.UNKNOWN,t.toString())})}Ho(t,e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(s=>{let[o,a]=s;return this.connection.Ho(t,hi(e,n),r,o,a,i)}).catch(t=>{throw"FirebaseError"===t.name?(t.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new V(P.UNKNOWN,t.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Bs{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(t){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la("Connection failed 1 times. Most recent error: ".concat(t.toString())),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,"Online"===t&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e="Could not reach Cloud Firestore backend. ".concat(t,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.aa?(N(e),this.aa=!1):D("OnlineStateTracker",e)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const qs="RemoteStore";class zs{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(t=>{n.enqueueAndForget(async()=>{Zs(this)&&(D(qs,"Restarting streams for network reachability change."),await async function(t){const e=M(t);e.Ea.add(4),await Ks(e),e.Ra.set("Unknown"),e.Ea.delete(4),await Gs(e)}(this))})}),this.Ra=new Bs(n,r)}}async function Gs(t){if(Zs(t))for(const e of t.da)await e(!0)}async function Ks(t){for(const e of t.da)await e(!1)}function Hs(t,e){const n=M(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),Js(n)?Ys(n):ao(n).O_()&&Ws(n,e))}function Qs(t,e){const n=M(t),r=ao(n);n.Ia.delete(e),r.O_()&&Xs(n,e),0===n.Ia.size&&(r.O_()?r.L_():Zs(n)&&n.Ra.set("Unknown"))}function Ws(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(yt.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}ao(t).Y_(e)}function Xs(t,e){t.Va.Ue(e),ao(t).Z_(e)}function Ys(t){t.Va=new Jr({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),ao(t).start(),t.Ra.ua()}function Js(t){return Zs(t)&&!ao(t).x_()&&t.Ia.size>0}function Zs(t){return 0===M(t).Ea.size}function $s(t){t.Va=void 0}async function to(t){t.Ra.set("Online")}async function eo(t){t.Ia.forEach((e,n)=>{Ws(t,e)})}async function no(t,e){$s(t),Js(t)?(t.Ra.ha(e),Ys(t)):t.Ra.set("Unknown")}async function ro(t,e,n){if(t.Ra.set("Online"),e instanceof Xr&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.Ia.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.Ia.delete(r),t.Va.removeTarget(r))}(t,e)}catch(n){D(qs,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await io(t,n)}else if(e instanceof Qr?t.Va.Ze(e):e instanceof Wr?t.Va.st(e):t.Va.tt(e),!n.isEqual(yt.min()))try{const e=await gs(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Va.Tt(e);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.Ia.get(r);i&&t.Ia.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach((e,n)=>{const r=t.Ia.get(e);if(!r)return;t.Ia.set(e,r.withResumeToken(ye.EMPTY_BYTE_STRING,r.snapshotVersion)),Xs(t,e);const i=new Ai(r.target,e,n,r.sequenceNumber);Ws(t,i)}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){D(qs,"Failed to raise snapshot:",e),await io(t,e)}}async function io(t,e,n){if(!Nt(e))throw e;t.Ea.add(1),await Ks(t),t.Ra.set("Offline"),n||(n=()=>gs(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{D(qs,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await Gs(t)})}async function so(t,e){const n=M(t);n.asyncQueue.verifyOperationInProgress(),D(qs,"RemoteStore received new credentials");const r=Zs(n);n.Ea.add(3),await Ks(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await Gs(n)}async function oo(t,e){const n=M(t);e?(n.Ea.delete(2),await Gs(n)):e||(n.Ea.add(2),await Ks(n),n.Ra.set("Unknown"))}function ao(t){return t.ma||(t.ma=function(t,e,n){const r=M(t);return r.sa(),new Fs(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Xo:to.bind(null,t),t_:eo.bind(null,t),r_:no.bind(null,t),H_:ro.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),Js(t)?Ys(t):t.Ra.set("Unknown")):(await t.ma.stop(),$s(t))})),t.ma}class co{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new F,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(t=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new co(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new V(P.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ho(t,e){if(N("AsyncQueue","".concat(e,": ").concat(t)),Nt(t))return new V(P.UNAVAILABLE,"".concat(e,": ").concat(t));throw t}class uo{static emptySet(t){return new uo(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||ot.comparator(e.key,n.key):(t,e)=>ot.comparator(t.key,e.key),this.keyedMap=Yn(),this.sortedSet=new ue(this.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof uo))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new uo;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class lo{constructor(){this.ga=new ue(ot.comparator)}track(t){const e=t.doc.key,n=this.ga.get(e);n?0!==t.type&&3===n.type?this.ga=this.ga.insert(e,t):3===t.type&&1!==n.type?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ga=this.ga.remove(e):1===t.type&&2===n.type?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):O(63341,{Rt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal((e,n)=>{t.push(n)}),t}}class fo{constructor(t,e,n,r,i,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,i){const s=[];return e.forEach(t=>{s.push({type:0,doc:t})}),new fo(t,e,uo.emptySet(e),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Un(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0}}class go{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(t=>t.Da())}}class po{constructor(){this.queries=mo(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(t,e){const n=M(t),r=n.queries;n.queries=mo(),r.forEach((t,n)=>{for(const r of n.Sa)r.onError(e)})}(this,new V(P.ABORTED,"Firestore shutting down"))}}function mo(){return new Hn(t=>jn(t),Un)}async function yo(t,e){const n=M(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.ba()&&e.Da()&&(r=2):(s=new go,r=e.Da()?0:1);try{switch(r){case 0:s.wa=await n.onListen(i,!0);break;case 1:s.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(t){const n=ho(t,"Initialization of query '".concat(Bn(e.query),"' failed"));return void e.onError(n)}n.queries.set(i,s),s.Sa.push(e),e.va(n.onlineState),s.wa&&e.Fa(s.wa)&&bo(n)}async function vo(t,e){const n=M(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const t=s.Sa.indexOf(e);t>=0&&(s.Sa.splice(t,1),0===s.Sa.length?i=e.Da()?0:1:!s.ba()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function wo(t,e){const n=M(t);let r=!1;for(const i of e){const t=i.query,e=n.queries.get(t);if(e){for(const t of e.Sa)t.Fa(i)&&(r=!0);e.wa=i}}r&&bo(n)}function Eo(t,e,n){const r=M(t),i=r.queries.get(e);if(i)for(const s of i.Sa)s.onError(n);r.queries.delete(e)}function bo(t){t.Ca.forEach(t=>{t.next()})}var _o,To;(To=_o||(_o={})).Ma="default",To.Cache="cache";class So{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new fo(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==e;return(!this.options.qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}ka(t){t=fo.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==_o.Cache}}class Co{constructor(t){this.key=t}}class Io{constructor(t){this.key=t}}class Ao{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=nr(),this.mutatedKeys=nr(),this.eu=Gn(t),this.tu=new uo(this.eu)}get nu(){return this.Ya}ru(t,e){const n=e?e.iu:new lo,r=e?e.tu:this.tu;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal((t,e)=>{const h=r.get(t),u=qn(this.query,e)?e:null,l=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;h&&u?h.data.isEqual(u.data)?l!==d&&(n.track({type:3,doc:u}),f=!0):this.su(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.eu(u,a)>0||c&&this.eu(u,c)<0)&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||c)&&(o=!0)),f&&(u?(s=s.add(u),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))}),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{tu:s,iu:n,Cs:o,mutatedKeys:i}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const i=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const s=t.iu.ya();s.sort((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return O(20277,{Rt:t})}};return n(t)-n(e)}(t.type,e.type)||this.eu(t.doc,e.doc)),this.ou(n),r=null!==r&&void 0!==r&&r;const o=e&&!r?this._u():[],a=0===this.Xa.size&&this.current&&!r?1:0,c=a!==this.Za;return this.Za=a,0!==s.length||c?{snapshot:new fo(this.query,t.tu,i,s,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({tu:this.tu,iu:new lo,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),t.modifiedDocuments.forEach(t=>{}),t.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=nr(),this.tu.forEach(t=>{this.uu(t.key)&&(this.Xa=this.Xa.add(t.key))});const e=[];return t.forEach(t=>{this.Xa.has(t)||e.push(new Io(t))}),this.Xa.forEach(n=>{t.has(n)||e.push(new Co(n))}),e}cu(t){this.Ya=t.Qs,this.Xa=nr();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return fo.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const Do="SyncEngine";class No{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class ko{constructor(t){this.key=t,this.hu=!1}}class Ro{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new Hn(t=>jn(t),Un),this.Iu=new Map,this.Eu=new Set,this.du=new ue(ot.comparator),this.Au=new Map,this.Ru=new Yi,this.Vu={},this.mu=new Map,this.fu=Pi.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function Oo(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=Xo(t);let i;const s=r.Tu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await Lo(r,e,n,!0),i}async function xo(t,e){const n=Xo(t);await Lo(n,e,!0,!1)}async function Lo(t,e,n,r){const i=await ms(t.localStore,Pn(e)),s=i.targetId,o=t.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await Mo(t,e,s,"current"===o,i.resumeToken)),t.isPrimaryClient&&n&&Hs(t.remoteStore,i),a}async function Mo(t,e,n,r,i){t.pu=(e,n,r)=>async function(t,e,n,r){let i=e.view.ru(n);i.Cs&&(i=await vs(t.localStore,e.query,!1).then(t=>{let{documents:n}=t;return e.view.ru(n,i)}));const s=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,s,o);return zo(t,e.targetId,a.au),a.snapshot}(t,e,n,r);const s=await vs(t.localStore,e,!0),o=new Ao(e,s.Qs),a=o.ru(s.documents),c=Hr.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,i),h=o.applyChanges(a,t.isPrimaryClient,c);zo(t,n,h.au);const u=new No(e,n,o);return t.Tu.set(e,u),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),h.snapshot}async function Po(t,e,n){const r=M(t),i=r.Tu.get(e),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter(t=>!Un(t,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await ys(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Qs(r.remoteStore,i.targetId),Bo(r,i.targetId)}).catch(It)):(Bo(r,i.targetId),await ys(r.localStore,i.targetId,!0))}async function Vo(t,e){const n=M(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Qs(n.remoteStore,r.targetId))}async function Fo(t,e){const n=M(t);try{const t=await function(t,e){const n=M(t),r=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",t=>{const s=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const o=[];e.targetChanges.forEach((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Pi.removeMatchingKeys(t,s.removedDocuments,a).next(()=>n.Pi.addMatchingKeys(t,s.addedDocuments,a)));let h=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?h=h.withResumeToken(ye.EMPTY_BYTE_STRING,yt.min()).withLastLimboFreeSnapshotVersion(yt.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,r)),i=i.insert(a,h),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=us||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(c,h,s)&&o.push(n.Pi.updateTargetData(t,h))});let a=Wn(),c=nr();if(e.documentUpdates.forEach(r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),o.push(ps(t,s,e.documentUpdates).next(t=>{a=t.ks,c=t.qs})),!r.isEqual(yt.min())){const e=n.Pi.getLastRemoteSnapshotVersion(t).next(e=>n.Pi.setTargetsMetadata(t,t.currentSequenceNumber,r));o.push(e)}return At.waitFor(o).next(()=>s.apply(t)).next(()=>n.localDocuments.getLocalViewOfDocuments(t,a,c)).next(()=>a)}).then(t=>(n.Ms=i,t))}(n.localStore,e);e.targetChanges.forEach((t,e)=>{const r=n.Au.get(e);r&&(L(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.hu=!0:t.modifiedDocuments.size>0?L(r.hu,14607):t.removedDocuments.size>0&&(L(r.hu,42227),r.hu=!1))}),await Ho(n,t,e)}catch(t){await It(t)}}function Uo(t,e,n){const r=M(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.Tu.forEach((n,r)=>{const i=r.view.va(e);i.snapshot&&t.push(i.snapshot)}),function(t,e){const n=M(t);n.onlineState=e;let r=!1;n.queries.forEach((t,n)=>{for(const i of n.Sa)i.va(e)&&(r=!0)}),r&&bo(n)}(r.eventManager,e),t.length&&r.Pu.H_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function jo(t,e,n){const r=M(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),s=i&&i.key;if(s){let t=new ue(ot.comparator);t=t.insert(s,en.newNoDocument(s,yt.min()));const n=nr().add(s),i=new Kr(yt.min(),new Map,new ue(X),t,n);await Fo(r,i),r.du=r.du.remove(s),r.Au.delete(e),Ko(r)}else await ys(r.localStore,e,!1).then(()=>Bo(r,e,n)).catch(It)}function Bo(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(e=>{t.Ru.containsKey(e)||qo(t,e)})}function qo(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);null!==n&&(Qs(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),Ko(t))}function zo(t,e,n){for(const r of n)r instanceof Co?(t.Ru.addReference(r.key,e),Go(t,r)):r instanceof Io?(D(Do,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||qo(t,r.key)):O(19791,{wu:r})}function Go(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(D(Do,"New document in limbo: "+n),t.Eu.add(r),Ko(t))}function Ko(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new ot(rt.fromString(e)),r=t.fu.next();t.Au.set(r,new ko(n)),t.du=t.du.insert(n,r),Hs(t.remoteStore,new Ai(Pn(On(n.path)),r,"TargetPurposeLimboResolution",kt.ce))}}async function Ho(t,e,n){const r=M(t),i=[],s=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((t,a)=>{o.push(r.pu(a,e,n).then(t=>{if((t||n)&&r.isPrimaryClient){var e;const i=t?!t.fromCache:null===n||void 0===n||null===(e=n.targetChanges.get(a.targetId))||void 0===e?void 0:e.current;r.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(t){i.push(t);const e=os.As(a.targetId,t);s.push(e)}}))}),await Promise.all(o),r.Pu.H_(i),await async function(t,e){const n=M(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>At.forEach(e,e=>At.forEach(e.Es,r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r)).next(()=>At.forEach(e.ds,r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))}catch(t){if(!Nt(t))throw t;D(hs,"Failed to update sequence numbers: "+t)}for(const r of e){const t=r.targetId;if(!r.fromCache){const e=n.Ms.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.Ms=n.Ms.insert(t,i)}}}(r.localStore,s))}async function Qo(t,e){const n=M(t);if(!n.currentUser.isEqual(e)){D(Do,"User change. New user:",e.toKey());const t=await fs(n.localStore,e);n.currentUser=e,function(t,e){t.mu.forEach(t=>{t.forEach(t=>{t.reject(new V(P.CANCELLED,e))})}),t.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Ho(n,t.Ls)}}function Wo(t,e){const n=M(t),r=n.Au.get(e);if(r&&r.hu)return nr().add(r.key);{let t=nr();const r=n.Iu.get(e);if(!r)return t;for(const e of r){const r=n.Tu.get(e);t=t.unionWith(r.view.nu)}return t}}function Xo(t){const e=M(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Fo.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Wo.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=jo.bind(null,e),e.Pu.H_=wo.bind(null,e.eventManager),e.Pu.yu=Eo.bind(null,e.eventManager),e}class Yo{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Ls(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return ds(this.persistence,new cs,t.initialUser,this.serializer)}Cu(t){return new ns(is.mi,this.serializer)}Du(t){return new bs}async terminate(){var t,e;null!==(t=this.gcScheduler)&&void 0!==t&&t.stop(),null!==(e=this.indexBackfillerScheduler)&&void 0!==e&&e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Yo.provider={build:()=>new Yo};class Jo extends Yo{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){L(this.persistence.referenceDelegate instanceof ss,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Bi(n,t.asyncQueue,e)}Cu(t){const e=void 0!==this.cacheSizeBytes?Mi.withCacheSize(this.cacheSizeBytes):Mi.DEFAULT;return new ns(t=>ss.mi(t,e),this.serializer)}}class Zo{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Uo(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Qo.bind(null,this.syncEngine),await oo(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new po}createDatastore(t){const e=Ls(t.databaseInfo.databaseId),n=function(t){return new Os(t)}(t.databaseInfo);return function(t,e,n,r){return new js(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,i){return new zs(t,e,n,r,i)}(this.localStore,this.datastore,t.asyncQueue,t=>Uo(this.syncEngine,t,0),Ss.v()?new Ss:new _s)}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new Ro(t,e,n,r,i,s);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(t){const e=M(t);D(qs,"RemoteStore shutting down."),e.Ea.add(5),await Ks(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),null!==(t=this.datastore)&&void 0!==t&&t.terminate(),null===(e=this.eventManager)||void 0===e||e.terminate()}}Zo.provider={build:()=>new Zo};class $o{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):N("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout(()=>{this.muted||t(e)},0)}}const ta="FirestoreClient";class ea{constructor(t,e,n,r,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=S.UNAUTHENTICATED,this.clientId=W.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async t=>{D(ta,"Received user=",t.uid),await this.authCredentialListener(t),this.user=t}),this.appCheckCredentials.start(n,t=>(D(ta,"Received new app check token=",t),this.appCheckCredentialListener(t,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new F;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=ho(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}}async function na(t,e){t.asyncQueue.verifyOperationInProgress(),D(ta,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async t=>{r.isEqual(t)||(await fs(e.localStore,t),r=t)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function ra(t,e){t.asyncQueue.verifyOperationInProgress();const n=await ia(t);D(ta,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(t=>so(e.remoteStore,t)),t.setAppCheckTokenChangeListener((t,n)=>so(e.remoteStore,n)),t._onlineComponents=e}async function ia(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){D(ta,"Using user provided OfflineComponentProvider");try{await na(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===P.FAILED_PRECONDITION||t.code===P.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;k("Error using user provided cache. Falling back to memory cache: "+n),await na(t,new Yo)}}else D(ta,"Using default OfflineComponentProvider"),await na(t,new Jo(void 0));return t._offlineComponents}async function sa(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(D(ta,"Using user provided OnlineComponentProvider"),await ra(t,t._uninitializedComponentsProvider._online)):(D(ta,"Using default OnlineComponentProvider"),await ra(t,new Zo))),t._onlineComponents}async function oa(t){const e=await sa(t),n=e.eventManager;return n.onListen=Oo.bind(null,e.syncEngine),n.onUnlisten=Po.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=xo.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=Vo.bind(null,e.syncEngine),n}function aa(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new F;return t.asyncQueue.enqueueAndForget(async()=>function(t,e,n,r,i){const s=new $o({next:n=>{s.Nu(),e.enqueueAndForget(()=>vo(t,o)),n.fromCache&&"server"===r.source?i.reject(new V(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new So(n,s,{includeMetadataChanges:!0,qa:!0});return yo(t,o)}(await oa(t),t.asyncQueue,e,n,r)),r.promise}function ca(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const ha=new Map,ua="firestore.googleapis.com",la=!0;class da{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new V(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ua,this.ssl=la}else this.host=t.host,this.ssl=null!==(e=t.ssl)&&void 0!==e?e:la;if(this.isUsingEmulator=void 0!==t.emulatorOptions,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=Li;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<Fi)throw new V(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new V(P.INVALID_ARGUMENT,"".concat(t," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ca(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new V(P.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(t.timeoutSeconds," (must not be NaN)"));if(t.timeoutSeconds<5)throw new V(P.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(t.timeoutSeconds," (minimum allowed value is 5)"));if(t.timeoutSeconds>30)throw new V(P.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(t.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class fa{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new da({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new V(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new da(t),this._emulatorOptions=t.emulatorOptions||{},void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new j;switch(t.type){case"firstParty":return new G(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new V(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=ha.get(t);e&&(D("ComponentProvider","Removing Datastore"),ha.delete(t),e.terminate())}(this),Promise.resolve()}}class ga{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new ga(this.firestore,t,this._query)}}class pa{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ma(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new pa(this.firestore,t,this._key)}toJSON(){return{type:pa._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(ft(e,pa._jsonSchema))return new pa(t,n||null,new ot(rt.fromString(e.referencePath)))}}pa._jsonSchemaVersion="firestore/documentReference/1.0",pa._jsonSchema={type:dt("string",pa._jsonSchemaVersion),referencePath:dt("string")};class ma extends ga{constructor(t,e,n){super(t,e,On(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new pa(this.firestore,null,new ot(t))}withConverter(t){return new ma(this.firestore,t,this._path)}}function ya(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(t=(0,h.Ku)(t),at("collection","path",e),t instanceof fa){const n=rt.fromString(e,...r);return ct(n),new ma(t,null,n)}{if(!(t instanceof pa||t instanceof ma))throw new V(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t._path.child(rt.fromString(e,...r));return ct(n),new ma(t.firestore,null,n)}}const va="AsyncQueue";class wa{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Ms(this,"async_queue_retry"),this._c=()=>{const t=xs();t&&D(va,"Visibility state changed to "+t.visibilityState),this.M_.w_()},this.ac=t;const e=xs();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=xs();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise(()=>{});const e=new F;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Xu.push(t),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Nt(t))throw t;D(va,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(t){const e=this.ac.then(()=>(this.rc=!0,t().catch(t=>{throw this.nc=t,this.rc=!1,N("INTERNAL UNHANDLED ERROR: ",Ea(t)),t}).then(t=>(this.rc=!1,t))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const r=co.createAndSchedule(this,t,e,n,t=>this.hc(t));return this.tc.push(r),r}uc(){this.nc&&O(47125,{Pc:Ea(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do{t=this.ac,await t}while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then(()=>{this.tc.sort((t,e)=>t.targetTimeMs-e.targetTimeMs);for(const e of this.tc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Tc()})}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function Ea(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}class ba extends fa{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new wa,this._persistenceKey=(null===r||void 0===r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new wa(t),this._firestoreClient=void 0,await t}}}function _a(t,e){const n="object"==typeof t?t:(0,o.Sx)(),r="string"==typeof t?t:e||ke,i=(0,o.j6)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const t=(0,h.yU)("firestore");t&&function(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t=lt(t,fa);const i=(0,h.zJ)(e),o=t._getSettings(),a=(0,s.A)((0,s.A)({},o),{},{emulatorOptions:t._getEmulatorOptions()}),c="".concat(e,":").concat(n);i&&((0,h.gE)("https://".concat(c)),(0,h.P1)("Firestore",!0)),o.host!==ua&&o.host!==c&&k("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u=(0,s.A)((0,s.A)({},o),{},{host:c,ssl:i,emulatorOptions:r});if(!(0,h.bD)(u,a)&&(t._setSettings(u),r.mockUserToken)){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=S.MOCK_USER;else{var l;e=(0,h.Fy)(r.mockUserToken,null===(l=t._app)||void 0===l?void 0:l.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new V(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new S(i)}t._authCredentials=new B(new U(e,n))}}(i,...t)}return i}function Ta(t){if(t._terminated)throw new V(P.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||Sa(t),t._firestoreClient}function Sa(t){var e,n,r;const i=t._freezeSettings(),s=function(t,e,n,r){return new Ne(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,ca(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._componentsProvider||null!==(n=i.localCache)&&void 0!==n&&n._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(t._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),t._firestoreClient=new ea(t._authCredentials,t._appCheckCredentials,t._queue,s,t._componentsProvider&&function(t){const e=null===t||void 0===t?void 0:t._online.build();return{_offline:null===t||void 0===t?void 0:t._offline.build(e),_online:e}}(t._componentsProvider))}class Ca{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Ca(ye.fromBase64String(t))}catch(t){throw new V(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Ca(ye.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Ca._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(ft(t,Ca._jsonSchema))return Ca.fromBase64String(t.bytes)}}Ca._jsonSchemaVersion="firestore/bytes/1.0",Ca._jsonSchema={type:dt("string",Ca._jsonSchemaVersion),bytes:dt("string")};class Ia{constructor(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(let r=0;r<e.length;++r)if(0===e[r].length)throw new V(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new st(e)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Aa{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new V(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new V(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return X(this._lat,t._lat)||X(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Aa._jsonSchemaVersion}}static fromJSON(t){if(ft(t,Aa._jsonSchema))return new Aa(t.latitude,t.longitude)}}Aa._jsonSchemaVersion="firestore/geoPoint/1.0",Aa._jsonSchema={type:dt("string",Aa._jsonSchemaVersion),latitude:dt("number"),longitude:dt("number")};class Da{constructor(t){this._values=(t||[]).map(t=>t)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this._values,t._values)}toJSON(){return{type:Da._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(ft(t,Da._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(t=>"number"==typeof t))return new Da(t.vectorValues);throw new V(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Da._jsonSchemaVersion="firestore/vectorValue/1.0",Da._jsonSchema={type:dt("string",Da._jsonSchemaVersion),vectorValues:dt("object")};const Na=new RegExp("[~\\*/\\[\\]]");function ka(t,e,n){if(e.search(Na)>=0)throw Ra("Invalid field path (".concat(e,"). Paths must not contain '~', '*', '/', '[', or ']'"),t,!1,void 0,n);try{return new Ia(...e.split("."))._internalPath}catch(r){throw Ra("Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),t,!1,void 0,n)}}function Ra(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a="Function ".concat(e,"() called with invalid data");n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=" in field ".concat(r)),o&&(c+=" in document ".concat(i)),c+=")"),new V(P.INVALID_ARGUMENT,a+t+c)}class Oa{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new pa(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new xa(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(La("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class xa extends Oa{data(){return super.data()}}function La(t,e){return"string"==typeof e?ka(t,e):e instanceof Ia?e._internalPath:e._delegate._internalPath}function Ma(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new V(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Pa{convertValue(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Ve(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ee(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(be(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw O(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return ce(t,(t,r)=>{n[t]=this.convertValue(r,e)}),n}convertVectorValue(t){var e;const n=null===(e=t.fields)||void 0===e||null===(e=e[Pe].arrayValue)||void 0===e||null===(e=e.values)||void 0===e?void 0:e.map(t=>Ee(t.doubleValue));return new Da(n)}convertGeoPoint(t){return new Aa(Ee(t.latitude),Ee(t.longitude))}convertArray(t,e){return(t.values||[]).map(t=>this.convertValue(t,e))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Ae(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(De(t));default:return null}}convertTimestamp(t){const e=we(t);return new mt(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=rt.fromString(t);L(Ii(n),9688,{name:t});const r=new Re(n.get(1),n.get(3)),i=new ot(n.popFirst(5));return r.isEqual(e)||N("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(e.projectId,"/").concat(e.database,") instead.")),i}}class Va{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Fa extends Oa{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const e=new Ua(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(La("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Fa._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),t&&t.isValidDocument()&&t.isFoundDocument()?(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e):e}}Fa._jsonSchemaVersion="firestore/documentSnapshot/1.0",Fa._jsonSchema={type:dt("string",Fa._jsonSchemaVersion),bundleSource:dt("string","DocumentSnapshot"),bundleName:dt("string"),bundle:dt("string")};class Ua extends Fa{data(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(t)}}class ja{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Va(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Ua(this._firestore,this._userDataWriter,n.key,n,new Va(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const t=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map(n=>{const r=new Ua(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Va(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}})}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(t=>e||3!==t.type).map(e=>{const r=new Ua(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Va(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,s=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:Ba(e.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=ja._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=W.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],n=[],r=[];return this.docs.forEach(t=>{null!==t._document&&(e.push(t._document),n.push(this._userDataWriter.convertObjectMap(t._document.data.value.mapValue.fields,"previous")),r.push(t.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function Ba(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return O(61501,{type:t})}}ja._jsonSchemaVersion="firestore/querySnapshot/1.0",ja._jsonSchema={type:dt("string",ja._jsonSchemaVersion),bundleSource:dt("string","QuerySnapshot"),bundleName:dt("string"),bundle:dt("string")};class qa extends Pa{constructor(t){super(),this.firestore=t}convertBytes(t){return new Ca(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new pa(this.firestore,null,e)}}function za(t){t=lt(t,ga);const e=lt(t.firestore,ba),n=Ta(e),r=new qa(e);return Ma(t._query),aa(n,t._query).then(n=>new ja(e,r,t,n))}new WeakMap;!function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(t){C=t}(o.MF),(0,o.om)(new a.uA("firestore",(t,n)=>{let{instanceIdentifier:r,options:i}=n;const o=t.getProvider("app").getImmediate(),a=new ba(new q(t.getProvider("auth-internal")),new H(o,t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new V(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Re(t.options.projectId,e)}(o,r),o);return i=(0,s.A)({useFetchStreams:e},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),(0,o.KO)(_,T,t),(0,o.KO)(_,T,"esm2020")}()},705:(t,e,n)=>{function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==r(e)?e:e+""}function s(t,e,n){return(e=i(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,{A:()=>s})},776:(t,e,n)=>{n.d(e,{cY:()=>f,FA:()=>A,g:()=>I,u:()=>c,Uj:()=>a,Fy:()=>m,bD:()=>N,T9:()=>d,yU:()=>l,mS:()=>h,Ku:()=>R,ZQ:()=>E,zJ:()=>g,zW:()=>S,nr:()=>_,Ov:()=>T,gE:()=>p,P1:()=>w,eX:()=>C});var r=n(379);const i=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296===(64512&i)&&r+1<t.length&&56320===(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const e=t[i],s=i+1<t.length,o=s?t[i+1]:0,a=i+2<t.length,c=a?t[i+2]:0,h=e>>2,u=(3&e)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),r.push(n[h],n[u],n[l],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(i(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const e=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0;++i;const a=i<t.length?n[t.charAt(i)]:64;++i;const c=i<t.length?n[t.charAt(i)]:64;if(++i,null==e||null==s||null==a||null==c)throw new o;const h=e<<2|s>>4;if(r.push(h),64!==a){const t=s<<4&240|a>>2;if(r.push(t),64!==c){const t=a<<6&192|c;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(t){return function(t){const e=i(t);return s.encodeByteArray(e,!0)}(t).replace(/\./g,"")},c=function(t){try{return s.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function h(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}const u=()=>{try{return h().__FIREBASE_DEFAULTS__||(()=>{if("undefined"===typeof process)return;const t={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyAA8456obvYzg68izmjkUdr8K0Z4HEtw9Y",REACT_APP_FIREBASE_AUTH_DOMAIN:"maw-axglrf.firebaseapp.com",REACT_APP_FIREBASE_DATABASE_URL:"https://maw-axglrf.firebaseio.com",REACT_APP_FIREBASE_PROJECT_ID:"maw-axglrf",REACT_APP_FIREBASE_STORAGE_BUCKET:"maw-axglrf.appspot.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"633101684981",REACT_APP_FIREBASE_APP_ID:"1:633101684981:web:192d87c27b2e4a5edff5bc"}.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"===typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const e=t&&c(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(t))}},l=t=>{const e=(t=>{var e;return null===(e=u())||void 0===e||null===(e=e.emulatorHosts)||void 0===e?void 0:e[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error("Invalid host ".concat(e," with no separate hostname and port!"));const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]},d=()=>{var t;return null===(t=u())||void 0===t?void 0:t.config};class f{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"===typeof t&&(this.promise.catch(()=>{}),1===t.length?t(e):t(e,n))}}}function g(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch(e){return!1}}async function p(t){return(await fetch(t,{credentials:"include"})).ok}function m(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=(0,r.A)({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(o)),""].join(".")}const y={};let v=!1;function w(t,e){if("undefined"===typeof window||"undefined"===typeof document||!g(window.location.host)||y[t]===e||y[t]||v)return;function n(t){return"__firebase__banner__".concat(t)}y[t]=e;const r="__firebase__banner",i=function(){const t={prod:[],emulator:[]};for(const e of Object.keys(y))y[e]?t.emulator.push(e):t.prod.push(e);return t}().prod.length>0;function s(){const t=document.createElement("span");return t.style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{v=!0,function(){const t=document.getElementById(r);t&&t.remove()}()},t}function o(){const t=function(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}(r),e=n("text"),o=document.getElementById(e)||document.createElement("span"),a=n("learnmore"),c=document.getElementById(a)||document.createElement("a"),h=n("preprendIcon"),u=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.created){const e=t.element;!function(t){t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center"}(e),function(t,e){t.setAttribute("id",e),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline"}(c,a);const n=s();!function(t,e){t.setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px"}(u,h),e.append(u,o,c,n),document.body.appendChild(e)}i?(o.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",e)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}function E(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function b(){var t;const e=null===(t=u())||void 0===t?void 0:t.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(r){return!1}}function _(){return!b()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function T(){return!b()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function S(){try{return"object"===typeof indexedDB}catch(t){return!1}}function C(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(n){e(n)}})}class I extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,I.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,A.prototype.create)}}class A{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t){const e=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(t),r=this.errors[t],i=r?function(t,e){return t.replace(D,(t,n)=>{const r=e[n];return null!=r?String(r):"<".concat(n,"?>")})}(r,e):"Error",s="".concat(this.serviceName,": ").concat(i," (").concat(n,").");return new I(n,s,e)}}const D=/\{\$([^}]+)}/g;function N(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(k(n)&&k(s)){if(!N(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function k(t){return null!==t&&"object"===typeof t}function R(t){return t&&t._delegate?t._delegate:t}},965:(t,e,n)=>{n.d(e,{$b:()=>i,Vy:()=>h});const r=[];var i;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(i||(i={}));const s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},o=i.INFO,a={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},c=function(t,e){if(e<t.logLevel)return;const n=(new Date).toISOString(),r=a[e];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(e,")"));for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];console[r]("[".concat(n,"]  ").concat(t.name,":"),...s)};class h{constructor(t){this.name=t,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in i))throw new TypeError('Invalid value "'.concat(t,'" assigned to `logLevel`'));this._logLevel=t}setLogLevel(t){this._logLevel="string"===typeof t?s[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!==typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...e),this._logHandler(this,i.DEBUG,...e)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...e),this._logHandler(this,i.VERBOSE,...e)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.INFO,...e),this._logHandler(this,i.INFO,...e)}warn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.WARN,...e),this._logHandler(this,i.WARN,...e)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.ERROR,...e),this._logHandler(this,i.ERROR,...e)}}}}]);
//# sourceMappingURL=810.ec3484cd.chunk.js.map